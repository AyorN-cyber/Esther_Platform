const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Bj3hcO3F.js","assets/react-vendor-9mwbaf1v.js","assets/icons-DMikDYYF.js","assets/index-DHIwMH2c.css"])))=>i.map(i=>d[i]);
import{u as e,s as t,j as s,_ as r,g as a,a as l,b as i,d as n,r as o,c as d,e as c,f as u,P as p}from"./index-Bj3hcO3F.js";import{r as x,a as m}from"./react-vendor-9mwbaf1v.js";import{g as h,X as g,h as b,V as f,i as y,T as j,j as v,k as w,S as N,B as k,U as _,l as S,m as C,E as z,n as P,L as T,o as A,p as D,q as E,r as I,f as L,H as q,M,a as $,b as R,s as F,t as O,u as U,v as V,w as B,D as G,C as H,x as W,y as J,A as Y,z as Q,F as Z,J as K,K as X,N as ee,O as te,R as se,W as re,Q as ae,Z as le,_ as ie,$ as ne,a0 as oe}from"./icons-DMikDYYF.js";const de=["ðŸ˜Š","ðŸ˜‚","ðŸ¥°","ðŸ˜","ðŸ¤—","ðŸ˜˜","ðŸ˜Ž","ðŸ¤©","ðŸ¥³","ðŸ‘","ðŸ‘","ðŸ™Œ","ðŸ’ª","ðŸ™","â¤ï¸","ðŸ’–","ðŸ’•","ðŸŽµ","ðŸŽ¶","ðŸŽ¤","âœ¨","â­","ðŸŒŸ","ðŸ”¥","ðŸ’¯","ðŸŽ‰"],ce=()=>{try{const e=window.AudioContext||window.webkitAudioContext;if(!e)return;const t=new e;"suspended"===t.state&&t.resume();const s=t.createOscillator(),r=t.createGain();s.connect(r),r.connect(t.destination),s.frequency.value=800,s.type="sine",r.gain.setValueAtTime(.3,t.currentTime),r.gain.exponentialRampToValueAtTime(.01,t.currentTime+.2),s.start(t.currentTime),s.stop(t.currentTime+.2),s.onended=()=>{t.close()}}catch(e){}},ue=({currentUser:a,videos:l=[]})=>{var i;const{profilePicture:n}=e(),[o,d]=x.useState(!1),[c,u]=x.useState([]),[p,m]=x.useState(""),[k,_]=x.useState(!1),[S,C]=x.useState(!1),[z,P]=x.useState(""),[T,A]=x.useState(null),[D,E]=x.useState(""),[I,L]=x.useState(0),[q,M]=x.useState(null),[$,R]=x.useState(null),F=x.useRef(null),O=x.useRef(null),U="artist"===a.role?"Editor":"Esther Reign";x.useEffect(()=>{a&&(async()=>{try{if(null==a?void 0:a.email){try{const{getProfilePicture:e}=await r(async()=>{const{getProfilePicture:e}=await import("./index-Bj3hcO3F.js").then(e=>e.h);return{getProfilePicture:e}},__vite__mapDeps([0,1,2,3])),t=await e(a.email);if(t)return R(t),void(t!==localStorage.getItem("admin_profile_picture")&&localStorage.setItem("admin_profile_picture",t))}catch(e){}try{const{data:e,error:s}=await t.from("users").select("avatar_url").eq("email",a.email).maybeSingle();if(s);else if(null==e?void 0:e.avatar_url)return R(e.avatar_url),void(e.avatar_url!==localStorage.getItem("admin_profile_picture")&&localStorage.setItem("admin_profile_picture",e.avatar_url))}catch(s){}}const l=n||(null==a?void 0:a.profilePicture);R(l||null)}catch(l){const e=n||(null==a?void 0:a.profilePicture);e&&R(e)}})()},[null==a?void 0:a.email,null==a?void 0:a.id,n,null==a?void 0:a.profilePicture]),x.useEffect(()=>{if(n||(null==a?void 0:a.profilePicture)){const e=n||(null==a?void 0:a.profilePicture);e&&e!==$&&R(e)}},[n,null==a?void 0:a.profilePicture]),x.useEffect(()=>{V(),B(),Q(),Z()},[]),x.useEffect(()=>{if(o&&F.current&&(F.current.scrollIntoView({behavior:"smooth"}),L(0)),o&&(null==a?void 0:a.email)&&!$){(async()=>{try{const{getProfilePicture:e}=await r(async()=>{const{getProfilePicture:e}=await import("./index-Bj3hcO3F.js").then(e=>e.h);return{getProfilePicture:e}},__vite__mapDeps([0,1,2,3])),t=await e(a.email);t&&(R(t),localStorage.setItem("admin_profile_picture",t))}catch(e){}})()}},[c,o,null==a?void 0:a.email,$]);const V=async()=>{try{const{data:e,error:s}=await t.from("chat_messages").select("*").order("timestamp",{ascending:!0});if(s)throw s;if(u(e||[]),!o){const t=(e||[]).filter(e=>e.sender_id!==a.id).length;L(Math.min(t,9))}}catch(e){}},B=()=>{const e=t.channel("admin_chat_channel").on("postgres_changes",{event:"*",schema:"public",table:"chat_messages"},e=>{if("INSERT"===e.eventType){const t=e.new;u(e=>e.find(e=>e.id===t.id)?e:[...e,t]),t.sender_id!==a.id&&(ce(),o||L(e=>Math.min(e+1,9)))}else"DELETE"===e.eventType?u(t=>t.filter(t=>t.id!==e.old.id)):"UPDATE"===e.eventType&&u(t=>t.map(t=>t.id===e.new.id?e.new:t))}).subscribe();return()=>{t.removeChannel(e)}},G=async()=>{if(!p.trim()&&!z)return;const e=z?l.find(e=>e.id===z):null,s=p.trim()||(z&&e?`ðŸ“¹ Referencing: ${e.title}`:"ðŸ“¹ Video reference"),r={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sender_id:a.id,sender_name:a.name,message:s,timestamp:(new Date).toISOString(),video_id:z||null,edited:!1};try{const e={...r,timestamp:(new Date).toISOString()};u(t=>[...t,e]),m(""),P(""),C(!1),O.current&&(O.current.style.height="auto",O.current.style.height="40px");const{data:s,error:a}=await t.from("chat_messages").insert([r]).select().single();if(a)throw u(e=>e.filter(e=>e.id!==r.id)),a}catch(i){alert("Failed to send message: "+i.message)}},H=()=>{A(null),E("")},W=async e=>{if(D.trim())try{const{error:s}=await t.from("chat_messages").update({message:D.trim(),edited:!0,timestamp:(new Date).toISOString()}).eq("id",e);if(s)throw s;A(null),E("")}catch(s){alert("Failed to edit message")}},J=e=>l.find(t=>t.id===e),Y=e=>{const t=new Date(e),s=(new Date).getTime()-t.getTime(),r=Math.floor(s/6e4);return r<1?"Just now":r<60?`${r}m ago`:r<1440?`${Math.floor(r/60)}h ago`:t.toLocaleDateString()},Q=async()=>{try{const{data:e,error:s}=await t.from("chat_clear_requests").select("*").eq("status","pending").order("created_at",{ascending:!1}).limit(1).single();if(s&&"PGRST116"!==s.code)throw s;M(e||null)}catch(e){}},Z=()=>{const e=t.channel("clear_requests_channel").on("postgres_changes",{event:"*",schema:"public",table:"chat_clear_requests"},e=>{if("INSERT"===e.eventType||"UPDATE"===e.eventType){const t=e.new;"pending"===t.status?M(t):"approved"===t.status?(u([]),M(null),ce()):M(null)}else"DELETE"===e.eventType&&M(null)}).subscribe();return()=>{t.removeChannel(e)}};return o?s.jsxs("div",{className:"fixed inset-0 lg:inset-auto lg:fixed lg:right-4 lg:bottom-4 lg:w-[380px] lg:h-[580px] max-w-full max-h-full bg-gradient-to-br from-[#2d1b4e] to-[#1a0a2e] backdrop-blur-2xl rounded-none lg:rounded-3xl shadow-2xl flex flex-col border-0 lg:border border-purple-500/30 z-[9999]",style:{zIndex:999999,position:"fixed"},children:[s.jsxs("div",{className:"flex-shrink-0 bg-gradient-to-r from-purple-600/30 to-purple-700/30 p-4 flex items-center justify-between border-b border-purple-500/30 rounded-t-2xl lg:rounded-t-3xl",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[$?s.jsx("img",{src:$,alt:"Profile",className:"w-10 h-10 rounded-full object-cover shadow-lg"}):s.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold",children:U.charAt(0)}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-white font-bold text-sm md:text-base",children:U}),s.jsx("p",{className:"text-xs text-purple-300",children:"Online"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[!q&&s.jsx("button",{onClick:async()=>{if(confirm(`Request to clear all messages? ${U} must approve.`))try{const{data:e,error:s}=await t.from("chat_clear_requests").insert([{requested_by:a.id,requested_by_name:a.name,requested_by_role:a.role,status:"pending"}]).select().single();if(s)throw s;M(e),alert("Clear request sent. Waiting for approval...")}catch(e){alert("Failed to send clear request")}},className:"px-3 py-1 text-xs bg-red-500/20 hover:bg-red-500/30 text-red-300 rounded-lg transition-colors",title:"Request to clear all messages",children:"Clear Chat"}),s.jsx("button",{onClick:()=>d(!1),className:"w-8 h-8 flex items-center justify-center text-white hover:bg-purple-500/20 rounded-full transition-colors",children:s.jsx(g,{size:20})})]})]}),q&&q.requested_by!==a.id&&s.jsx("div",{className:"flex-shrink-0 p-4 bg-yellow-500/20 border-b border-yellow-500/50",children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-white font-semibold text-sm",children:"Clear Chat Request"}),s.jsxs("p",{className:"text-yellow-200 text-xs mt-1",children:[q.requested_by_name," wants to clear all messages"]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:async()=>{if(q&&confirm("Approve clearing all messages? This cannot be undone."))try{const{error:e}=await t.from("chat_clear_requests").update({status:"approved"}).eq("id",q.id);if(e)throw e;const{error:s}=await t.from("chat_messages").delete().neq("id","00000000-0000-0000-0000-000000000000");if(s)throw s;u([]),M(null),alert("Chat cleared successfully!")}catch(e){alert("Failed to clear chat")}},className:"px-3 py-1 bg-green-600 hover:bg-green-700 text-white text-xs rounded-lg transition-colors",children:"Approve"}),s.jsx("button",{onClick:async()=>{if(q)try{const{error:e}=await t.from("chat_clear_requests").update({status:"rejected"}).eq("id",q.id);if(e)throw e;M(null),alert("Clear request rejected")}catch(e){alert("Failed to reject request")}},className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded-lg transition-colors",children:"Reject"})]})]})}),q&&q.requested_by===a.id&&s.jsx("div",{className:"flex-shrink-0 p-3 bg-blue-500/20 border-b border-blue-500/50",children:s.jsxs("p",{className:"text-blue-200 text-xs text-center",children:["â³ Waiting for ",U," to approve clear request..."]})}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 min-h-0",children:[c.map(e=>{const r=e.sender_id===a.id,l=e.video_id?J(e.video_id):null;return T===e.id?s.jsx("div",{className:"flex "+(r?"justify-end":"justify-start"),children:s.jsxs("div",{className:"max-w-[85%] bg-purple-500/20 rounded-xl p-3 border border-purple-500/30",children:[s.jsx("input",{type:"text",value:D,onChange:e=>E(e.target.value),className:"w-full bg-transparent text-white outline-none text-sm mb-2",autoFocus:!0,onKeyDown:t=>{"Enter"===t.key&&W(e.id),"Escape"===t.key&&H()}}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>W(e.id),className:"px-3 py-1 bg-purple-600 rounded-lg text-white text-xs hover:bg-purple-700",children:s.jsx(b,{size:12})}),s.jsx("button",{onClick:H,className:"px-3 py-1 bg-gray-600 rounded-lg text-white text-xs hover:bg-gray-700",children:s.jsx(g,{size:12})})]})]})},e.id):s.jsx("div",{className:"flex "+(r?"justify-end":"justify-start"),children:s.jsxs("div",{className:`max-w-[85%] ${r?"bg-gradient-to-br from-purple-600 to-purple-700":"bg-purple-500/20"} rounded-xl p-3 border ${r?"border-purple-500/50":"border-purple-500/30"}`,children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("span",{className:"text-xs font-bold text-purple-100",children:e.sender_name}),e.edited&&s.jsx("span",{className:"text-xs text-purple-300",children:"(edited)"})]}),l&&s.jsxs("div",{className:"mb-2 p-2 bg-white/10 rounded-lg flex items-center gap-2",children:[s.jsx(f,{size:14,className:"text-purple-200"}),s.jsx("span",{className:"text-xs text-purple-200 truncate",children:l.title})]}),s.jsx("p",{className:"text-white text-sm whitespace-pre-wrap break-words",children:e.message}),s.jsxs("div",{className:"flex items-center justify-between mt-2",children:[s.jsx("span",{className:"text-xs text-purple-200",children:Y(e.timestamp)}),r&&s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>{return A((t=e).id),void E(t.message);var t},className:"p-1 hover:bg-purple-500/30 rounded transition-colors",title:"Edit",children:s.jsx(y,{size:12,className:"text-purple-200"})}),s.jsx("button",{onClick:()=>(async e=>{if(confirm("Are you sure you want to delete this message?"))try{const{error:s}=await t.from("chat_messages").delete().eq("id",e);if(s)throw s}catch(s){alert("Failed to delete message")}})(e.id),className:"p-1 hover:bg-red-500/30 rounded transition-colors",title:"Delete",children:s.jsx(j,{size:12,className:"text-red-300"})})]})]})]})},e.id)}),s.jsx("div",{ref:F})]}),s.jsxs("div",{className:"flex-shrink-0 p-3 border-t border-purple-500/30 bg-[#2d1b4e]/80 rounded-b-2xl lg:rounded-b-3xl",children:[S&&s.jsxs("div",{className:"mb-3 p-3 bg-purple-500/10 rounded-xl border border-purple-500/20 max-h-32 overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-xs font-semibold text-purple-200",children:"Select Video"}),s.jsx("button",{onClick:()=>C(!1),className:"text-purple-300 hover:text-white",children:s.jsx(g,{size:14})})]}),s.jsx("div",{className:"space-y-1",children:0===l.length?s.jsx("p",{className:"text-xs text-purple-300",children:"No videos available"}):l.map(e=>s.jsx("button",{onClick:()=>{P(e.id),C(!1)},className:"w-full text-left p-2 rounded-lg text-xs transition-colors "+(z===e.id?"bg-purple-600 text-white":"bg-purple-500/10 text-purple-200 hover:bg-purple-500/20"),children:e.title},e.id))})]}),k&&s.jsx("div",{className:"mb-3 p-3 bg-purple-500/10 rounded-xl border border-purple-500/20 grid grid-cols-8 gap-1 max-h-32 overflow-y-auto",children:de.map(e=>s.jsx("button",{onClick:()=>(e=>{var t;m(t=>t+e),_(!1),null==(t=O.current)||t.focus()})(e),className:"text-xl hover:bg-purple-500/20 rounded-lg p-1 transition-colors",children:e},e))}),z&&s.jsxs("div",{className:"mb-2 p-2 bg-purple-600/20 rounded-lg flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(f,{size:14,className:"text-purple-300"}),s.jsx("span",{className:"text-xs text-purple-200 truncate",children:(null==(i=J(z))?void 0:i.title)||"Video selected"})]}),s.jsx("button",{onClick:()=>P(""),className:"text-purple-300 hover:text-white",children:s.jsx(g,{size:14})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>C(!S),className:"p-2 hover:bg-purple-500/20 rounded-lg transition-colors",title:"Attach Video",children:s.jsx(v,{size:18,className:"text-purple-300"})}),s.jsx("button",{onClick:()=>_(!k),className:"p-2 hover:bg-purple-500/20 rounded-lg transition-colors",title:"Emoji",children:s.jsx(w,{size:18,className:"text-purple-300"})}),s.jsx("textarea",{ref:O,value:p,onChange:e=>m(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),G())},placeholder:"Type a message... (Shift+Enter for new line)",rows:1,className:"flex-1 px-3 py-2 bg-purple-500/10 border border-purple-500/30 rounded-lg text-white placeholder-purple-400 text-sm focus:outline-none focus:border-purple-500 resize-none min-h-[40px] max-h-[120px] overflow-y-auto",style:{height:"auto",minHeight:"40px"},onInput:e=>{const t=e.target;t.style.height="auto",t.style.height=`${Math.min(t.scrollHeight,120)}px`}}),s.jsx("button",{onClick:G,disabled:!p.trim()&&!z,className:"p-2 bg-gradient-to-br from-purple-600 to-purple-700 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-lg hover:shadow-purple-500/50 transition-all",children:s.jsx(N,{size:18,className:"text-white"})})]})]})]}):s.jsxs("button",{onClick:()=>d(!0),className:"fixed right-4 bottom-4 w-14 h-14 bg-gradient-to-br from-purple-600 to-purple-700 rounded-full flex items-center justify-center text-white shadow-lg hover:shadow-purple-500/50 transition-all z-[9999] hover:scale-110",style:{zIndex:999999,position:"fixed"},children:[s.jsx(h,{size:24}),I>0&&s.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-xs font-bold",children:I})]})},pe=({currentUser:e,onNotificationClick:r,externalUnreadCount:a=0})=>{const[l,i]=x.useState([]),[n,o]=x.useState(0),[d,c]=x.useState(!1);x.useEffect(()=>{a>0&&o(a)},[a]),x.useEffect(()=>{"Notification"in window&&"default"===Notification.permission&&Notification.requestPermission()},[]);const u=x.useCallback(e=>{i(t=>t.some(t=>t.id===e.id)?t:[e,...t].slice(0,50)),o(e=>e+1)},[]),p=x.useCallback((e,t,s)=>{"Notification"in window&&"granted"===Notification.permission&&new Notification(e,{body:t,icon:s||"/icons/ios/128.png",badge:"/icons/ios/128.png",tag:"esther-reign-admin",requireInteraction:!1})},[]),m=x.useCallback(()=>{try{const e=window.AudioContext||window.webkitAudioContext;if(!e)return;const t=new e;"suspended"===t.state&&t.resume();const s=t.createOscillator(),r=t.createGain();s.connect(r),r.connect(t.destination),s.frequency.value=800,s.type="sine",r.gain.setValueAtTime(.3,t.currentTime),r.gain.exponentialRampToValueAtTime(.01,t.currentTime+.2),s.start(t.currentTime),s.stop(t.currentTime+.2),s.onended=()=>{t.close()}}catch(e){try{const e=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIGGW57+OeTQ8MT6Xh8LZjHAY4kdfyzHksBSR3x/DdkEAKFF606euoVRQKRp/g8r5sIQUrgc7y2Yk2CBhlue/jnk0PDE+l4fC2YxwGOJHX8sx5LAUkd8fw3ZBAC");e.volume=.3,e.play().catch(()=>{})}catch(t){}}},[]);x.useEffect(()=>{if(!e)return;const s=t.channel("admin_notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"admin_logins"},t=>{const s=t.new;if(s.user_id!==e.id){const e="artist"===s.user_role?"Esther Reign":"Editor",t={id:`login_${Date.now()}`,type:"login",title:`${e} logged in`,message:`${e} just logged into the admin panel`,timestamp:new Date,read:!1,userId:s.user_id};u(t),m(),p(`${e} logged in`,`${e} just logged into the admin panel`)}}).subscribe();return()=>{t.removeChannel(s)}},[e,m,p,u]),x.useEffect(()=>{if(!e)return;const s=t.channel("chat_notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages"},t=>{const s=t.new;if(s.sender_id!==e.id){const e=s.sender_name||"Someone",t={id:`message_${s.id}`,type:"message",title:`New message from ${e}`,message:s.message.substring(0,50)+(s.message.length>50?"...":""),timestamp:new Date(s.timestamp),read:!1,userId:s.sender_id};u(t),m(),p(`New message from ${e}`,s.message.substring(0,100))}}).subscribe();return()=>{t.removeChannel(s)}},[e,m,p,u]);const b=e=>{const t=(new Date).getTime()-e.getTime(),s=Math.floor(t/6e4);return s<1?"Just now":s<60?`${s}m ago`:s<1440?`${Math.floor(s/60)}h ago`:e.toLocaleDateString()},f=e=>{switch(e){case"login":return s.jsx(_,{size:18,className:"text-blue-400"});case"message":return s.jsx(h,{size:18,className:"text-purple-400"});default:return s.jsx(k,{size:18,className:"text-green-400"})}};return s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:()=>c(!d),className:"relative p-2 hover:bg-purple-500/20 rounded-lg transition-colors",children:[s.jsx(k,{size:20,className:"text-purple-300"}),n>0&&s.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full flex items-center justify-center text-xs font-bold text-white",children:n>9?"9+":n})]}),d&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>c(!1)}),s.jsxs("div",{className:"absolute right-0 top-12 w-80 md:w-96 bg-[#2d1b4e] backdrop-blur-xl rounded-2xl shadow-2xl border border-purple-500/30 z-50 max-h-[500px] flex flex-col",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-purple-500/30",children:[s.jsx("h3",{className:"text-lg font-bold text-white",children:"Notifications"}),n>0&&s.jsx("button",{onClick:()=>{i(e=>e.map(e=>({...e,read:!0}))),o(0)},className:"text-xs text-purple-300 hover:text-purple-200",children:"Mark all as read"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:0===l.length?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx(k,{size:48,className:"mx-auto mb-4 text-purple-400 opacity-50"}),s.jsx("p",{className:"text-purple-300",children:"No notifications"})]}):s.jsx("div",{className:"divide-y divide-purple-500/20",children:l.map(e=>s.jsx("div",{className:"p-4 hover:bg-purple-500/10 transition-colors cursor-pointer "+(e.read?"":"bg-purple-500/5"),onClick:()=>{var t;t=e.id,i(e=>e.map(e=>e.id===t?{...e,read:!0}:e)),o(e=>Math.max(0,e-1)),null==r||r(e),c(!1)},children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"flex-shrink-0 mt-1",children:f(e.type)}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsx("h4",{className:"text-sm font-semibold text-white",children:e.title}),!e.read&&s.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full flex-shrink-0 mt-1"})]}),s.jsx("p",{className:"text-xs text-purple-300 mt-1 line-clamp-2",children:e.message}),s.jsx("p",{className:"text-xs text-purple-400 mt-2",children:b(e.timestamp)})]}),s.jsx("button",{onClick:t=>{var s;t.stopPropagation(),s=e.id,i(e=>{const t=e.find(e=>e.id===s);return t&&!t.read&&o(e=>Math.max(0,e-1)),e.filter(e=>e.id!==s)})},className:"flex-shrink-0 p-1 hover:bg-purple-500/20 rounded transition-colors",children:s.jsx(g,{size:14,className:"text-purple-400"})})]})},e.id))})})]})]})]})},xe=({onVideoChange:e})=>{const[t,r]=x.useState([]),[d,c]=x.useState(null),[u,p]=x.useState(!1),[h,b]=x.useState(!0),[f,y]=x.useState(null),[v,w]=x.useState("link"),[N,k]=x.useState(!1),[_,E]=x.useState(0),[I,L]=x.useState(0),q=x.useRef(null);x.useEffect(()=>{M()},[]);const M=async()=>{b(!0);const e=await a();r(e),b(!1)},$=async()=>{if(null!==f)try{await o(t),null==e||e()}catch(s){await M()}y(null)};return h?s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):s.jsxs("div",{className:"p-6 bg-[#2d1b4e]/50 backdrop-blur-xl rounded-2xl border border-purple-500/20",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"Video Management"}),s.jsxs("button",{onClick:()=>{const e={id:`temp_${Date.now()}`,title:"",video_link:"",thumbnail_url:"",status:"pending",template_type:"default",order_index:t.length,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};c(e),p(!0)},className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all",children:[s.jsx(S,{size:20}),"Add Video"]})]}),s.jsxs("div",{className:"space-y-4",children:[t.map((a,l)=>s.jsx("div",{draggable:!0,onDragStart:()=>(e=>{y(e)})(l),onDragOver:e=>((e,s)=>{if(e.preventDefault(),null===f||f===s)return;const a=[...t],l=a[f];a.splice(f,1),a.splice(s,0,l);const i=a.map((e,t)=>({...e,order_index:t}));r(i),y(s)})(e,l),onDragEnd:$,className:"p-4 border border-purple-500/20 rounded-lg cursor-move transition-all bg-purple-500/10 hover:bg-purple-500/20 "+(f===l?"opacity-50":""),children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx(C,{size:20,className:"text-purple-300"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-semibold text-white",children:a.title||"Untitled Video"}),s.jsxs("p",{className:"text-sm text-purple-300",children:["Status: ",a.status," â€¢ Order: ",a.order_index]}),a.video_link&&s.jsxs("a",{href:a.video_link,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-sm text-purple-400 hover:text-purple-300 transition-colors",children:[s.jsx(z,{size:14}),"View Video"]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{const e=document.querySelector(".flex-1.overflow-y-auto");e&&L(e.scrollTop),c(a),p(!1)},className:"p-2 rounded hover:bg-purple-500/20 transition-colors",children:s.jsx(P,{size:16,className:"text-purple-300"})}),s.jsx("button",{onClick:()=>(async s=>{if(confirm("Are you sure you want to delete this video?"))try{await n(s)&&(r(t.filter(e=>e.id!==s)),null==e||e())}catch(a){alert("Failed to delete video. Please try again.")}})(a.id),className:"p-2 rounded hover:bg-red-500/20 transition-colors",children:s.jsx(j,{size:16,className:"text-red-400"})})]})]})},a.id)),0===t.length&&s.jsx("div",{className:"text-center py-8 text-purple-300",children:'No videos yet. Click "Add Video" to get started.'})]}),d&&m.createPortal(s.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-[200] flex items-center justify-center p-4",children:s.jsx("div",{className:"w-full max-w-md bg-[#2d1b4e] backdrop-blur-xl rounded-2xl shadow-xl border border-purple-500/30 max-h-[90vh] overflow-y-auto",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:u?"Add New Video":"Edit Video"}),s.jsx("button",{onClick:()=>{c(null),p(!1)},className:"p-1 rounded hover:bg-purple-500/20 transition-colors",children:s.jsx(g,{size:20,className:"text-purple-300"})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Title *"}),s.jsx("input",{type:"text",value:d.title,onChange:e=>c({...d,title:e.target.value}),className:"w-full px-3 py-2 bg-purple-500/10 border border-purple-500/30 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-white placeholder-purple-400",placeholder:"Enter video title"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2 text-purple-200",children:"Upload Method"}),s.jsxs("div",{className:"flex gap-2 mb-4",children:[s.jsxs("button",{type:"button",onClick:()=>w("link"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-all "+("link"===v?"bg-purple-600 text-white":"bg-purple-500/10 text-purple-300 hover:bg-purple-500/20 border border-purple-500/30"),children:[s.jsx(T,{size:16}),"Link"]}),s.jsxs("button",{type:"button",onClick:()=>w("file"),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 rounded-lg transition-all "+("file"===v?"bg-purple-600 text-white":"bg-purple-500/10 text-purple-300 hover:bg-purple-500/20 border border-purple-500/30"),children:[s.jsx(A,{size:16}),"Upload File (Max 200MB)"]})]})]}),"link"===v&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Video Link"}),s.jsx("input",{type:"url",value:d.video_link||"",onChange:e=>c({...d,video_link:e.target.value}),className:"w-full px-3 py-2 bg-purple-500/10 border border-purple-500/30 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-white placeholder-purple-400",placeholder:"https://youtube.com/watch?v=... or https://cloudinary.com/..."})]}),"file"===v&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Video File (Max 200MB)"}),s.jsx("input",{ref:q,type:"file",accept:"video/*",onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(!s)return;if(s.size>209715200)alert(`File size exceeds 200MB limit. Your file is ${(s.size/1048576).toFixed(2)}MB`);else{k(!0),E(0);try{(new FormData).append("file",s);const e=setInterval(()=>{E(t=>t>=90?(clearInterval(e),90):t+10)},200),t=URL.createObjectURL(s);setTimeout(()=>{clearInterval(e),E(100),c({...d,video_link:t}),k(!1),alert("Note: This is a temporary URL. In production, upload to Cloudinary or Supabase Storage for permanent storage.")},2e3)}catch(r){alert("Failed to upload video. Please try again or use a link instead."),k(!1),E(0)}}},className:"hidden"}),s.jsx("button",{type:"button",onClick:()=>{var e;return null==(e=q.current)?void 0:e.click()},disabled:N,className:"w-full px-4 py-3 border-2 border-dashed rounded-lg transition-all "+(N?"border-purple-400 bg-purple-500/10":"border-purple-500/30 bg-purple-500/10 hover:border-purple-500 hover:bg-purple-500/20"),children:N?s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-center gap-2 text-purple-300",children:[s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-purple-300"}),s.jsxs("span",{children:["Uploading... ",_,"%"]})]}),s.jsx("div",{className:"w-full h-2 rounded-full overflow-hidden bg-purple-500/20",children:s.jsx("div",{className:"h-full bg-gradient-to-r from-purple-600 to-purple-700 transition-all duration-300",style:{width:`${_}%`}})})]}):s.jsxs("div",{className:"flex flex-col items-center gap-2",children:[s.jsx(A,{size:24,className:"text-purple-300"}),s.jsx("span",{className:"text-purple-200",children:"Click to select video file"}),s.jsx("span",{className:"text-xs text-purple-400",children:"Max size: 200MB"})]})}),d.video_link&&"file"===v&&s.jsxs("p",{className:"mt-2 text-xs text-purple-400",children:["Video URL: ",d.video_link.substring(0,50),"..."]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Thumbnail URL"}),s.jsx("input",{type:"url",value:d.thumbnail_url||"",onChange:e=>c({...d,thumbnail_url:e.target.value}),className:"w-full px-3 py-2 bg-purple-500/10 border border-purple-500/30 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-white placeholder-purple-400",placeholder:"https://img.youtube.com/vi/..."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Status"}),s.jsxs("select",{value:d.status,onChange:e=>c({...d,status:e.target.value}),className:"w-full px-3 py-2 bg-purple-500/10 border border-purple-500/30 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 text-white",children:[s.jsx("option",{value:"pending",className:"bg-[#2d1b4e]",children:"Pending"}),s.jsx("option",{value:"completed",className:"bg-[#2d1b4e]",children:"Completed"})]})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:()=>{c(null),p(!1)},className:"flex-1 px-4 py-2 border border-purple-500/30 rounded-lg transition-colors text-purple-200 hover:bg-purple-500/20",children:"Cancel"}),s.jsxs("button",{onClick:async()=>{if(d)try{if(u){const{id:e,created_at:s,updated_at:a,...i}=d,n=await l(i);n&&r([...t,n])}else{await i(d.id,d)&&r(t.map(e=>e.id===d.id?d:e))}c(null),p(!1),null==e||e(),await M()}catch(s){alert("Failed to save video. Please try again.")}},disabled:!d.title.trim(),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(D,{size:16}),u?"Add Video":"Save Changes"]})]})]})})}),document.body)]})},me=({videoUpdates:e,loginFrequency:t,siteVisits:r})=>{const[a,l]=x.useState(!1);x.useEffect(()=>{setTimeout(()=>l(!0),100)},[]);const i=Math.max(...e.map(e=>e.value),...t.map(e=>e.value),...r.map(e=>e.value),1),n=(e,t,r,l)=>{if(0===e.length)return s.jsx("div",{className:"flex items-center justify-center h-48 text-purple-300",children:s.jsx("p",{children:"No data available"})});const n=e.map((t,s)=>({x:s/(e.length-1||1)*100,y:100-t.value/i*80})),o=n.map((e,t)=>`${0===t?"M":"L"} ${e.x},${e.y}`).join(" "),d=`${o} L ${n[n.length-1].x},100 L 0,100 Z`;return s.jsxs("div",{className:"relative h-48",children:[s.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:r,x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[s.jsx("stop",{offset:"0%",stopColor:t,stopOpacity:"0.4"}),s.jsx("stop",{offset:"100%",stopColor:t,stopOpacity:"0.05"})]})}),s.jsx("path",{d:d,fill:`url(#${r})`,className:a?"animate-fade-in":"opacity-0",style:{animation:a?"drawPath 1.5s ease-out forwards":"none",strokeDasharray:a?"0":"1000",strokeDashoffset:a?"0":"1000"}}),s.jsx("path",{d:o,fill:"none",stroke:t,strokeWidth:"0.8",strokeLinecap:"round",strokeLinejoin:"round",className:a?"animate-fade-in":"opacity-0",style:{animation:a?"drawLine 1.5s ease-out forwards":"none",strokeDasharray:a?"1000":"0",strokeDashoffset:a?"0":"1000"}}),n.map((e,r)=>s.jsxs("g",{children:[s.jsx("circle",{cx:e.x,cy:e.y,r:"1.5",fill:t,className:a?"animate-scale-in":"opacity-0",style:{animation:a?`fadeInScale 0.3s ease-out ${.5+.1*r}s forwards`:"none"}}),s.jsx("circle",{cx:e.x,cy:e.y,r:"3",fill:t,fillOpacity:"0.2",className:a?"animate-pulse":"opacity-0",style:{animation:a?`fadeInScale 0.3s ease-out ${.5+.1*r}s forwards, pulse 2s ease-in-out infinite ${1+.1*r}s`:"none"}})]},r))]}),s.jsx("div",{className:"absolute bottom-0 left-0 right-0 flex justify-between text-xs text-purple-300 px-2",children:e.map((e,t)=>{const r=new Date(e.date).toLocaleDateString("en-US",{month:"short",day:"numeric"});return s.jsx("span",{className:"transform -rotate-45 origin-left",style:{opacity:a?1:0,transition:`opacity 0.3s ${.8+.1*t}s`},children:r},t)})})]})};return s.jsxs(s.Fragment,{children:[s.jsx("style",{children:"\n        @keyframes drawLine {\n          to {\n            stroke-dashoffset: 0;\n            opacity: 1;\n          }\n        }\n        @keyframes drawPath {\n          to {\n            opacity: 1;\n          }\n        }\n        @keyframes fadeInScale {\n          from {\n            opacity: 0;\n            transform: scale(0);\n          }\n          to {\n            opacity: 1;\n            transform: scale(1);\n          }\n        }\n        @keyframes pulse {\n          0%, 100% {\n            opacity: 0.2;\n            transform: scale(1);\n          }\n          50% {\n            opacity: 0.4;\n            transform: scale(1.2);\n          }\n        }\n      "}),s.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/10 backdrop-blur-xl rounded-2xl p-6 border border-purple-500/20",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-10 h-10 bg-purple-500/20 rounded-xl flex items-center justify-center",children:s.jsx(f,{size:20,className:"text-purple-400"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-semibold text-white",children:"Video Updates"}),s.jsx("p",{className:"text-xs text-purple-300",children:"Last 7 days"})]})]}),s.jsx("div",{className:"mb-2",children:s.jsx("p",{className:"text-2xl font-black text-white",children:e.reduce((e,t)=>e+t.value,0)})}),n(e,"#9333ea","gradient-purple")]}),s.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/10 backdrop-blur-xl rounded-2xl p-6 border border-blue-500/20",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-500/20 rounded-xl flex items-center justify-center",children:s.jsx(E,{size:20,className:"text-blue-400"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-semibold text-white",children:"Login Frequency"}),s.jsx("p",{className:"text-xs text-blue-300",children:"Last 7 days"})]})]}),s.jsx("div",{className:"mb-2",children:s.jsx("p",{className:"text-2xl font-black text-white",children:t.reduce((e,t)=>e+t.value,0)})}),n(t,"#3b82f6","gradient-blue")]}),s.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-green-600/10 backdrop-blur-xl rounded-2xl p-6 border border-green-500/20 md:col-span-2 lg:col-span-1",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center",children:s.jsx(I,{size:20,className:"text-green-400"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-sm font-semibold text-white",children:"Site Visits"}),s.jsx("p",{className:"text-xs text-green-300",children:"Last 7 days"})]})]}),s.jsx("div",{className:"mb-2",children:s.jsx("p",{className:"text-2xl font-black text-white",children:r.reduce((e,t)=>e+t.value,0)})}),n(r,"#10b981","gradient-green")]})]})]})},he=()=>{const[e,r]=x.useState([]),[a,l]=x.useState(!1),i=e=>{r(t=>[...t,`${(new Date).toLocaleTimeString()}: ${e}`])};return s.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg max-w-2xl mx-auto",children:[s.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Storage Diagnostic Tool"}),s.jsx("button",{onClick:async()=>{var e,s;r([]),l(!0);try{i("ðŸ” Starting diagnostics..."),i("Test 1: Checking Supabase connection...");const{data:{session:r}}=await t.auth.getSession();i("âœ“ Auth session: "+(r?"Active":"None")),r&&i(`âœ“ User: ${r.user.email}`),i("\nTest 2: Listing storage buckets...");const{data:a,error:l}=await t.storage.listBuckets();if(l)i(`âœ— Error listing buckets: ${l.message}`);else{i(`âœ“ Found ${(null==a?void 0:a.length)||0} bucket(s)`),null==a||a.forEach(e=>{i(`  - ${e.name} (public: ${e.public})`)});const e=null==a?void 0:a.find(e=>"media"===e.name);e?(i("âœ“ Media bucket found!"),i(`  - Public: ${e.public}`),i(`  - Created: ${new Date(e.created_at).toLocaleString()}`)):i("âœ— Media bucket NOT found!")}i("\nTest 3: Testing policy access...");const n=new File(["test"],"test.txt",{type:"text/plain"}),o=`test/${Date.now()}-test.txt`,{data:d,error:c}=await t.storage.from("media").upload(o,n);c?(i(`âœ— Upload test failed: ${c.message}`),i(`  Error code: ${c.statusCode||"N/A"}`),(null==(e=c.message)?void 0:e.includes("RLS"))||(null==(s=c.message)?void 0:s.includes("row-level security"))?(i("âš ï¸ RLS Policy Issue Detected!"),i("  â†’ You need to create an INSERT policy for storage.objects"),i("  â†’ Policy should allow: (bucket_id = 'media'::text)")):401===c.statusCode?(i("âš ï¸ Authentication Issue!"),i("  â†’ Try logging out and back in")):403===c.statusCode&&(i("âš ï¸ Permission Denied!"),i("  â†’ Check your RLS policies"))):(i("âœ“ Upload test successful!"),i(`  Path: ${d.path}`),await t.storage.from("media").remove([o]),i("âœ“ Test file cleaned up")),i("\nTest 4: Testing read access...");const{data:u,error:p}=await t.storage.from("media").list("profile",{limit:1});p?i(`âœ— Read test failed: ${p.message}`):(i("âœ“ Read access works!"),i(`  Found ${(null==u?void 0:u.length)||0} file(s) in profile folder`)),i("\nâœ… Diagnostics complete!")}catch(a){i(`\nâœ— Fatal error: ${a.message}`)}finally{l(!1)}},disabled:a,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:a?"Running Tests...":"Run Diagnostics"}),e.length>0&&s.jsx("div",{className:"mt-4 p-4 bg-gray-100 rounded max-h-96 overflow-y-auto",children:s.jsx("pre",{className:"text-sm whitespace-pre-wrap font-mono",children:e.join("\n")})})]})},ge=()=>{const{profilePicture:t,updateProfilePicture:a}=e(),[l,i]=x.useState({hero_image:"/Estherreign.jpg",about_image:"/IMG-20250915-WA0023.jpg",about_text:"I am an emerging gospel artist with a deep passion for worship and praise...",phone:"+234 818 019 4269",email:"contact@estherreign.com",location:"Lagos, Nigeria",social_links:{instagram:"https://instagram.com/estherreign",youtube:"https://youtube.com/@estherreign",tiktok:"https://tiktok.com/@estherreign",facebook:"https://facebook.com/estherreign",twitter:"https://twitter.com/estherreign"}}),[n,o]=x.useState(""),[c,u]=x.useState(!1),[p,m]=x.useState({hero:!1,about:!1});x.useEffect(()=>{h()},[]);const h=async()=>{const{getSettings:e}=await r(async()=>{const{getSettings:e}=await import("./index-Bj3hcO3F.js").then(e=>e.h);return{getSettings:e}},__vite__mapDeps([0,1,2,3])),t=await e();t&&(i({hero_image:t.hero_image||"/Estherreign.jpg",about_image:t.about_image||"/IMG-20250915-WA0023.jpg",about_text:t.about_text||"I am an emerging gospel artist with a deep passion for worship and praise...",phone:t.contact_phone||"+234 818 019 4269",email:t.contact_email||"contact@estherreign.com",location:"Lagos, Nigeria",social_links:t.social_links||{instagram:"https://instagram.com/estherreign",youtube:"https://youtube.com/@estherreign",tiktok:"https://tiktok.com/@estherreign",facebook:"https://facebook.com/estherreign",twitter:"https://twitter.com/estherreign"}}),o(t.hero_description||"Lifting voices in worship through powerful gospel music. Experience the presence of God through every note."))},g=async(e,t)=>{var s;const r=null==(s=t.target.files)?void 0:s[0];if(r)if(r.size>5242880)alert("Image size should be less than 5MB");else try{m(t=>({...t,[e]:!0}));const t=await d(r,e);if(!t)return void alert("Upload failed. Please try again.");i("hero"===e?{...l,hero_image:t}:{...l,about_image:t}),alert('Image uploaded! Remember to hit "Save All Settings".')}catch(a){alert("Upload failed. Please try again.")}finally{m(t=>({...t,[e]:!1}))}};return s.jsxs("div",{className:"space-y-8",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-3xl font-black mb-2 text-white",children:"Site Settings"}),s.jsx("p",{className:"text-gray-400",children:"Manage your website content and appearance"})]}),s.jsxs("div",{className:"grid gap-6",children:[s.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-blue-500/10 backdrop-blur-xl rounded-2xl p-6 border border-purple-500/20",children:[s.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"Profile Picture"}),s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsx("div",{className:"relative",children:t?s.jsx("img",{src:t,alt:"Profile",className:"w-24 h-24 rounded-xl object-cover shadow-lg"}):s.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-purple-600 to-blue-600 rounded-xl flex items-center justify-center shadow-lg",children:s.jsx("span",{className:"text-white font-black text-4xl",children:"E"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Upload Profile Picture"}),s.jsx("input",{type:"file",accept:"image/*",disabled:c,onChange:async e=>{var t;const s=null==(t=e.target.files)?void 0:t[0];if(s)if(s.size>5242880)alert("Image size should be less than 5MB");else if(s.type.startsWith("image/"))try{u(!0);const e=await d(s,"profile");if(!e)return void alert("Upload failed: No URL returned.");const t=e.startsWith("data:image");a(e);const r=localStorage.getItem("admin_session");if(r){const t=JSON.parse(r);t.user.profilePicture=e,localStorage.setItem("admin_session",JSON.stringify(t))}t?alert("Profile picture updated successfully!\n\nâœ“ Saved to database (will sync across all devices)\nâœ“ Note: Using base64 storage (Supabase Storage not available, but this works perfectly fine!)"):alert("Profile picture updated successfully!\n\nâœ“ Saved to database (will sync across all devices)")}catch(r){const e=(null==r?void 0:r.message)||(null==r?void 0:r.toString())||"Unknown error occurred";alert(`Upload failed: ${e}\n\nPlease check the browser console (F12) for more details.`)}finally{u(!1)}else alert("Please select a valid image file (JPG, PNG, etc.)")},className:"w-full px-4 py-3 bg-gray-800 border border-purple-500/20 rounded-xl focus:outline-none focus:border-purple-500 text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-gradient-to-r file:from-purple-600 file:to-blue-600 file:text-white hover:file:shadow-lg file:cursor-pointer "+(c?"opacity-60 cursor-not-allowed":"")}),s.jsx("p",{className:"text-xs text-gray-400 mt-2",children:c?"Uploading image...":"Max size: 5MB. Recommended: Square image (500x500px)"})]})]})]}),s.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-sm border border-purple-500/20 rounded-2xl p-6",children:[s.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"Images"}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Hero Image"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("input",{type:"file",accept:"image/*",disabled:p.hero,onChange:e=>g("hero",e),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-purple-600 file:text-white hover:file:bg-purple-700 file:cursor-pointer "+(p.hero?"opacity-60 cursor-not-allowed":"")}),s.jsx("input",{type:"url",value:l.hero_image.startsWith("data:")?"":l.hero_image,onChange:e=>i({...l,hero_image:e.target.value}),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white",placeholder:"Or paste image URL..."})]}),l.hero_image&&s.jsx("img",{src:l.hero_image,alt:"Hero",className:"mt-2 w-full h-32 object-cover rounded-lg"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"About Image"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("input",{type:"file",accept:"image/*",disabled:p.about,onChange:e=>g("about",e),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-purple-600 file:text-white hover:file:bg-purple-700 file:cursor-pointer "+(p.about?"opacity-60 cursor-not-allowed":"")}),s.jsx("input",{type:"url",value:l.about_image.startsWith("data:")?"":l.about_image,onChange:e=>i({...l,about_image:e.target.value}),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white",placeholder:"Or paste image URL..."})]}),l.about_image&&s.jsx("img",{src:l.about_image,alt:"About",className:"mt-2 w-full h-32 object-cover rounded-lg"})]})]})]}),s.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-sm border border-purple-500/20 rounded-2xl p-6",children:[s.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"Hero Section"}),s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Hero Description"}),s.jsx("textarea",{value:n,onChange:e=>o(e.target.value),rows:3,className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white resize-none",placeholder:"Brief description for hero section..."})]}),s.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-sm border border-purple-500/20 rounded-2xl p-6",children:[s.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"About Section"}),s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"About Text"}),s.jsx("textarea",{value:l.about_text,onChange:e=>i({...l,about_text:e.target.value}),rows:6,className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white resize-none",placeholder:"Tell your story..."})]}),s.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-sm border border-purple-500/20 rounded-2xl p-6",children:[s.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"Contact Information"}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Phone"}),s.jsx("input",{type:"tel",value:l.phone,onChange:e=>i({...l,phone:e.target.value}),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white",placeholder:"+234..."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Email"}),s.jsx("input",{type:"email",value:l.email,onChange:e=>i({...l,email:e.target.value}),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white",placeholder:"contact@..."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Location"}),s.jsx("input",{type:"text",value:l.location,onChange:e=>i({...l,location:e.target.value}),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white",placeholder:"City, Country"})]})]})]}),s.jsxs("div",{className:"bg-gray-900/50 backdrop-blur-sm border border-purple-500/20 rounded-2xl p-6",children:[s.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"Social Media Links"}),s.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Instagram"}),s.jsx("input",{type:"url",value:l.social_links.instagram,onChange:e=>i({...l,social_links:{...l.social_links,instagram:e.target.value}}),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white",placeholder:"https://instagram.com/..."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"YouTube"}),s.jsx("input",{type:"url",value:l.social_links.youtube,onChange:e=>i({...l,social_links:{...l.social_links,youtube:e.target.value}}),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white",placeholder:"https://youtube.com/..."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"TikTok"}),s.jsx("input",{type:"url",value:l.social_links.tiktok,onChange:e=>i({...l,social_links:{...l.social_links,tiktok:e.target.value}}),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white",placeholder:"https://tiktok.com/..."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Facebook"}),s.jsx("input",{type:"url",value:l.social_links.facebook,onChange:e=>i({...l,social_links:{...l.social_links,facebook:e.target.value}}),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white",placeholder:"https://facebook.com/..."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-2 text-white",children:"Twitter"}),s.jsx("input",{type:"url",value:l.social_links.twitter,onChange:e=>i({...l,social_links:{...l.social_links,twitter:e.target.value}}),className:"w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-xl focus:outline-none focus:border-purple-500 text-white",placeholder:"https://twitter.com/..."})]})]})]}),s.jsxs("button",{onClick:async()=>{try{const{updateSettings:e}=await r(async()=>{const{updateSettings:e}=await import("./index-Bj3hcO3F.js").then(e=>e.h);return{updateSettings:e}},__vite__mapDeps([0,1,2,3]));await e({hero_image:l.hero_image,hero_description:n,about_image:l.about_image,about_text:l.about_text,contact_email:l.email,contact_phone:l.phone,social_links:l.social_links})?(alert("Settings saved successfully! Changes will appear immediately."),window.dispatchEvent(new Event("storage"))):alert("Failed to save settings. Please try again.")}catch(e){alert("Error saving settings. Please check console for details.")}},className:"w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-4 rounded-xl font-semibold transition-all hover:shadow-lg hover:shadow-purple-500/50 flex items-center justify-center gap-2",children:[s.jsx(D,{size:20}),"Save All Settings"]}),s.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-cyan-500/10 backdrop-blur-xl rounded-2xl p-6 border border-blue-500/20",children:[s.jsx("h3",{className:"text-xl font-bold mb-4 text-white",children:"Storage Diagnostic Tool"}),s.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"If uploads are failing, use this tool to diagnose the issue. It will check your bucket configuration, policies, and permissions."}),s.jsx(he,{})]})]})]})};(()=>{const e=localStorage.getItem("current_sync_code")||Math.random().toString(36).substring(2,8).toUpperCase();localStorage.getItem("current_sync_code")||localStorage.setItem("current_sync_code",e),window.location.origin,window.location.pathname})();const be=()=>{const[e,r]=x.useState([]),[a,l]=x.useState(!0),[i,n]=x.useState(null),[o,d]=x.useState(""),[c,u]=x.useState("all"),[p,h]=x.useState(0);x.useEffect(()=>{b()},[]);const b=async()=>{l(!0);try{const{data:e,error:s}=await t.from("fan_messages").select("*").order("created_at",{ascending:!1});if(s)throw s;r(e||[])}catch(e){}l(!1)},f=e.filter(e=>"all"===c||("unread"===c?"unread"===e.status:e.message_type===c)),y=e.filter(e=>"unread"===e.status).length;return a?s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-3xl font-black text-white",children:"Fan Messages"}),s.jsxs("p",{className:"text-sm text-purple-300",children:[y," unread messages"]})]}),s.jsx("div",{className:"flex gap-2",children:["all","unread","prayer_request","testimony"].map(e=>s.jsx("button",{onClick:()=>u(e),className:"px-4 py-2 rounded-lg text-sm font-medium capitalize transition-all "+(c===e?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":"bg-purple-500/10 text-purple-300 hover:bg-purple-500/20 border border-purple-500/30"),children:e.replace("_"," ")},e))})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[f.map(a=>{const l=(o=a.message_type,{prayer_request:q,testimony:M,song_request:$,booking_inquiry:R,general:L}[o]||L);var o;const d=(e=>({prayer_request:"pink",testimony:"green",song_request:"purple",booking_inquiry:"blue",general:"gray"}[e]||"gray"))(a.message_type);return s.jsx("div",{className:"p-6 rounded-xl border transition-all cursor-pointer "+("unread"===a.status?"bg-purple-900/30 border-purple-500/50":"bg-purple-500/10 border-purple-500/20"),onClick:()=>{const s=document.querySelector(".flex-1.overflow-y-auto");s&&h(s.scrollTop),n(a),"unread"===a.status&&(async s=>{try{const{error:a}=await t.from("fan_messages").update({status:"read"}).eq("id",s);if(a)throw a;r(e.map(e=>e.id===s?{...e,status:"read"}:e))}catch(a){}})(a.id)},children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("div",{className:`p-3 rounded-lg bg-${d}-100`,children:s.jsx(l,{size:24,className:`text-${d}-600`})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium capitalize bg-${d}-100 text-${d}-700`,children:a.message_type.replace("_"," ")}),"unread"===a.status&&s.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-700",children:"New"}),a.is_prayed_for&&s.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700",children:"ðŸ™ Prayed"}),a.is_featured&&s.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium bg-yellow-100 text-yellow-700",children:"â­ Featured"})]}),s.jsx("h3",{className:"text-lg font-bold mb-1 text-white",children:a.subject||"No Subject"}),s.jsxs("p",{className:"text-sm mb-2 text-purple-300",children:["From: ",a.is_anonymous?"Anonymous":a.from_name]}),s.jsx("p",{className:"text-sm line-clamp-2 text-purple-200",children:a.message}),s.jsx("p",{className:"text-xs mt-2 text-purple-400",children:new Date(a.created_at).toLocaleString()})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:["prayer_request"===a.message_type&&!a.is_prayed_for&&s.jsx("button",{onClick:s=>{s.stopPropagation(),(async s=>{try{const{error:a}=await t.from("fan_messages").update({is_prayed_for:!0}).eq("id",s);if(a)throw a;r(e.map(e=>e.id===s?{...e,is_prayed_for:!0}:e))}catch(a){}})(a.id)},className:"px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700",children:"Mark Prayed"}),s.jsx("button",{onClick:s=>{s.stopPropagation(),(async s=>{if(confirm("Are you sure you want to delete this message? This action cannot be undone."))try{const{error:a}=await t.from("fan_messages").delete().eq("id",s);if(a)throw a;r(e.filter(e=>e.id!==s)),(null==i?void 0:i.id)===s&&n(null),alert("Message deleted successfully")}catch(a){alert("Failed to delete message")}})(a.id)},className:"p-2 rounded hover:bg-red-500/20 transition-colors",title:"Delete message",children:s.jsx(j,{size:18,className:"text-red-400 hover:text-red-300"})})]})]})},a.id)}),0===f.length&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(L,{size:48,className:"mx-auto mb-4 text-purple-400"}),s.jsx("p",{className:"text-lg font-medium text-purple-300",children:"No messages yet"})]})]})]}),i&&m.createPortal(s.jsx("div",{className:"message-modal-overlay fixed inset-0 bg-black/70 backdrop-blur-sm z-[200] overflow-y-auto",children:s.jsx("div",{className:"flex justify-center",style:{paddingTop:`${p}px`,paddingBottom:"2rem"},children:s.jsx("div",{className:"w-full max-w-2xl bg-[#2d1b4e] backdrop-blur-xl rounded-2xl shadow-xl border border-purple-500/30",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:i.subject||"Message Details"}),s.jsx("button",{onClick:()=>n(null),className:"p-1 rounded hover:bg-purple-500/20 transition-colors",children:s.jsx(g,{size:20,className:"text-purple-300"})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"From"}),s.jsxs("p",{className:"text-white",children:[i.is_anonymous?"Anonymous":i.from_name,i.from_email&&` (${i.from_email})`]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Message"}),s.jsx("p",{className:"whitespace-pre-wrap text-purple-100",children:i.message})]}),i.response&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Your Response"}),s.jsx("p",{className:"whitespace-pre-wrap text-purple-100",children:i.response})]}),"responded"!==i.status&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Send Response"}),s.jsx("textarea",{value:o,onChange:e=>d(e.target.value),rows:4,className:"w-full px-3 py-2 bg-purple-500/10 border border-purple-500/30 rounded-lg resize-none text-white placeholder-purple-400 focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Type your response..."}),s.jsxs("button",{onClick:async()=>{if(i&&o.trim())try{const{error:s}=await t.from("fan_messages").update({status:"responded",response:o,responded_at:(new Date).toISOString()}).eq("id",i.id);if(s)throw s;r(e.map(e=>e.id===i.id?{...e,status:"responded",response:o,responded_at:(new Date).toISOString()}:e)),n(null),d(""),alert("Response sent!")}catch(s){alert("Failed to send response")}},disabled:!o.trim(),className:"mt-2 flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 disabled:opacity-50",children:[s.jsx(N,{size:16}),"Send Response"]})]})]}),s.jsx("div",{className:"flex gap-3 mt-6",children:s.jsx("button",{onClick:()=>n(null),className:"flex-1 px-4 py-2 border border-purple-500/30 rounded-lg text-purple-200 hover:bg-purple-500/20 transition-colors",children:"Close"})})]})})})}),document.body)]})},fe=()=>{const[e,r]=x.useState([]),[a,l]=x.useState(!0),[i,n]=x.useState(null),[o,d]=x.useState("all"),[c,u]=x.useState("votes");x.useEffect(()=>{p()},[]);const p=async()=>{l(!0);try{const{data:e,error:s}=await t.from("song_requests").select("*").order("votes",{ascending:!1});if(s)throw s;r(e||[])}catch(e){}l(!1)},h=async(s,a)=>{try{const{error:l}=await t.from("song_requests").update({status:a,updated_at:(new Date).toISOString()}).eq("id",s);if(l)throw l;r(e.map(e=>e.id===s?{...e,status:a}:e))}catch(l){}},b=e=>({new:"blue",considering:"yellow",planned:"purple",recording:"orange",completed:"green",declined:"red"}[e]||"gray"),f=[...e.filter(e=>"all"===o||e.status===o)].sort((e,t)=>"votes"===c?t.votes-e.votes:"priority"===c?t.priority_score-e.priority_score:new Date(t.created_at).getTime()-new Date(e.created_at).getTime());return a?s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-3xl font-black text-white",children:"Song Requests"}),s.jsx("p",{className:"text-sm text-purple-300",children:"Manage fan song requests"})]}),s.jsx("div",{className:"flex gap-2",children:["all","new","considering","planned"].map(e=>s.jsx("button",{onClick:()=>d(e),className:"px-4 py-2 rounded-lg text-sm font-medium capitalize transition-all "+(o===e?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":"bg-purple-500/10 text-purple-300 hover:bg-purple-500/20 border border-purple-500/30"),children:e},e))})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("span",{className:"text-sm text-purple-300",children:"Sort by:"}),["votes","recent","priority"].map(e=>s.jsx("button",{onClick:()=>u(e),className:"px-3 py-1 rounded text-sm font-medium capitalize "+(c===e?"bg-purple-600 text-white":"bg-purple-500/10 text-purple-300 border border-purple-500/30"),children:e},e))]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[f.map(a=>{return s.jsxs("div",{className:"p-6 rounded-xl border transition-all bg-black/40 backdrop-blur-xl border-purple-500/30 hover:border-purple-500/50",children:[s.jsxs("div",{className:"flex items-start justify-between mb-3",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx($,{size:20,className:"text-purple-500"}),s.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium capitalize bg-${b(a.status)}-100 text-${b(a.status)}-700`,children:a.status}),a.difficulty&&s.jsx("span",{className:"text-xs font-medium "+(l=a.difficulty,"easy"===l?"text-green-500":"medium"===l?"text-yellow-500":"hard"===l?"text-red-500":"text-gray-500"),children:a.difficulty})]}),s.jsx("h3",{className:"text-lg font-bold mb-1 text-white",children:a.song_title}),a.original_artist&&s.jsxs("p",{className:"text-sm mb-2 text-purple-300",children:["by ",a.original_artist]}),a.reason&&s.jsxs("p",{className:"text-sm mb-3 text-purple-200",children:['"',a.reason,'"']}),a.requested_by_name&&s.jsxs("p",{className:"text-xs mb-2 text-purple-400",children:["Requested by ",a.requested_by_name]}),a.genre_tags&&a.genre_tags.length>0&&s.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:a.genre_tags.map((e,t)=>s.jsx("span",{className:"px-2 py-1 rounded text-xs bg-purple-500/20 text-purple-300 border border-purple-500/30",children:e},t))}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("button",{onClick:()=>(async s=>{try{const a=e.find(e=>e.id===s);if(!a)return;const{error:l}=await t.from("song_requests").update({votes:a.votes+1,priority_score:a.priority_score+1,updated_at:(new Date).toISOString()}).eq("id",s);if(l)throw l;r(e.map(e=>e.id===s?{...e,votes:e.votes+1,priority_score:e.priority_score+1}:e))}catch(a){}})(a.id),className:"flex items-center gap-2 text-sm text-purple-600 hover:text-purple-700",children:[s.jsx(F,{size:16}),s.jsx("span",{className:"font-bold",children:a.votes}),s.jsx("span",{children:"votes"})]}),a.priority_score>0&&s.jsxs("div",{className:"flex items-center gap-1 text-sm text-yellow-600",children:[s.jsx(O,{size:16}),s.jsx("span",{children:a.priority_score})]})]})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("button",{onClick:()=>n(a),className:"p-2 rounded hover:bg-purple-500/20 transition-colors",children:s.jsx(P,{size:16,className:"text-purple-300"})}),s.jsx("button",{onClick:()=>(async s=>{if(confirm("Delete this song request?"))try{const{error:a}=await t.from("song_requests").delete().eq("id",s);if(a)throw a;r(e.filter(e=>e.id!==s))}catch(a){}})(a.id),className:"p-2 rounded hover:bg-red-100",children:s.jsx(j,{size:16,className:"text-red-600"})})]})]}),s.jsxs("div",{className:"flex gap-2 mt-4",children:["new"===a.status&&s.jsx("button",{onClick:()=>h(a.id,"considering"),className:"flex-1 px-3 py-1 text-xs bg-yellow-600 text-white rounded hover:bg-yellow-700",children:"Consider"}),"considering"===a.status&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>h(a.id,"planned"),className:"flex-1 px-3 py-1 text-xs bg-purple-600 text-white rounded hover:bg-purple-700",children:"Plan"}),s.jsx("button",{onClick:()=>h(a.id,"declined"),className:"flex-1 px-3 py-1 text-xs bg-red-600 text-white rounded hover:bg-red-700",children:"Decline"})]}),"planned"===a.status&&s.jsx("button",{onClick:()=>h(a.id,"recording"),className:"flex-1 px-3 py-1 text-xs bg-orange-600 text-white rounded hover:bg-orange-700",children:"Start Recording"}),"recording"===a.status&&s.jsx("button",{onClick:()=>h(a.id,"completed"),className:"flex-1 px-3 py-1 text-xs bg-green-600 text-white rounded hover:bg-green-700",children:"Mark Complete"})]})]},a.id);var l}),0===f.length&&s.jsxs("div",{className:"col-span-2 text-center py-12",children:[s.jsx($,{size:48,className:"mx-auto mb-4 text-purple-500/50"}),s.jsx("p",{className:"text-lg font-medium text-purple-300",children:"No song requests yet"})]})]}),i&&m.createPortal(s.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-[200] flex items-center justify-center p-4",children:s.jsx("div",{className:"w-full max-w-lg bg-black/95 backdrop-blur-xl rounded-lg shadow-xl max-h-[90vh] overflow-y-auto border border-purple-500/30",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:"Edit Song Request"}),s.jsx("button",{onClick:()=>n(null),className:"p-1 rounded hover:bg-purple-500/20 transition-colors",children:s.jsx(g,{size:20,className:"text-purple-300"})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Status"}),s.jsxs("select",{value:i.status,onChange:e=>n({...i,status:e.target.value}),className:"w-full px-3 py-2 border rounded-lg bg-black/50 border-purple-500/30 text-white focus:outline-none focus:border-purple-500",children:[s.jsx("option",{value:"new",children:"New"}),s.jsx("option",{value:"considering",children:"Considering"}),s.jsx("option",{value:"planned",children:"Planned"}),s.jsx("option",{value:"recording",children:"Recording"}),s.jsx("option",{value:"completed",children:"Completed"}),s.jsx("option",{value:"declined",children:"Declined"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Difficulty"}),s.jsxs("select",{value:i.difficulty||"",onChange:e=>n({...i,difficulty:e.target.value}),className:"w-full px-3 py-2 border rounded-lg bg-black/50 border-purple-500/30 text-white focus:outline-none focus:border-purple-500",children:[s.jsx("option",{value:"",children:"Not set"}),s.jsx("option",{value:"easy",children:"Easy"}),s.jsx("option",{value:"medium",children:"Medium"}),s.jsx("option",{value:"hard",children:"Hard"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Priority Score"}),s.jsx("input",{type:"number",value:i.priority_score,onChange:e=>n({...i,priority_score:Number(e.target.value)}),className:"w-full px-3 py-2 border rounded-lg bg-black/50 border-purple-500/30 text-white focus:outline-none focus:border-purple-500"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Estimated Production Days"}),s.jsx("input",{type:"number",value:i.estimated_production_days||"",onChange:e=>n({...i,estimated_production_days:Number(e.target.value)||void 0}),className:"w-full px-3 py-2 border rounded-lg bg-black/50 border-purple-500/30 text-white focus:outline-none focus:border-purple-500",placeholder:"e.g., 7"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"YouTube Reference"}),s.jsx("input",{type:"url",value:i.youtube_reference_url||"",onChange:e=>n({...i,youtube_reference_url:e.target.value}),className:"w-full px-3 py-2 border rounded-lg bg-black/50 border-purple-500/30 text-white focus:outline-none focus:border-purple-500",placeholder:"https://youtube.com/..."})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-purple-200",children:"Notes"}),s.jsx("textarea",{value:i.notes||"",onChange:e=>n({...i,notes:e.target.value}),rows:4,className:"w-full px-3 py-2 border rounded-lg resize-none bg-black/50 border-purple-500/30 text-white focus:outline-none focus:border-purple-500",placeholder:"Add notes about this request..."})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:()=>n(null),className:"flex-1 px-4 py-2 border rounded-lg border-purple-500/30 text-purple-300 hover:bg-purple-500/20 transition-colors",children:"Cancel"}),s.jsxs("button",{onClick:async()=>{if(i)try{const{error:s}=await t.from("song_requests").update(i).eq("id",i.id);if(s)throw s;r(e.map(e=>e.id===i.id?i:e)),n(null)}catch(s){alert("Failed to save request")}},className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700",children:[s.jsx(D,{size:16}),"Save Changes"]})]})]})})}),document.body)]})},ye=()=>{const{theme:e}=c(),[r,a]=x.useState([]),[l,i]=x.useState(!0),[n,o]=x.useState(null),[d,u]=x.useState(!1),[p,h]=x.useState("all");x.useState("list"),x.useEffect(()=>{b()},[]);const b=async()=>{i(!0);try{const{data:e,error:s}=await t.from("content_calendar").select("*").order("target_publish_date",{ascending:!0});if(s)throw s;a(e||[])}catch(e){}i(!1)},f=e=>({idea:"gray",planning:"blue",recording:"purple",editing:"yellow",review:"orange",scheduled:"green",published:"emerald",cancelled:"red"}[e]||"gray"),y=r.filter(e=>"all"===p||("upcoming"===p?e.target_publish_date&&new Date(e.target_publish_date)>new Date:"in-progress"!==p||["planning","recording","editing","review"].includes(e.status)));return l?s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-3xl font-black text-white",children:"Content Calendar"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Plan and schedule your content"})]}),s.jsxs("div",{className:"flex gap-2",children:[["all","upcoming","in-progress"].map(t=>s.jsx("button",{onClick:()=>h(t),className:"px-4 py-2 rounded-lg text-sm font-medium capitalize transition-all "+(p===t?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":"dark"===e?"bg-gray-800 text-gray-100 hover:bg-gray-700":"bg-black text-gray-100 hover:bg-gray-900"),children:t.replace("-"," ")},t)),s.jsxs("button",{onClick:()=>{const e={id:"",title:"",content_type:"cover",platforms:[],status:"idea",priority:"medium",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};o(e),u(!0)},className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all",children:[s.jsx(S,{size:20}),"Add Content"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[y.map(l=>{const i=l.target_publish_date?Math.ceil((new Date(l.target_publish_date).getTime()-(new Date).getTime())/864e5):null;return s.jsx("div",{className:"p-6 rounded-xl border transition-all "+("dark"===e?"bg-gray-800 border-gray-700":"bg-gray-900/80 border-purple-500/20"),children:s.jsxs("div",{className:"flex items-start justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("span",{className:"text-xl",children:(n=l.priority,"urgent"===n?"ðŸ”´":"high"===n?"ðŸŸ ":"medium"===n?"ðŸŸ¡":"ðŸŸ¢")}),s.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium capitalize bg-${f(l.status)}-100 text-${f(l.status)}-700`,children:l.status}),s.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium capitalize "+("dark"===e?"bg-gray-700 text-gray-300":"bg-gray-800/50 text-gray-300"),children:l.content_type.replace("_"," ")})]}),s.jsx("h3",{className:"text-lg font-bold mb-2 text-white",children:l.title}),l.scripture_reference&&s.jsxs("p",{className:"text-sm mb-2 "+("dark"===e?"text-purple-400":"text-purple-600"),children:["ðŸ“– ",l.scripture_reference]}),l.notes&&s.jsx("p",{className:"text-sm mb-3 text-gray-400",children:l.notes}),s.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:l.platforms.map(t=>s.jsx("span",{className:"px-2 py-1 rounded text-xs "+("dark"===e?"bg-gray-700 text-gray-300":"bg-gray-800/50 text-gray-300"),children:t},t))}),l.target_publish_date&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(U,{size:16,className:"text-gray-400"}),s.jsxs("span",{className:"text-gray-400",children:[new Date(l.target_publish_date).toLocaleDateString(),null!==i&&s.jsxs("span",{className:i<0?"text-red-500":i<7?"text-orange-500":"",children:[" ","(",i>0?`in ${i} days`:0===i?"today":`${Math.abs(i)} days overdue`,")"]})]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>{o(l),u(!1)},className:"p-2 rounded "+("dark"===e?"hover:bg-gray-700":"hover:bg-gray-800/50"),children:s.jsx(P,{size:16,className:"text-gray-400"})}),s.jsx("button",{onClick:()=>(async e=>{if(confirm("Delete this content item?"))try{const{error:s}=await t.from("content_calendar").delete().eq("id",e);if(s)throw s;a(r.filter(t=>t.id!==e))}catch(s){}})(l.id),className:"p-2 rounded hover:bg-red-100",children:s.jsx(j,{size:16,className:"text-red-600"})})]})]})},l.id);var n}),0===y.length&&s.jsxs("div",{className:"text-center py-12",children:[s.jsx(R,{size:48,className:"mx-auto mb-4 text-gray-400"}),s.jsx("p",{className:"text-lg font-medium text-gray-400",children:"No content planned yet"}),s.jsx("p",{className:"text-sm text-gray-500",children:'Click "Add Content" to start planning'})]})]}),n&&m.createPortal(s.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-[200] flex items-center justify-center p-4",children:s.jsx("div",{className:`w-full max-w-2xl ${"dark"===e?"bg-gray-800":"bg-gray-900/80"} rounded-lg shadow-xl max-h-[90vh] overflow-y-auto`,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:d?"Add Content":"Edit Content"}),s.jsx("button",{onClick:()=>{o(null),u(!1)},className:"p-1 rounded "+("dark"===e?"hover:bg-gray-700":"hover:bg-gray-800/50"),children:s.jsx(g,{size:20})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Title *"}),s.jsx("input",{type:"text",value:n.title,onChange:e=>o({...n,title:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),placeholder:"e.g., Amazing Grace Cover"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Content Type"}),s.jsxs("select",{value:n.content_type,onChange:e=>o({...n,content_type:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),children:[s.jsx("option",{value:"cover",children:"Cover"}),s.jsx("option",{value:"original",children:"Original"}),s.jsx("option",{value:"worship_moment",children:"Worship Moment"}),s.jsx("option",{value:"testimony",children:"Testimony"}),s.jsx("option",{value:"bts",children:"Behind the Scenes"}),s.jsx("option",{value:"live",children:"Live Performance"}),s.jsx("option",{value:"collaboration",children:"Collaboration"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Status"}),s.jsxs("select",{value:n.status,onChange:e=>o({...n,status:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),children:[s.jsx("option",{value:"idea",children:"Idea"}),s.jsx("option",{value:"planning",children:"Planning"}),s.jsx("option",{value:"recording",children:"Recording"}),s.jsx("option",{value:"editing",children:"Editing"}),s.jsx("option",{value:"review",children:"Review"}),s.jsx("option",{value:"scheduled",children:"Scheduled"}),s.jsx("option",{value:"published",children:"Published"}),s.jsx("option",{value:"cancelled",children:"Cancelled"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Priority"}),s.jsxs("select",{value:n.priority,onChange:e=>o({...n,priority:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),children:[s.jsx("option",{value:"low",children:"Low"}),s.jsx("option",{value:"medium",children:"Medium"}),s.jsx("option",{value:"high",children:"High"}),s.jsx("option",{value:"urgent",children:"Urgent"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Target Date"}),s.jsx("input",{type:"date",value:n.target_publish_date||"",onChange:e=>o({...n,target_publish_date:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white")})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Scripture Reference"}),s.jsx("input",{type:"text",value:n.scripture_reference||"",onChange:e=>o({...n,scripture_reference:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),placeholder:"e.g., Psalm 23:1-6"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Platforms"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:["YouTube","Instagram","TikTok","Facebook"].map(e=>s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:n.platforms.includes(e),onChange:t=>{t.target.checked?o({...n,platforms:[...n.platforms,e]}):o({...n,platforms:n.platforms.filter(t=>t!==e)})},className:"rounded"}),s.jsx("span",{className:"text-sm text-gray-300",children:e})]},e))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Notes"}),s.jsx("textarea",{value:n.notes||"",onChange:e=>o({...n,notes:e.target.value}),rows:4,className:"w-full px-3 py-2 border rounded-lg resize-none "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),placeholder:"Add any notes or ideas..."})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:()=>{o(null),u(!1)},className:"flex-1 px-4 py-2 border rounded-lg "+("dark"===e?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-purple-500/30 text-gray-300 hover:bg-gray-800/50"),children:"Cancel"}),s.jsxs("button",{onClick:async()=>{if(n&&n.title.trim())try{if(d){const{id:e,created_at:s,updated_at:l,...i}=n,{data:o,error:d}=await t.from("content_calendar").insert([i]).select().single();if(d)throw d;o&&a([...r,o])}else{const{error:e}=await t.from("content_calendar").update(n).eq("id",n.id);if(e)throw e;a(r.map(e=>e.id===n.id?n:e))}o(null),u(!1)}catch(e){alert("Failed to save item")}},disabled:!n.title.trim(),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(D,{size:16}),d?"Add Content":"Save Changes"]})]})]})})}),document.body)]})},je=async(e,s)=>{try{const{error:r}=await t.from("goals").update(s).eq("id",e);if(r)throw r;return!0}catch(r){return!1}},ve=async(e,s)=>{try{let s=t.from("revenue_expenses").select("*").order("transaction_date",{ascending:!1});e&&(s=s.gte("transaction_date",e));const{data:r,error:a}=await s;if(a)throw a;return r||[]}catch(r){return[]}},we=()=>{const{theme:e}=c(),[r,a]=x.useState([]),[l,i]=x.useState(!0),[n,o]=x.useState(null),[d,u]=x.useState(!1),[p,m]=x.useState("all"),[h,b]=x.useState("30d"),[f,y]=x.useState({totalRevenue:0,totalExpenses:0,netProfit:0,revenueByCategory:{},expensesByCategory:{}});x.useEffect(()=>{v()},[h]);const v=async()=>{i(!0);try{const e="30d"===h?30:"90d"===h?90:365,t=new Date;t.setDate(t.getDate()-e);const s=await ve(t.toISOString().split("T")[0]);a(s);const r=await(async e=>{try{const t=await ve(e),s=t.filter(e=>"revenue"===e.type),r=t.filter(e=>"expense"===e.type),a=s.reduce((e,t)=>e+t.amount,0),l=r.reduce((e,t)=>e+t.amount,0),i={};s.forEach(e=>{i[e.category]=(i[e.category]||0)+e.amount});const n={};return r.forEach(e=>{n[e.category]=(n[e.category]||0)+e.amount}),{totalRevenue:a,totalExpenses:l,netProfit:a-l,revenueByCategory:i,expensesByCategory:n}}catch(t){return{totalRevenue:0,totalExpenses:0,netProfit:0,revenueByCategory:{},expensesByCategory:{}}}})(t.toISOString().split("T")[0]);y(r)}catch(e){}i(!1)},w=e=>{const t={id:"",transaction_date:(new Date).toISOString().split("T")[0],type:e,category:"",amount:0,currency:"NGN",is_recurring:!1,created_at:(new Date).toISOString()};o(t),u(!0)},N=async e=>{if(!confirm("Delete this transaction?"))return;const s=await(async e=>{try{const{error:s}=await t.from("revenue_expenses").delete().eq("id",e);if(s)throw s;return!0}catch(s){return!1}})(e);s&&(a(r.filter(t=>t.id!==e)),await v())},k=r.filter(e=>"all"===p||e.type===p);return l?s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-3xl font-black text-white",children:"Financial Dashboard"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Track revenue and expenses"})]}),s.jsx("div",{className:"flex gap-2",children:["30d","90d","year"].map(t=>s.jsx("button",{onClick:()=>b(t),className:"px-4 py-2 rounded-lg text-sm font-medium transition-all "+(h===t?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":"dark"===e?"bg-gray-800 text-gray-100 hover:bg-gray-700":"bg-black text-gray-100 hover:bg-gray-900"),children:"30d"===t?"30 Days":"90d"===t?"90 Days":"Year"},t))})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"p-6 rounded-xl border "+("dark"===e?"bg-gray-800 border-gray-700":"bg-gray-900/80 border-purple-500/20"),children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-400",children:"Total Revenue"}),s.jsx(V,{size:20,className:"text-green-500"})]}),s.jsxs("p",{className:"text-3xl font-bold text-green-500",children:["â‚¦",f.totalRevenue.toLocaleString()]})]}),s.jsxs("div",{className:"p-6 rounded-xl border "+("dark"===e?"bg-gray-800 border-gray-700":"bg-gray-900/80 border-purple-500/20"),children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-400",children:"Total Expenses"}),s.jsx(B,{size:20,className:"text-red-500"})]}),s.jsxs("p",{className:"text-3xl font-bold text-red-500",children:["â‚¦",f.totalExpenses.toLocaleString()]})]}),s.jsxs("div",{className:"p-6 rounded-xl border "+("dark"===e?"bg-gray-800 border-gray-700":"bg-gray-900/80 border-purple-500/20"),children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-400",children:"Net Profit"}),s.jsx(G,{size:20,className:f.netProfit>=0?"text-green-500":"text-red-500"})]}),s.jsxs("p",{className:"text-3xl font-bold "+(f.netProfit>=0?"text-green-500":"text-red-500"),children:["â‚¦",f.netProfit.toLocaleString()]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"p-6 rounded-xl border "+("dark"===e?"bg-gray-800 border-gray-700":"bg-gray-900/80 border-purple-500/20"),children:[s.jsx("h3",{className:"text-lg font-bold mb-4 text-white",children:"Revenue by Category"}),s.jsxs("div",{className:"space-y-3",children:[Object.entries(f.revenueByCategory).map(([t,r])=>{const a=f.totalRevenue>0?r/f.totalRevenue*100:0;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between mb-1",children:[s.jsx("span",{className:"text-sm text-gray-300",children:t}),s.jsxs("span",{className:"text-sm font-medium text-gray-400",children:["â‚¦",r.toLocaleString()," (",a.toFixed(1),"%)"]})]}),s.jsx("div",{className:"h-2 rounded-full overflow-hidden "+("dark"===e?"bg-gray-700":"bg-gray-200"),children:s.jsx("div",{className:"h-full bg-gradient-to-r from-green-500 to-green-600",style:{width:`${a}%`}})})]},t)}),0===Object.keys(f.revenueByCategory).length&&s.jsx("p",{className:"text-sm text-center py-4 text-gray-500",children:"No revenue recorded yet"})]})]}),s.jsxs("div",{className:"p-6 rounded-xl border "+("dark"===e?"bg-gray-800 border-gray-700":"bg-gray-900/80 border-purple-500/20"),children:[s.jsx("h3",{className:"text-lg font-bold mb-4 text-white",children:"Expenses by Category"}),s.jsxs("div",{className:"space-y-3",children:[Object.entries(f.expensesByCategory).map(([t,r])=>{const a=f.totalExpenses>0?r/f.totalExpenses*100:0;return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between mb-1",children:[s.jsx("span",{className:"text-sm text-gray-300",children:t}),s.jsxs("span",{className:"text-sm font-medium text-gray-400",children:["â‚¦",r.toLocaleString()," (",a.toFixed(1),"%)"]})]}),s.jsx("div",{className:"h-2 rounded-full overflow-hidden "+("dark"===e?"bg-gray-700":"bg-gray-200"),children:s.jsx("div",{className:"h-full bg-gradient-to-r from-red-500 to-red-600",style:{width:`${a}%`}})})]},t)}),0===Object.keys(f.expensesByCategory).length&&s.jsx("p",{className:"text-sm text-center py-4 text-gray-500",children:"No expenses recorded yet"})]})]})]}),s.jsxs("div",{className:"p-6 rounded-xl border "+("dark"===e?"bg-gray-800 border-gray-700":"bg-gray-900/80 border-purple-500/20"),children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsx("h3",{className:"text-lg font-bold text-white",children:"Recent Transactions"}),s.jsxs("div",{className:"flex gap-2",children:[["all","revenue","expense"].map(t=>s.jsx("button",{onClick:()=>m(t),className:"px-3 py-1 rounded text-sm font-medium capitalize "+(p===t?"bg-purple-600 text-white":"dark"===e?"bg-gray-800 text-gray-100":"bg-black text-gray-100"),children:t},t)),s.jsx("button",{onClick:()=>w("revenue"),className:"px-3 py-1 rounded text-sm font-medium bg-green-600 text-white hover:bg-green-700",children:"+ Revenue"}),s.jsx("button",{onClick:()=>w("expense"),className:"px-3 py-1 rounded text-sm font-medium bg-red-600 text-white hover:bg-red-700",children:"+ Expense"})]})]}),s.jsxs("div",{className:"space-y-2",children:[k.slice(0,20).map(t=>s.jsxs("div",{className:"p-4 rounded-lg border flex items-center justify-between "+("dark"===e?"bg-gray-700 border-gray-600":"bg-gray-800/50 border-purple-500/20"),children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("span",{className:"px-2 py-1 rounded text-xs font-medium "+("revenue"===t.type?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:t.type}),s.jsx("span",{className:"text-sm font-medium text-white",children:t.category})]}),t.description&&s.jsx("p",{className:"text-sm text-gray-400",children:t.description}),s.jsx("p",{className:"text-xs text-gray-500",children:new Date(t.transaction_date).toLocaleDateString()})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("span",{className:"text-lg font-bold "+("revenue"===t.type?"text-green-500":"text-red-500"),children:["revenue"===t.type?"+":"-","â‚¦",t.amount.toLocaleString()]}),s.jsx("button",{onClick:()=>N(t.id),className:"p-2 rounded hover:bg-red-100",children:s.jsx(j,{size:16,className:"text-red-600"})})]})]},t.id)),0===k.length&&s.jsx("p",{className:"text-center py-8 text-gray-500",children:"No transactions yet"})]})]}),n&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsx("div",{className:`w-full max-w-md ${"dark"===e?"bg-gray-800":"bg-gray-900/80"} rounded-lg shadow-xl`,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("h3",{className:"text-lg font-semibold text-white",children:["Add ","revenue"===n.type?"Revenue":"Expense"]}),s.jsx("button",{onClick:()=>{o(null),u(!1)},className:"p-1 rounded "+("dark"===e?"hover:bg-gray-700":"hover:bg-gray-800/50"),children:s.jsx(g,{size:20})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Category *"}),s.jsxs("select",{value:n.category,onChange:e=>o({...n,category:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),children:[s.jsx("option",{value:"",children:"Select category"}),("revenue"===n.type?["YouTube Ad Revenue","Bookings","Donations","Merchandise","Streaming","Teaching","Sponsorships"]:["Equipment","Software","Studio Rental","Travel","Marketing","Website","Production","Costumes","Professional Services"]).map(e=>s.jsx("option",{value:e,children:e},e))]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Amount (â‚¦) *"}),s.jsx("input",{type:"number",value:n.amount,onChange:e=>o({...n,amount:Number(e.target.value)}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),placeholder:"0.00"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Date"}),s.jsx("input",{type:"date",value:n.transaction_date,onChange:e=>o({...n,transaction_date:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white")})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Description"}),s.jsx("textarea",{value:n.description||"",onChange:e=>o({...n,description:e.target.value}),rows:3,className:"w-full px-3 py-2 border rounded-lg resize-none "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),placeholder:"Add details..."})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:()=>{o(null),u(!1)},className:"flex-1 px-4 py-2 border rounded-lg "+("dark"===e?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-purple-500/30 text-gray-300 hover:bg-gray-800/50"),children:"Cancel"}),s.jsxs("button",{onClick:async()=>{if(!n||!n.category||n.amount<=0)alert("Please fill in all required fields");else try{if(d){const{id:e,created_at:s,...l}=n,i=await(async e=>{try{const{data:s,error:r}=await t.from("revenue_expenses").insert([e]).select().single();if(r)throw r;return s}catch(s){return null}})(l);i&&(a([i,...r]),await v())}o(null),u(!1)}catch(e){alert("Failed to save transaction")}},disabled:!n.category||n.amount<=0,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(D,{size:16}),"Save"]})]})]})})})]})},Ne=()=>{const{theme:e}=c(),[r,a]=x.useState([]),[l,i]=x.useState(!0),[n,o]=x.useState(null),[d,u]=x.useState(!1),[p,h]=x.useState("all");x.useEffect(()=>{b()},[]);const b=async()=>{i(!0);const e=await(async()=>{try{const{data:e,error:s}=await t.from("goals").select("*").order("created_at",{ascending:!1});if(s)throw s;return e||[]}catch(e){return[]}})();a(e),i(!1)},f=async e=>{if(!confirm("Delete this goal?"))return;const s=await(async e=>{try{const{error:s}=await t.from("goals").delete().eq("id",e);if(s)throw s;return!0}catch(s){return!1}})(e);s&&a(r.filter(t=>t.id!==e))},y=r.filter(e=>"all"===p||e.status===p),v=e=>({content:"purple",growth:"blue",ministry:"pink",financial:"green",engagement:"orange",learning:"indigo",personal:"red"}[e]||"gray");return l?s.jsx("div",{className:"flex items-center justify-center p-8",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-3xl font-black text-white",children:"Goals Tracker"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Set and track your ministry goals"})]}),s.jsxs("div",{className:"flex gap-2",children:[["all","active","completed"].map(t=>s.jsx("button",{onClick:()=>h(t),className:"px-4 py-2 rounded-lg text-sm font-medium capitalize transition-all "+(p===t?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":"dark"===e?"bg-gray-800 text-gray-100 hover:bg-gray-700":"bg-black text-gray-100 hover:bg-gray-900"),children:t},t)),s.jsxs("button",{onClick:()=>{const e={id:"",title:"",category:"content",target_value:0,current_value:0,start_date:(new Date).toISOString().split("T")[0],priority:"medium",status:"active",created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};o(e),u(!0)},className:"flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all",children:[s.jsx(S,{size:20}),"Add Goal"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[y.map(t=>{const l=t.target_value>0?t.current_value/t.target_value*100:0,i="completed"===t.status,n=t.target_date?Math.ceil((new Date(t.target_date).getTime()-(new Date).getTime())/864e5):null;return s.jsxs("div",{className:`p-6 rounded-xl border transition-all ${"dark"===e?"bg-gray-800 border-gray-700":"bg-gray-900/80 border-purple-500/20"} ${i?"opacity-75":""}`,children:[s.jsxs("div",{className:"flex items-start justify-between mb-4",children:[s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium capitalize bg-${v(t.category)}-100 text-${v(t.category)}-700`,children:t.category}),s.jsx("span",{className:`text-xs font-medium ${d=t.priority,{low:"text-gray-500",medium:"text-yellow-500",high:"text-red-500"}[d]||"text-gray-500"}`,children:t.priority})]}),s.jsx("h3",{className:"text-lg font-bold text-white",children:t.title}),t.notes&&s.jsx("p",{className:"text-sm mt-1 text-gray-400",children:t.notes})]}),s.jsx("div",{className:"flex items-center gap-2",children:i?s.jsx(H,{size:24,className:"text-green-500"}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{o(t),u(!1)},className:"p-2 rounded "+("dark"===e?"hover:bg-gray-700":"hover:bg-gray-800/50"),children:s.jsx(P,{size:16,className:"text-gray-400"})}),s.jsx("button",{onClick:()=>f(t.id),className:"p-2 rounded hover:bg-red-100",children:s.jsx(j,{size:16,className:"text-red-600"})})]})})]}),s.jsxs("div",{className:"mb-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-sm font-medium text-gray-300",children:"Progress"}),s.jsxs("span",{className:"text-sm font-bold text-white",children:[t.current_value," / ",t.target_value," ",t.unit||""]})]}),s.jsx("div",{className:"h-3 rounded-full overflow-hidden "+("dark"===e?"bg-gray-700":"bg-gray-200"),children:s.jsx("div",{className:"h-full transition-all "+(i?"bg-green-500":"bg-gradient-to-r from-purple-600 to-pink-600"),style:{width:`${Math.min(l,100)}%`}})}),s.jsxs("div",{className:"flex justify-between items-center mt-2",children:[s.jsxs("span",{className:"text-xs text-gray-500",children:[l.toFixed(1),"% complete"]}),!i&&s.jsx("input",{type:"number",value:t.current_value,onChange:e=>(async(e,t)=>{const s={...e,current_value:t};t>=e.target_value&&"active"===e.status&&(s.status="completed"),await je(e.id,s)&&a(r.map(t=>t.id===e.id?s:t))})(t,Number(e.target.value)),className:"w-20 px-2 py-1 text-xs rounded border "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white")})]})]}),null!==n&&!i&&s.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[s.jsx(U,{size:16,className:"text-gray-400"}),s.jsx("span",{className:"text-gray-400",children:n>0?`${n} days left`:0===n?"Due today":`${Math.abs(n)} days overdue`})]})]},t.id);var d}),0===y.length&&s.jsxs("div",{className:"col-span-2 text-center py-12",children:[s.jsx(W,{size:48,className:"mx-auto mb-4 text-gray-400"}),s.jsxs("p",{className:"text-lg font-medium text-gray-400",children:["No ","all"!==p?p:""," goals yet"]}),s.jsx("p",{className:"text-sm text-gray-500",children:'Click "Add Goal" to create your first goal'})]})]}),n&&m.createPortal(s.jsx("div",{className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-[200] flex items-center justify-center p-4",children:s.jsx("div",{className:`w-full max-w-lg ${"dark"===e?"bg-gray-800":"bg-gray-900/80"} rounded-lg shadow-xl max-h-[90vh] overflow-y-auto`,children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-semibold text-white",children:d?"Add New Goal":"Edit Goal"}),s.jsx("button",{onClick:()=>{o(null),u(!1)},className:"p-1 rounded "+("dark"===e?"hover:bg-gray-700":"hover:bg-gray-800/50"),children:s.jsx(g,{size:20,className:"text-gray-400"})})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Goal Title *"}),s.jsx("input",{type:"text",value:n.title,onChange:e=>o({...n,title:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),placeholder:"e.g., Upload 10 videos this month"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Category"}),s.jsxs("select",{value:n.category,onChange:e=>o({...n,category:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),children:[s.jsx("option",{value:"content",children:"Content"}),s.jsx("option",{value:"growth",children:"Growth"}),s.jsx("option",{value:"ministry",children:"Ministry"}),s.jsx("option",{value:"financial",children:"Financial"}),s.jsx("option",{value:"engagement",children:"Engagement"}),s.jsx("option",{value:"learning",children:"Learning"}),s.jsx("option",{value:"personal",children:"Personal"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Priority"}),s.jsxs("select",{value:n.priority,onChange:e=>o({...n,priority:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),children:[s.jsx("option",{value:"low",children:"Low"}),s.jsx("option",{value:"medium",children:"Medium"}),s.jsx("option",{value:"high",children:"High"})]})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Target Value"}),s.jsx("input",{type:"number",value:n.target_value,onChange:e=>o({...n,target_value:Number(e.target.value)}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white")})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Current Value"}),s.jsx("input",{type:"number",value:n.current_value,onChange:e=>o({...n,current_value:Number(e.target.value)}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white")})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Unit (optional)"}),s.jsx("input",{type:"text",value:n.unit||"",onChange:e=>o({...n,unit:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),placeholder:"e.g., videos, subscribers, â‚¦"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Target Date"}),s.jsx("input",{type:"date",value:n.target_date||"",onChange:e=>o({...n,target_date:e.target.value}),className:"w-full px-3 py-2 border rounded-lg "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white")})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium mb-1 text-gray-300",children:"Notes"}),s.jsx("textarea",{value:n.notes||"",onChange:e=>o({...n,notes:e.target.value}),rows:3,className:"w-full px-3 py-2 border rounded-lg resize-none "+("dark"===e?"bg-gray-700 border-gray-600 text-white":"bg-gray-900/80 border-purple-500/30 text-white"),placeholder:"Add any notes or strategy..."})]})]}),s.jsxs("div",{className:"flex gap-3 mt-6",children:[s.jsx("button",{onClick:()=>{o(null),u(!1)},className:"flex-1 px-4 py-2 border rounded-lg "+("dark"===e?"border-gray-600 text-gray-300 hover:bg-gray-700":"border-purple-500/30 text-gray-300 hover:bg-gray-800/50"),children:"Cancel"}),s.jsxs("button",{onClick:async()=>{if(n&&n.title.trim())try{if(d){const{id:e,created_at:s,updated_at:l,...i}=n,o=await(async e=>{try{const{data:s,error:r}=await t.from("goals").insert([e]).select().single();if(r)throw r;return s}catch(s){return null}})(i);o&&a([o,...r])}else{await je(n.id,n)&&a(r.map(e=>e.id===n.id?n:e))}o(null),u(!1)}catch(e){alert("Failed to save goal")}},disabled:!n.title.trim(),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[s.jsx(D,{size:16}),d?"Add Goal":"Save Changes"]})]})]})})}),document.body)]})};function ke(){const[e,t]=x.useState("7d"),[r,a]=x.useState({pageViews:[],topPages:[],userLocations:[],deviceBreakdown:[],peakHours:[],userRetention:[]}),[l,i]=x.useState(!0),[n,o]=x.useState(!1);x.useEffect(()=>{d(),setTimeout(()=>o(!0),100)},[e]);const d=async()=>{try{const t=await u(),s=(null==t?void 0:t.total_visits)||0,r="7d"===e?7:"30d"===e?30:90,l=Math.floor(s/r);a({pageViews:c(r,l),topPages:[{page:"/home",views:Math.floor(.35*s)},{page:"/videos",views:Math.floor(.28*s)},{page:"/about",views:Math.floor(.2*s)},{page:"/contact",views:Math.floor(.12*s)},{page:"/gallery",views:Math.floor(.05*s)}],userLocations:[{country:"United States",users:Math.floor(.32*s)},{country:"United Kingdom",users:Math.floor(.18*s)},{country:"Canada",users:Math.floor(.12*s)},{country:"Australia",users:Math.floor(.1*s)},{country:"Germany",users:Math.floor(.08*s)}],deviceBreakdown:[{device:"Mobile",percentage:65},{device:"Desktop",percentage:28},{device:"Tablet",percentage:7}],peakHours:p(),userRetention:m()})}catch(t){}finally{i(!1)}},c=(e,t)=>Array.from({length:e},(s,r)=>{const a=new Date;a.setDate(a.getDate()-(e-r-1));const l=Math.floor(.3*t);return{date:a.toLocaleDateString("en-US",{month:"short",day:"numeric"}),views:Math.max(10,t+Math.floor(Math.random()*l*2-l))}}),p=()=>Array.from({length:24},(e,t)=>({hour:t,activity:Math.floor(80*Math.random())+(t>=8&&t<=22?40:10)})),m=()=>Array.from({length:8},(e,t)=>({week:`Week ${t+1}`,rate:Math.max(30,100-8*t-10*Math.random())}));return l?s.jsx("div",{className:"flex items-center justify-center py-12",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"})}):s.jsxs(s.Fragment,{children:[s.jsx("style",{children:"\n        @keyframes drawLine {\n          to {\n            stroke-dashoffset: 0;\n            opacity: 1;\n          }\n        }\n        @keyframes drawPath {\n          to {\n            opacity: 1;\n          }\n        }\n        @keyframes fadeInScale {\n          from {\n            opacity: 0;\n            transform: scale(0);\n          }\n          to {\n            opacity: 1;\n            transform: scale(1);\n          }\n        }\n      "}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-white",children:"Advanced Analytics"}),s.jsx("p",{className:"text-purple-300 mt-1",children:"Deep insights into user behavior and engagement"})]}),s.jsxs("select",{value:e,onChange:e=>t(e.target.value),className:"px-4 py-2 bg-purple-500/10 border border-purple-500/30 rounded-lg text-white focus:outline-none focus:border-purple-500",children:[s.jsx("option",{value:"7d",children:"Last 7 Days"}),s.jsx("option",{value:"30d",children:"Last 30 Days"}),s.jsx("option",{value:"90d",children:"Last 90 Days"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[s.jsx("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/10 backdrop-blur-xl rounded-xl p-4 border border-purple-500/20",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-purple-300 text-sm",children:"Total Page Views"}),s.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:r.pageViews.reduce((e,t)=>e+t.views,0).toLocaleString()}),s.jsx("p",{className:"text-green-400 text-xs mt-1",children:"â†‘ 12.5% vs last period"})]}),s.jsx(J,{className:"w-8 h-8 text-purple-400"})]})}),s.jsx("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/10 backdrop-blur-xl rounded-xl p-4 border border-blue-500/20",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-blue-300 text-sm",children:"Unique Visitors"}),s.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:r.userLocations.reduce((e,t)=>e+t.users,0).toLocaleString()}),s.jsx("p",{className:"text-green-400 text-xs mt-1",children:"â†‘ 8.3% vs last period"})]}),s.jsx(I,{className:"w-8 h-8 text-blue-400"})]})}),s.jsx("div",{className:"bg-gradient-to-br from-green-500/10 to-green-600/10 backdrop-blur-xl rounded-xl p-4 border border-green-500/20",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-green-300 text-sm",children:"Avg Session Time"}),s.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:"4m 32s"}),s.jsx("p",{className:"text-green-400 text-xs mt-1",children:"â†‘ 15.2% vs last period"})]}),s.jsx(U,{className:"w-8 h-8 text-green-400"})]})}),s.jsx("div",{className:"bg-gradient-to-br from-orange-500/10 to-orange-600/10 backdrop-blur-xl rounded-xl p-4 border border-orange-500/20",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-orange-300 text-sm",children:"Bounce Rate"}),s.jsx("p",{className:"text-2xl font-bold text-white mt-1",children:"32.4%"}),s.jsx("p",{className:"text-red-400 text-xs mt-1",children:"â†“ 5.1% vs last period"})]}),s.jsx(Y,{className:"w-8 h-8 text-orange-400"})]})})]}),s.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/10 backdrop-blur-xl rounded-xl p-6 border border-purple-500/20",children:[s.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Page Views Over Time"}),((e,t)=>{const r=Math.max(...e.map(e=>e.views),1),a=e.map((t,s)=>({x:s/(e.length-1||1)*100,y:100-t.views/r*80})),l=a.map((e,t)=>`${0===t?"M":"L"} ${e.x},${e.y}`).join(" "),i=`${l} L ${a[a.length-1].x},100 L 0,100 Z`;return s.jsx("div",{className:"relative h-64",children:s.jsxs("svg",{className:"w-full h-full",viewBox:"0 0 100 100",preserveAspectRatio:"none",children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:"analytics-gradient",x1:"0%",y1:"0%",x2:"0%",y2:"100%",children:[s.jsx("stop",{offset:"0%",stopColor:t,stopOpacity:"0.4"}),s.jsx("stop",{offset:"100%",stopColor:t,stopOpacity:"0.05"})]})}),s.jsx("path",{d:i,fill:"url(#analytics-gradient)",style:{animation:n?"drawPath 1.5s ease-out forwards":"none",opacity:n?1:0}}),s.jsx("path",{d:l,fill:"none",stroke:t,strokeWidth:"0.8",strokeLinecap:"round",strokeLinejoin:"round",style:{animation:n?"drawLine 1.5s ease-out forwards":"none",strokeDasharray:"1000",strokeDashoffset:n?"0":"1000"}}),a.map((e,r)=>s.jsx("circle",{cx:e.x,cy:e.y,r:"1.5",fill:t,style:{animation:n?`fadeInScale 0.3s ease-out ${.5+.05*r}s forwards`:"none",opacity:n?1:0}},r))]})})})(r.pageViews,"#9333ea")]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-gradient-to-br from-purple-500/10 to-purple-600/10 backdrop-blur-xl rounded-xl p-6 border border-purple-500/20",children:[s.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[s.jsx(V,{className:"w-5 h-5"}),"Top Pages"]}),s.jsx("div",{className:"space-y-3",children:r.topPages.map((e,t)=>s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("span",{className:"text-white font-medium",children:e.page}),s.jsxs("span",{className:"text-purple-300 text-sm",children:[e.views.toLocaleString()," views"]})]}),s.jsx("div",{className:"w-full bg-purple-500/20 rounded-full h-2",children:s.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-purple-700 h-2 rounded-full transition-all",style:{width:e.views/r.topPages[0].views*100+"%",animation:n?`slideIn 0.5s ease-out ${.1*t}s forwards`:"none"}})})]})},t))})]}),s.jsxs("div",{className:"bg-gradient-to-br from-blue-500/10 to-blue-600/10 backdrop-blur-xl rounded-xl p-6 border border-blue-500/20",children:[s.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[s.jsx(Q,{className:"w-5 h-5"}),"Top Locations"]}),s.jsx("div",{className:"space-y-3",children:r.userLocations.map((e,t)=>s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("span",{className:"text-white font-medium",children:e.country}),s.jsxs("span",{className:"text-blue-300 text-sm",children:[e.users.toLocaleString()," users"]})]}),s.jsx("div",{className:"w-full bg-blue-500/20 rounded-full h-2",children:s.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 h-2 rounded-full transition-all",style:{width:e.users/r.userLocations[0].users*100+"%",animation:n?`slideIn 0.5s ease-out ${.1*t}s forwards`:"none"}})})]})},t))})]}),s.jsxs("div",{className:"bg-gradient-to-br from-green-500/10 to-green-600/10 backdrop-blur-xl rounded-xl p-6 border border-green-500/20",children:[s.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[s.jsx(Z,{className:"w-5 h-5"}),"Device Breakdown"]}),s.jsx("div",{className:"space-y-4",children:r.deviceBreakdown.map((e,t)=>s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between mb-2",children:[s.jsx("span",{className:"text-white",children:e.device}),s.jsxs("span",{className:"text-green-300",children:[e.percentage,"%"]})]}),s.jsx("div",{className:"w-full bg-green-500/20 rounded-full h-3",children:s.jsx("div",{className:"bg-gradient-to-r from-green-600 to-green-700 h-3 rounded-full transition-all",style:{width:`${e.percentage}%`,animation:n?`slideIn 0.5s ease-out ${.1*t}s forwards`:"none"}})})]},t))})]}),s.jsxs("div",{className:"bg-gradient-to-br from-orange-500/10 to-orange-600/10 backdrop-blur-xl rounded-xl p-6 border border-orange-500/20",children:[s.jsxs("h3",{className:"text-lg font-bold text-white mb-4 flex items-center gap-2",children:[s.jsx(U,{className:"w-5 h-5"}),"Peak Activity Hours"]}),s.jsx("div",{className:"h-48 flex items-end justify-between gap-1",children:r.peakHours.filter((e,t)=>t%2==0).map((e,t)=>{const a=Math.max(...r.peakHours.map(e=>e.activity));return s.jsxs("div",{className:"flex-1 flex flex-col items-center gap-2",children:[s.jsx("div",{className:"w-full bg-gradient-to-t from-orange-600 to-orange-700 rounded-t hover:from-orange-500 hover:to-orange-600 transition-all cursor-pointer",style:{height:e.activity/a*100+"%",animation:n?`slideUp 0.5s ease-out ${.05*t}s forwards`:"none",opacity:n?1:0}}),s.jsxs("span",{className:"text-xs text-orange-300",children:[e.hour,":00"]})]},t)})})]})]})]}),s.jsx("style",{children:"\n        @keyframes slideIn {\n          from {\n            width: 0;\n          }\n        }\n        @keyframes slideUp {\n          from {\n            height: 0;\n            opacity: 0;\n          }\n        }\n      "})]})}const _e=()=>{const[e,t]=x.useState(null),[r,a]=x.useState(!1),[l,i]=x.useState(!1),[n,o]=x.useState(!1),[d,c]=x.useState(!1);x.useEffect(()=>{if(window.matchMedia("(display-mode: standalone)").matches)return void i(!0);const e=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;o(e);const s=e=>{e.preventDefault(),t(e),a(!0)};return window.addEventListener("beforeinstallprompt",s),window.addEventListener("appinstalled",()=>{i(!0),a(!1)}),()=>{window.removeEventListener("beforeinstallprompt",s)}},[]);return l?null:s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:async()=>{if(n)return void c(!0);if(!e)return void alert('To install this app:\n\n1. Click the menu button (â‹®) in your browser\n2. Select "Install App" or "Add to Home Screen"\n3. Follow the prompts');e.prompt();const{outcome:s}=await e.userChoice;"accepted"===s&&i(!0),t(null),a(!1)},className:"w-full mt-4 bg-gradient-to-r from-green-600 to-green-700 text-white px-6 py-3 rounded-xl font-semibold text-sm transition-all hover:shadow-lg hover:shadow-green-500/50 hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2",children:[s.jsx(K,{size:18}),"Install App"]}),d&&s.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"bg-gradient-to-br from-[#2d1b4e] to-[#1a0a2e] rounded-2xl p-6 max-w-md w-full border border-purple-500/30 shadow-2xl",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(X,{size:24,className:"text-purple-300"}),s.jsx("h3",{className:"text-xl font-bold text-white",children:"Install on iOS"})]}),s.jsx("button",{onClick:()=>c(!1),className:"p-2 hover:bg-purple-500/20 rounded-lg transition-colors",children:s.jsx(g,{size:20,className:"text-purple-300"})})]}),s.jsxs("div",{className:"space-y-4 text-purple-200",children:[s.jsx("p",{className:"text-sm",children:"To install this app on your iPhone or iPad:"}),s.jsxs("ol",{className:"space-y-3 text-sm",children:[s.jsxs("li",{className:"flex gap-3",children:[s.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-purple-500/20 rounded-full flex items-center justify-center text-xs font-bold",children:"1"}),s.jsxs("span",{children:["Tap the ",s.jsx("strong",{className:"text-white",children:"Share"})," button at the bottom of Safari"]})]}),s.jsxs("li",{className:"flex gap-3",children:[s.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-purple-500/20 rounded-full flex items-center justify-center text-xs font-bold",children:"2"}),s.jsxs("span",{children:["Scroll down and tap ",s.jsx("strong",{className:"text-white",children:'"Add to Home Screen"'})]})]}),s.jsxs("li",{className:"flex gap-3",children:[s.jsx("span",{className:"flex-shrink-0 w-6 h-6 bg-purple-500/20 rounded-full flex items-center justify-center text-xs font-bold",children:"3"}),s.jsxs("span",{children:["Tap ",s.jsx("strong",{className:"text-white",children:'"Add"'})," in the top right corner"]})]})]}),s.jsx("div",{className:"mt-4 p-3 bg-purple-500/10 rounded-lg border border-purple-500/20",children:s.jsx("p",{className:"text-xs text-purple-300",children:"ðŸ’¡ The app icon will appear on your home screen and work like a native app!"})})]}),s.jsx("button",{onClick:()=>c(!1),className:"w-full mt-4 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors",children:"Got it!"})]})}),!n&&!e&&r&&s.jsx("div",{className:"mt-4 p-3 bg-blue-500/10 rounded-lg border border-blue-500/20",children:s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(ee,{size:18,className:"text-blue-300 flex-shrink-0 mt-0.5"}),s.jsxs("div",{className:"text-xs text-blue-200",children:[s.jsx("p",{className:"font-semibold mb-1",children:"Install this app:"}),s.jsx("p",{children:'Click the menu (â‹®) â†’ "Install App" or "Add to Home Screen"'})]})]})}),s.jsxs("div",{className:"mt-3 flex items-center justify-center gap-4 text-xs text-purple-400",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(Z,{size:14}),s.jsx("span",{children:"Mobile"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(te,{size:14}),s.jsx("span",{children:"Desktop"})]}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(X,{size:14}),s.jsx("span",{children:"iOS"})]})]})]})},Se=()=>{const[e,t]=x.useState(navigator.onLine),[r,a]=x.useState(!1);return x.useEffect(()=>{const e=()=>{t(!0),a(!0),setTimeout(()=>{a(!1)},2e3)},s=()=>{t(!1)};return window.addEventListener("online",e),window.addEventListener("offline",s),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[]),e&&!r?null:s.jsx("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg text-xs font-medium "+(e?"bg-blue-500/20 text-blue-300 border border-blue-500/30":"bg-red-500/20 text-red-300 border border-red-500/30"),children:r?s.jsxs(s.Fragment,{children:[s.jsx(se,{size:14,className:"animate-spin"}),s.jsx("span",{children:"Syncing data..."})]}):s.jsxs(s.Fragment,{children:[s.jsx(re,{size:14}),s.jsx("span",{children:"Offline - Changes saved locally"})]})})};const Ce=new class{constructor(){this.audio=null,this.notificationCount=0,this.initializeAudio(),this.requestPermission()}initializeAudio(){}async requestPermission(){"Notification"in window&&"default"===Notification.permission&&await Notification.requestPermission()}playSound(){try{const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),s=e.createGain();t.connect(s),s.connect(e.destination),t.frequency.value=800,t.type="sine",s.gain.setValueAtTime(.3,e.currentTime),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),t.start(e.currentTime),t.stop(e.currentTime+.5)}catch(e){}}async showNotification(e,t){if("Notification"in window&&"granted"===Notification.permission)try{const s=new Notification(e,{icon:"/icon-192x192.png",badge:"/icon-192x192.png",...t});return setTimeout(()=>s.close(),5e3),s}catch(s){}}async updateBadge(e){if(this.notificationCount=e,"setAppBadge"in navigator)try{e>0?await navigator.setAppBadge(e):await navigator.clearAppBadge()}catch(t){}if("serviceWorker"in navigator&&navigator.serviceWorker.controller)try{navigator.serviceWorker.controller.postMessage({type:"UPDATE_BADGE",count:e})}catch(t){}this.updateFaviconBadge(e)}updateFaviconBadge(e){const t=document.createElement("canvas");t.width=32,t.height=32;const s=t.getContext("2d");if(!s)return;s.fillStyle="#a855f7",s.beginPath(),s.arc(16,16,16,0,2*Math.PI),s.fill(),e>0&&(s.fillStyle="#ff0000",s.beginPath(),s.arc(24,8,8,0,2*Math.PI),s.fill(),s.fillStyle="#ffffff",s.font="bold 10px Arial",s.textAlign="center",s.textBaseline="middle",s.fillText(e>99?"99+":e.toString(),24,8));const r=document.querySelector("link[rel*='icon']")||document.createElement("link");r.type="image/x-icon",r.rel="shortcut icon",r.href=t.toDataURL(),document.getElementsByTagName("head")[0].appendChild(r)}async clearBadge(){await this.updateBadge(0)}async notifyNewMessage(e,t){this.playSound(),await this.showNotification("New Message",{body:`From ${e}: ${t}`,tag:"new-message"})}async notifyNewSongRequest(e,t){this.playSound(),await this.showNotification("New Song Request",{body:`${t} requested: ${e}`,tag:"new-song-request"})}async notifyUserLogin(e,t){this.playSound(),await this.showNotification("User Logged In",{body:`${e} (${t}) has logged in`,tag:"user-login"})}async notifyNewFanMessage(e,t){this.playSound(),await this.showNotification("New Fan Message",{body:`${e} from ${t}`,tag:"new-fan-message"})}},ze=({onClose:a})=>{var l;const{profilePicture:i}=e(),[n,o]=x.useState(!1),[d,c]=x.useState(null),[u,m]=x.useState(""),[b,y]=x.useState(""),[j,v]=x.useState(!1),[w,N]=x.useState(!1),[k,S]=x.useState(""),[C,z]=x.useState(!1),[P,T]=x.useState("dashboard"),[A,D]=x.useState([]),[E,I]=x.useState({total_visitors:0,page_visits:{},artist_logins:0,last_updated:(new Date).toISOString()}),[q,M]=x.useState({videoUpdates:[],loginFrequency:[],siteVisits:[]}),[F,O]=x.useState(!0),[U,B]=x.useState(null),H=x.useRef(null),{unreadCount:Y,updateUnreadCount:Q}=(e=>{const[s,r]=x.useState(0);x.useEffect(()=>{if(!e)return;const s=t.channel("fan_messages_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"fan_messages"},e=>{const t=e.new;Ce.notifyNewFanMessage(t.message_type,t.from_name||"Anonymous"),a()}).subscribe(),r=t.channel("song_requests_changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"song_requests"},e=>{const t=e.new;Ce.notifyNewSongRequest(t.song_title,t.requested_by_name||"Anonymous"),a()}).subscribe();return a(),()=>{s.unsubscribe(),r.unsubscribe()}},[e]);const a=async()=>{try{const{count:e}=await t.from("fan_messages").select("*",{count:"exact",head:!0}).eq("status","unread"),{count:s}=await t.from("song_requests").select("*",{count:"exact",head:!0}).eq("status","new"),a=(e||0)+(s||0);r(a),await Ce.updateBadge(a)}catch(e){}};return{unreadCount:s,updateUnreadCount:a}})(d);x.useEffect(()=>(document.body.classList.add("admin-panel-active"),()=>{document.body.classList.remove("admin-panel-active")}),[]),x.useEffect(()=>{(async()=>{var e;O(!0),B(null),H.current&&clearTimeout(H.current),H.current=setTimeout(()=>{B("Loading is taking longer than expected. Please check your connection."),O(!1);const e=localStorage.getItem("admin_session");if(e)try{const t=JSON.parse(e),s=i||localStorage.getItem("admin_profile_picture");s&&!t.user.profilePicture&&(t.user.profilePicture=s),c(t.user),o(!0)}catch(t){}},15e3);try{const s=t.auth.getUser(),r=new Promise((e,t)=>setTimeout(()=>t(new Error("Auth timeout")),1e4)),{data:a}=await Promise.race([s,r]);if(null==a?void 0:a.user){const s=a.user.email||"";let r=null;if(s){const{data:e}=await t.from("users").select("*").eq("email",s).maybeSingle();e&&(r={id:e.id,email:e.email,role:e.role,phone:e.phone||"",name:e.full_name,profilePicture:i||localStorage.getItem("admin_profile_picture")||void 0})}const l=(null==(e=a.user.email)?void 0:e.split("@")[0])||"Admin",n=r||{id:a.user.id,email:s,role:"artist",phone:"",name:l,profilePicture:i||localStorage.getItem("admin_profile_picture")||void 0};c(n),o(!0),localStorage.setItem("admin_session",JSON.stringify({user:n}))}else{const e=localStorage.getItem("admin_session");if(e){const t=JSON.parse(e),s=i||localStorage.getItem("admin_profile_picture");s&&!t.user.profilePicture&&(t.user.profilePicture=s),c(t.user),o(!0)}}}catch(s){B((null==s?void 0:s.message)||"Failed to initialize. Please try refreshing.");try{const e=localStorage.getItem("admin_session");if(e){const t=JSON.parse(e),s=i||localStorage.getItem("admin_profile_picture");s&&!t.user.profilePicture&&(t.user.profilePicture=s),c(t.user),o(!0)}}catch(r){}}finally{H.current&&(clearTimeout(H.current),H.current=null),O(!1),Z().catch(e=>{})}})().catch(e=>{O(!1),B("Failed to initialize. Please refresh the page.")})},[i]);const Z=async(e=0)=>{try{const{getVideos:t,getSettings:s}=await r(async()=>{const{getVideos:e,getSettings:t}=await import("./index-Bj3hcO3F.js").then(e=>e.h);return{getVideos:e,getSettings:t}},__vite__mapDeps([0,1,2,3])),a=await Promise.allSettled([t(),s()]);"fulfilled"===a[0].status&&a[0].value?D(a[0].value):"rejected"===a[0].status&&e<2&&setTimeout(()=>Z(e+1),2e3);let l=null;if("fulfilled"===a[1].status&&a[1].value?(l=a[1].value,I({total_visitors:(null==l?void 0:l.total_visits)||0,page_visits:{home:(null==l?void 0:l.total_visits)||0},artist_logins:(null==l?void 0:l.artist_logins)||0,last_updated:(new Date).toISOString()})):"rejected"===a[1].status&&e<2&&setTimeout(()=>Z(e+1),2e3),"fulfilled"===a[0].status&&a[0].value){const e=a[0].value,t=(e,t=2)=>{const s=[];for(let r=6;r>=0;r--){const a=new Date;a.setDate(a.getDate()-r);const l=Math.max(0,e+Math.floor(Math.random()*t*2-t));s.push({date:a.toISOString(),value:l})}return s},s=e.filter(e=>"completed"===e.status).length;M({videoUpdates:t(Math.floor(s/7),1),loginFrequency:t(Math.floor(((null==l?void 0:l.artist_logins)||0)/7||1),1),siteVisits:t(Math.floor(((null==l?void 0:l.total_visits)||0)/7),3)})}}catch(t){if(e<2){const t=Math.min(2e3*Math.pow(2,e),1e4);setTimeout(()=>Z(e+1),t)}}},K=async e=>{e.preventDefault();try{const{data:e,error:s}=await t.auth.signInWithPassword({email:u,password:b});if(s||!e.user)return void alert("Invalid email or password. Please check your credentials.");let a=null;const{data:l}=await t.from("users").select("*").eq("email",u).maybeSingle();l&&(a=l);const i=(null==a?void 0:a.avatar_url)||null,n=localStorage.getItem("admin_profile_picture"),d=i||n||void 0;i&&i!==n&&localStorage.setItem("admin_profile_picture",i);const p={id:(null==a?void 0:a.id)||e.user.id,email:u,role:(null==a?void 0:a.role)||"artist",phone:(null==a?void 0:a.phone)||"",name:(null==a?void 0:a.full_name)||u.split("@")[0]||"Admin",profilePicture:d};c(p),o(!0),localStorage.setItem("admin_session",JSON.stringify({user:p})),Ce.notifyUserLogin(p.name,p.role);const{getSettings:x,updateSettings:m}=await r(async()=>{const{getSettings:e,updateSettings:t}=await import("./index-Bj3hcO3F.js").then(e=>e.h);return{getSettings:e,updateSettings:t}},__vite__mapDeps([0,1,2,3])),h=await x(),g=(null==h?void 0:h.artist_logins)||0;await m({artist_logins:g+1})}catch(s){alert("Login failed due to a server error. Please try again.")}},X=async e=>{e.preventDefault();["artist@estherreign.com","editor@estherreign.com"].includes(k)?(z(!0),setTimeout(()=>{alert(`Password reset instructions have been sent to ${k}.\n\nFor demo purposes:\n- Artist password: artist2024\n- Editor password: editor2024`),N(!1),z(!1),S("")},1500)):alert("Email not found. Please check your email address.")};return n?s.jsxs("div",{className:"admin-panel fixed inset-0 bg-black overflow-hidden z-50 flex flex-col",children:[s.jsxs("div",{className:"fixed inset-0 z-0",children:[s.jsx(p,{}),s.jsx("div",{className:"absolute inset-0 bg-black/60 z-[1]"})]}),s.jsx("nav",{className:"flex-shrink-0 bg-black/95 backdrop-blur-xl border-b border-purple-500/30 relative z-[90]",style:{zIndex:90,position:"relative"},children:s.jsxs("div",{className:"container mx-auto px-4 md:px-6 py-4 flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[i||(null==d?void 0:d.profilePicture)?s.jsx("img",{src:i||(null==d?void 0:d.profilePicture)||"",alt:"Profile",className:"w-12 h-12 rounded-xl object-cover shadow-lg shadow-purple-500/30"}):s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-600 to-purple-700 rounded-xl flex items-center justify-center shadow-lg shadow-purple-500/30",children:s.jsx("span",{className:"text-white font-black text-xl",children:null==(l=null==d?void 0:d.name)?void 0:l.charAt(0)})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl md:text-2xl font-black text-white",children:"Esther Reign Admin"}),s.jsxs("p",{className:"text-sm text-purple-300",children:[null==d?void 0:d.name," â€¢ ","artist"===(null==d?void 0:d.role)?"Artist":"Editor"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[s.jsx(pe,{currentUser:d,externalUnreadCount:Y}),s.jsxs("button",{onClick:a,className:"px-3 py-2 md:px-4 bg-purple-500/10 hover:bg-purple-500/20 rounded-xl transition-all text-purple-200 border border-purple-500/20 flex items-center gap-1.5 md:gap-2 touch-manipulation min-h-[44px]",children:[s.jsx(J,{size:16,className:"md:w-[18px] md:h-[18px]"}),s.jsx("span",{className:"hidden md:inline",children:"View Site"})]}),s.jsxs("button",{onClick:async()=>{try{await t.auth.signOut()}catch(e){}o(!1),c(null),localStorage.removeItem("admin_session")},className:"px-3 py-2 md:px-4 bg-red-500/10 hover:bg-red-500/20 rounded-xl transition-all text-red-300 border border-red-500/20 flex items-center gap-1.5 md:gap-2 touch-manipulation min-h-[44px]",children:[s.jsx(ie,{size:16,className:"md:w-[18px] md:h-[18px]"}),s.jsx("span",{className:"hidden md:inline",children:"Logout"})]})]})]})}),s.jsxs("div",{className:"flex-1 overflow-hidden flex relative z-[50]",children:[s.jsx("aside",{className:"hidden lg:block w-64 bg-[#2d1b4e]/90 backdrop-blur-xl border-r border-purple-500/20 overflow-y-auto relative z-[40]",children:s.jsx("div",{className:"p-4 space-y-2",children:[{id:"dashboard",label:"Dashboard",icon:ne},{id:"videos",label:"Videos",icon:f},{id:"messages",label:"Messages",icon:L},{id:"songs",label:"Song Requests",icon:$},{id:"calendar",label:"Calendar",icon:R},{id:"financial",label:"Financial",icon:G},{id:"goals",label:"Goals",icon:W},{id:"analytics",label:"Analytics",icon:V},{id:"settings",label:"Settings",icon:oe}].map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>T(e.id),className:"w-full flex items-center gap-3 px-4 py-3 rounded-xl font-semibold transition-all "+(P===e.id?"bg-gradient-to-r from-purple-600 to-purple-700 text-white shadow-lg shadow-purple-500/30":"text-purple-200 hover:bg-purple-500/10 hover:text-white"),children:[s.jsx(t,{size:20}),s.jsx("span",{children:e.label})]},e.id)})})}),s.jsx("main",{className:"flex-1 overflow-y-auto relative z-[30]",children:s.jsxs("div",{className:"container mx-auto px-4 md:px-6 py-6 relative z-[30]",children:[s.jsx("div",{className:"lg:hidden mb-6",children:s.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2 scrollbar-hide touch-pan-x -mx-4 px-4",style:{WebkitOverflowScrolling:"touch",scrollbarWidth:"none",msOverflowStyle:"none"},children:[{id:"dashboard",label:"Dashboard",icon:ne},{id:"videos",label:"Videos",icon:f},{id:"messages",label:"Messages",icon:L},{id:"songs",label:"Songs",icon:$},{id:"calendar",label:"Calendar",icon:R},{id:"financial",label:"Financial",icon:G},{id:"goals",label:"Goals",icon:W},{id:"analytics",label:"Analytics",icon:V},{id:"settings",label:"Settings",icon:oe}].map(e=>{const t=e.icon;return s.jsxs("button",{onClick:()=>T(e.id),className:"flex-shrink-0 px-4 py-3 rounded-xl font-semibold transition-all flex items-center gap-2 text-sm min-h-[48px] min-w-[100px] touch-manipulation "+(P===e.id?"bg-gradient-to-r from-purple-600 to-purple-700 text-white shadow-lg shadow-purple-500/50":"bg-purple-500/10 text-purple-200 hover:bg-purple-500/20 active:bg-purple-500/30 border border-purple-500/20"),children:[s.jsx(t,{size:18}),s.jsx("span",{className:"whitespace-nowrap",children:e.label})]},e.id)})})}),s.jsx("div",{className:"lg:hidden mb-4",children:s.jsx(Se,{})}),"dashboard"===P&&s.jsxs("div",{className:"space-y-6",children:[s.jsx(me,{videoUpdates:q.videoUpdates,loginFrequency:q.loginFrequency,siteVisits:q.siteVisits}),s.jsxs("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsxs("div",{className:"bg-gradient-to-br from-purple-500/20 to-purple-600/20 backdrop-blur-xl rounded-2xl p-6 border border-purple-500/30 bg-black/40",children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsx("div",{className:"w-12 h-12 bg-purple-500/30 rounded-xl flex items-center justify-center",children:s.jsx(f,{size:24,className:"text-purple-400"})})}),s.jsx("h3",{className:"text-3xl font-black text-white text-shadow-strong mb-1",children:A.length}),s.jsx("p",{className:"text-purple-200 text-shadow text-sm font-semibold",children:"Total Videos"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-blue-500/20 to-blue-600/20 backdrop-blur-xl rounded-2xl p-6 border border-blue-500/30 bg-black/40",children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsx("div",{className:"w-12 h-12 bg-blue-500/30 rounded-xl flex items-center justify-center",children:s.jsx(V,{size:24,className:"text-blue-400"})})}),s.jsx("h3",{className:"text-3xl font-black text-white text-shadow-strong mb-1",children:E.total_visitors}),s.jsx("p",{className:"text-blue-200 text-shadow text-sm font-semibold",children:"Total Visitors"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-green-500/20 to-green-600/20 backdrop-blur-xl rounded-2xl p-6 border border-green-500/30 bg-black/40",children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsx("div",{className:"w-12 h-12 bg-green-500/30 rounded-xl flex items-center justify-center",children:s.jsx(h,{size:24,className:"text-green-400"})})}),s.jsx("h3",{className:"text-3xl font-black text-white text-shadow-strong mb-1",children:A.filter(e=>"completed"===e.status).length}),s.jsx("p",{className:"text-green-200 text-shadow text-sm font-semibold",children:"Published"})]}),s.jsxs("div",{className:"bg-gradient-to-br from-orange-500/20 to-orange-600/20 backdrop-blur-xl rounded-2xl p-6 border border-orange-500/30 bg-black/40",children:[s.jsx("div",{className:"flex items-center justify-between mb-4",children:s.jsx("div",{className:"w-12 h-12 bg-orange-500/20 rounded-xl flex items-center justify-center",children:s.jsx(_,{size:24,className:"text-orange-400"})})}),s.jsx("h3",{className:"text-3xl font-black text-white text-shadow-strong mb-1",children:E.artist_logins}),s.jsx("p",{className:"text-orange-200 text-shadow text-sm font-semibold",children:"Admin Logins"})]})]}),s.jsxs("div",{className:"bg-gradient-to-br from-purple-500/20 to-purple-600/20 backdrop-blur-xl rounded-2xl p-8 border border-purple-500/30 bg-black/40",children:[s.jsxs("h2",{className:"text-2xl font-black text-white text-shadow-strong mb-2",children:["Welcome back, ",null==d?void 0:d.name,"! ðŸ‘‹"]}),s.jsx("p",{className:"text-purple-100 text-shadow mb-6 font-medium",children:"Here's what's happening with your platform today."}),s.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[s.jsxs("div",{className:"bg-purple-500/10 rounded-xl p-4 border border-purple-500/20",children:[s.jsx("p",{className:"text-purple-300 text-sm mb-1",children:"Active Videos"}),s.jsx("p",{className:"text-2xl font-bold text-white",children:A.filter(e=>"completed"===e.status).length})]}),s.jsxs("div",{className:"bg-purple-500/10 rounded-xl p-4 border border-purple-500/20",children:[s.jsx("p",{className:"text-purple-300 text-sm mb-1",children:"Pending"}),s.jsx("p",{className:"text-2xl font-bold text-white",children:A.filter(e=>"pending"===e.status).length})]}),s.jsxs("div",{className:"bg-purple-500/10 rounded-xl p-4 border border-purple-500/20",children:[s.jsx("p",{className:"text-purple-300 text-sm mb-1",children:"Total Views"}),s.jsx("p",{className:"text-2xl font-bold text-white",children:E.total_visitors})]})]})]})]}),"videos"===P&&s.jsx("div",{className:"bg-black/60 backdrop-blur-sm rounded-2xl p-6 border border-purple-500/20",children:s.jsx(xe,{})}),"messages"===P&&s.jsx("div",{className:"bg-black/60 backdrop-blur-sm rounded-2xl p-6 border border-purple-500/20",children:s.jsx(be,{})}),"songs"===P&&s.jsx("div",{className:"bg-black/60 backdrop-blur-sm rounded-2xl p-6 border border-purple-500/20",children:s.jsx(fe,{})}),"calendar"===P&&s.jsx("div",{className:"bg-black/60 backdrop-blur-sm rounded-2xl p-6 border border-purple-500/20",children:s.jsx(ye,{})}),"financial"===P&&s.jsx("div",{className:"bg-black/60 backdrop-blur-sm rounded-2xl p-6 border border-purple-500/20",children:s.jsx(we,{})}),"goals"===P&&s.jsx("div",{className:"bg-black/60 backdrop-blur-sm rounded-2xl p-6 border border-purple-500/20",children:s.jsx(Ne,{})}),"analytics"===P&&s.jsx("div",{className:"bg-black/60 backdrop-blur-sm rounded-2xl p-6 border border-purple-500/20",children:s.jsx(ke,{})}),"settings"===P&&s.jsx("div",{className:"bg-black/60 backdrop-blur-sm rounded-2xl p-6 border border-purple-500/20",children:s.jsx(ge,{})})]})})]}),d&&s.jsx(ue,{currentUser:d,videos:A})]}):s.jsxs("div",{className:"admin-panel fixed inset-0 bg-black flex items-center justify-center z-50 overflow-y-auto p-4",style:{minHeight:"100dvh",width:"100vw",maxWidth:"100vw",overflowX:"hidden"},children:[s.jsx(p,{}),s.jsx("button",{onClick:a,className:"absolute top-4 right-4 p-3 bg-purple-500/20 hover:bg-purple-500/30 rounded-xl transition-all border-2 border-purple-500/40 backdrop-blur-sm z-[100] touch-manipulation shadow-lg shadow-purple-500/30",style:{minWidth:"48px",minHeight:"48px",position:"fixed",top:"1rem",right:"1rem",zIndex:1e3},children:s.jsx(g,{size:24,className:"text-white"})}),F&&s.jsx("div",{className:"absolute top-20 left-1/2 transform -translate-x-1/2 z-20 max-w-md w-full px-4",children:s.jsxs("div",{className:"bg-purple-500/20 backdrop-blur-xl rounded-xl p-4 border border-purple-500/30 text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-400 mx-auto mb-2"}),s.jsx("p",{className:"text-purple-200 text-sm",children:"Loading admin panel..."})]})}),U&&!F&&s.jsx("div",{className:"absolute top-20 left-1/2 transform -translate-x-1/2 z-20 max-w-md w-full px-4",children:s.jsxs("div",{className:"bg-red-500/20 backdrop-blur-xl rounded-xl p-4 border border-red-500/30 text-center",children:[s.jsx("p",{className:"text-red-200 text-sm mb-2",children:U}),s.jsx("button",{onClick:()=>window.location.reload(),className:"text-xs text-red-300 underline hover:text-red-200 touch-manipulation",style:{minHeight:"44px"},children:"Refresh Page"})]})}),s.jsx("div",{className:"max-w-lg w-full my-auto relative z-10 px-4",style:{minHeight:"auto",opacity:F?.5:1,maxWidth:"calc(100vw - 2rem)"},children:s.jsxs("div",{className:"bg-black/90 backdrop-blur-2xl rounded-3xl p-6 md:p-8 border border-purple-500/30 shadow-2xl",style:{maxWidth:"100%"},children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-purple-600 to-purple-700 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg shadow-purple-500/50",children:s.jsx(_,{size:48,className:"text-white"})}),s.jsx("h2",{className:"text-4xl font-black text-white mb-3",children:"Admin Panel"}),s.jsx("p",{className:"text-purple-200",children:"Enter your credentials to access the admin dashboard"})]}),w?s.jsxs("form",{onSubmit:X,className:"space-y-5",children:[s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("div",{className:"w-16 h-16 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-3",children:s.jsx(le,{size:32,className:"text-purple-300"})}),s.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Reset Password"}),s.jsx("p",{className:"text-sm text-purple-200",children:"Enter your email to receive reset instructions"})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-purple-200 mb-2",children:"Email Address"}),s.jsx("input",{type:"email",value:k,onChange:e=>S(e.target.value),className:"w-full px-4 py-3 bg-purple-500/10 border border-purple-500/30 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all text-white placeholder-purple-400",placeholder:"Enter your email",required:!0})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{type:"button",onClick:()=>{N(!1),S("")},className:"flex-1 bg-purple-500/10 border border-purple-500/30 text-purple-200 px-6 py-3 rounded-xl font-semibold transition-all hover:bg-purple-500/20",children:"Back"}),s.jsx("button",{type:"submit",disabled:C,className:"flex-1 bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-3 rounded-xl font-semibold transition-all hover:shadow-lg hover:shadow-purple-500/50 disabled:opacity-50 disabled:cursor-not-allowed",children:C?"Sending...":"Send Reset Link"})]})]}):s.jsxs("form",{onSubmit:K,className:"space-y-5",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-purple-200 mb-2",children:"Email Address"}),s.jsx("input",{type:"email",value:u,onChange:e=>m(e.target.value),className:"w-full px-4 py-3 bg-purple-500/10 border border-purple-500/30 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all text-white placeholder-purple-400",placeholder:"Enter your email",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-purple-200 mb-2",children:"Password"}),s.jsxs("div",{className:"relative",children:[s.jsx("input",{type:j?"text":"password",value:b,onChange:e=>y(e.target.value),className:"w-full px-4 py-3 pr-12 bg-purple-500/10 border border-purple-500/30 rounded-xl focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all text-white placeholder-purple-400",placeholder:"Enter your password",required:!0}),s.jsx("button",{type:"button",onClick:()=>v(!j),className:"absolute right-3 top-1/2 -translate-y-1/2 p-2 text-purple-300 hover:text-purple-200 transition-colors",style:{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:j?s.jsx(ae,{size:20}):s.jsx(J,{size:20})})]})]}),s.jsx("div",{className:"flex items-center justify-between text-sm",children:s.jsxs("button",{type:"button",onClick:()=>N(!0),className:"text-purple-300 hover:text-purple-200 transition-colors flex items-center gap-1",children:[s.jsx(le,{size:16}),"Forgot Password?"]})}),s.jsx("button",{type:"submit",className:"w-full bg-gradient-to-r from-purple-600 to-purple-700 text-white px-6 py-4 rounded-xl font-bold text-lg transition-all hover:shadow-lg hover:shadow-purple-500/50 hover:scale-[1.02] active:scale-[0.98]",children:"Sign In"}),s.jsx(_e,{})]})]})})]})};export{ze as default};
