import{s as t}from"./index-BXC4dLVF.js";import"./react-vendor-9mwbaf1v.js";import"./icons-D3sHNqvn.js";const e=async()=>{try{const{data:e,error:r}=await t.from("videos").select("*").order("order_index",{ascending:!0});if(r)throw r;return e||[]}catch(e){return[]}},r=async()=>{try{const{data:e,error:r}=await t.from("videos").select("*").eq("status","completed").order("order_index",{ascending:!0});if(r)throw r;return e||[]}catch(e){return[]}},a=async e=>{try{const r={id:`video_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,...e,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{data:a,error:n}=await t.from("videos").insert([r]).select().single();if(n)throw n;return a}catch(r){return null}},n=async(e,r)=>{try{const{error:a}=await t.from("videos").update({...r,updated_at:(new Date).toISOString()}).eq("id",e);if(a)throw a;return!0}catch(a){return!1}},s=async e=>{try{const{error:r}=await t.from("videos").delete().eq("id",e);if(r)throw r;return!0}catch(r){return!1}},o=async e=>{try{const r=e.map((t,e)=>({id:t.id,order_index:e,updated_at:(new Date).toISOString()})),{error:a}=await t.from("videos").upsert(r);if(a)throw a;return!0}catch(r){return!1}},i=async()=>{try{const{data:e,error:r}=await t.from("site_settings").select("*").eq("id","main").single();if(r)throw r;return e}catch(e){return null}},c=async e=>{try{const{error:r}=await t.from("site_settings").update({...e,updated_at:(new Date).toISOString()}).eq("id","main");if(r)throw r;return!0}catch(r){return!1}},d=async()=>{try{const e=await i(),r=(null==e?void 0:e.total_visits)||0;await t.from("site_settings").update({total_visits:r+1,updated_at:(new Date).toISOString()}).eq("id","main")}catch(e){}},u=r=>{const a=t.channel("videos_changes").on("postgres_changes",{event:"*",schema:"public",table:"videos"},async()=>{const t=await e();r(t)}).subscribe();return()=>{t.removeChannel(a)}},h=e=>{const r=t.channel("settings_changes").on("postgres_changes",{event:"*",schema:"public",table:"site_settings"},async()=>{const t=await i();e(t)}).subscribe();return()=>{t.removeChannel(r)}};export{a as addVideo,s as deleteVideo,r as getCompletedVideos,i as getSettings,e as getVideos,o as reorderVideos,h as subscribeToSettings,u as subscribeToVideos,d as trackVisit,c as updateSettings,n as updateVideo};
