const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminPanel-y7PPT_A6.js","assets/react-vendor-9mwbaf1v.js","assets/icons-D5yLDmOY.js"])))=>i.map(i=>d[i]);
import{r as e,a as t,g as r,c as s}from"./react-vendor-9mwbaf1v.js";import{G as n,C as i,S as o,H as a,M as l,a as c,b as h,X as u,c as d,d as p,e as f,I as m,Y as g,P as v,f as b}from"./icons-D5yLDmOY.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var w={exports:{}},y={},_=e,x=Symbol.for("react.element"),k=Symbol.for("react.fragment"),S=Object.prototype.hasOwnProperty,j=_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,T={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,r){var s,n={},i=null,o=null;for(s in void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(o=t.ref),t)S.call(t,s)&&!T.hasOwnProperty(s)&&(n[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===n[s]&&(n[s]=t[s]);return{$$typeof:x,type:e,key:i,ref:o,props:n,_owner:j.current}}y.Fragment=k,y.jsx=E,y.jsxs=E,w.exports=y;var P,O=w.exports,C=t;P=C.createRoot,C.hydrateRoot;const A={},N=function(e,t,r){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));s=Promise.allSettled(t.map(e=>{if((e=function(e){return"/Esther_Platform/"+e}(e))in A)return;A[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,r&&n.setAttribute("nonce",r),document.head.appendChild(n),t?new Promise((t,r)=>{n.addEventListener("load",t),n.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};function I(e){return n({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"},child:[]}]})(e)}function R(e){return n({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448,209.91a210.06,210.06,0,0,1-122.77-39.25V349.38A162.55,162.55,0,1,1,185,188.31V278.2a74.62,74.62,0,1,0,52.23,71.18V0l88,0a121.18,121.18,0,0,0,1.86,22.17h0A122.18,122.18,0,0,0,381,102.39a121.43,121.43,0,0,0,67,20.14Z"},child:[]}]})(e)}const $=()=>O.jsx("div",{className:"fixed inset-0 bg-gray-950 flex items-center justify-center z-50",children:O.jsxs("div",{className:"relative",children:[O.jsxs("div",{className:"w-32 h-32 relative",children:[O.jsx("div",{className:"absolute inset-0 border-4 border-purple-600/30 rounded-full"}),O.jsx("div",{className:"absolute inset-0 border-4 border-transparent border-t-purple-600 rounded-full animate-spin"}),O.jsx("div",{className:"absolute inset-2 border-4 border-transparent border-t-pink-600 rounded-full animate-spin-slow"}),O.jsx("div",{className:"absolute inset-4 border-4 border-transparent border-t-blue-600 rounded-full animate-spin-reverse"})]}),O.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:O.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full animate-pulse"})}),O.jsx("div",{className:"mt-8 text-center",children:O.jsx("p",{className:"text-white text-xl font-bold animate-pulse neon-text",children:"Loading..."})})]})});function L(){const t=e.useRef(null);return e.useEffect(()=>{const e=t.current;if(!e)return;const r=e.getContext("webgl")||e.getContext("experimental-webgl"),s=window.innerWidth<=768;if(!r)return;s&&(e.width=Math.min(window.innerWidth,800),e.height=Math.min(window.innerHeight,1200));const n=()=>{window.innerWidth<=768?(e.width=Math.min(window.innerWidth,800),e.height=Math.min(window.innerHeight,1200)):(e.width=window.innerWidth,e.height=window.innerHeight),r.viewport(0,0,e.width,e.height)};n(),window.addEventListener("resize",n);const i=(e,t)=>{const s=r.createShader(t);return s?(r.shaderSource(s,e),r.compileShader(s),r.getShaderParameter(s,r.COMPILE_STATUS)?s:(r.deleteShader(s),null)):null},o=i("\n      attribute vec2 a_position;\n      varying vec2 v_uv;\n      void main() {\n        gl_Position = vec4(a_position, 0.0, 1.0);\n        v_uv = a_position * 0.5 + 0.5;\n      }\n    ",r.VERTEX_SHADER),a=i("\n      precision mediump float;\n      uniform float u_time;\n      uniform vec2 u_resolution;\n      varying vec2 v_uv;\n      \n      // Noise function for organic wave patterns\n      float noise(vec2 p) {\n        return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453);\n      }\n      \n      // Smooth noise\n      float smoothNoise(vec2 p) {\n        vec2 i = floor(p);\n        vec2 f = fract(p);\n        f = f * f * (3.0 - 2.0 * f);\n        \n        float a = noise(i);\n        float b = noise(i + vec2(1.0, 0.0));\n        float c = noise(i + vec2(0.0, 1.0));\n        float d = noise(i + vec2(1.0, 1.0));\n        \n        return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);\n      }\n      \n      // Multiple octaves for flowing effect\n      float fbm(vec2 p) {\n        float value = 0.0;\n        float amplitude = 0.5;\n        for(int i = 0; i < 4; i++) {\n          value += amplitude * smoothNoise(p);\n          p *= 2.0;\n          amplitude *= 0.5;\n        }\n        return value;\n      }\n      \n      void main() {\n        vec2 uv = v_uv;\n        vec2 p = uv * 3.0;\n        \n        // Animate the waves\n        p.y += u_time * 0.2;\n        p.x += sin(u_time * 0.15) * 0.3;\n        \n        // Create flowing wave patterns\n        float wave1 = sin(p.y * 2.0 + u_time * 0.5) * 0.5 + 0.5;\n        float wave2 = sin(p.x * 1.5 + p.y * 2.5 + u_time * 0.3) * 0.5 + 0.5;\n        float wave3 = fbm(p * 0.8 + vec2(u_time * 0.1, u_time * 0.15));\n        \n        // Combine waves for flowing effect\n        float combined = wave1 * 0.4 + wave2 * 0.3 + wave3 * 0.3;\n        \n        // Create depth with multiple layers\n        float depth1 = smoothstep(0.3, 0.7, combined);\n        float depth2 = smoothstep(0.5, 0.9, combined);\n        float depth3 = smoothstep(0.7, 1.0, combined);\n        \n        // Purple color palette matching the image\n        // Deep black base\n        vec3 baseColor = vec3(0.0, 0.0, 0.0);\n        \n        // Deep purple shadows (plum/indigo)\n        vec3 shadowColor = vec3(0.15, 0.05, 0.25);\n        \n        // Medium purple\n        vec3 midColor = vec3(0.35, 0.15, 0.50);\n        \n        // Vibrant purple highlights (magenta-purple)\n        vec3 highlightColor = vec3(0.65, 0.25, 0.85);\n        \n        // Bright magenta highlights\n        vec3 brightColor = vec3(0.85, 0.40, 0.95);\n        \n        // Mix colors based on depth - More visible waves\n        vec3 color = baseColor;\n        color = mix(color, shadowColor, depth1 * 0.8);\n        color = mix(color, midColor, depth2 * 0.7);\n        color = mix(color, highlightColor, depth3 * 0.6);\n        color = mix(color, brightColor, smoothstep(0.85, 1.0, combined) * 0.5);\n        \n        // Add subtle lighting from top-left\n        vec2 lightDir = normalize(vec2(-0.5, -0.5));\n        vec2 toLight = lightDir;\n        float light = dot(normalize(vec2(combined - 0.5, 0.1)), toLight) * 0.5 + 0.5;\n        color *= (0.8 + light * 0.4);\n        \n        // Add subtle texture overlay\n        float texture = smoothNoise(uv * 20.0 + u_time * 0.1) * 0.05 + 0.95;\n        color *= texture;\n        \n        // Make waves more visible - higher alpha\n        float alpha = max(combined * 1.2, 0.3);\n        \n        gl_FragColor = vec4(color, alpha);\n      }\n    ",r.FRAGMENT_SHADER);if(!o||!a)return;const l=r.createProgram();if(!l)return;if(r.attachShader(l,o),r.attachShader(l,a),r.linkProgram(l),!r.getProgramParameter(l,r.LINK_STATUS))return;r.useProgram(l);const c=r.getAttribLocation(l,"a_position"),h=r.getUniformLocation(l,"u_time"),u=r.getUniformLocation(l,"u_resolution"),d=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,d);const p=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);let f;r.bufferData(r.ARRAY_BUFFER,p,r.STATIC_DRAW),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);let m=Date.now();const g=()=>{const t=(Date.now()-m)/1e3;r.uniform1f(h,t),r.uniform2f(u,e.width,e.height),r.enableVertexAttribArray(c),r.bindBuffer(r.ARRAY_BUFFER,d),r.vertexAttribPointer(c,2,r.FLOAT,!1,0,0),r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLES,0,6),f=requestAnimationFrame(g)};return g(),()=>{window.removeEventListener("resize",n),cancelAnimationFrame(f),r.deleteProgram(l),r.deleteShader(o),r.deleteShader(a)}},[]),O.jsxs(O.Fragment,{children:[O.jsx("div",{className:"fixed inset-0 pointer-events-none",style:{zIndex:0,backgroundColor:"#000000"},children:O.jsx("canvas",{ref:t,className:"w-full h-full",style:{display:"block",opacity:0}})}),O.jsx("div",{className:"fixed inset-0 pointer-events-none",style:{background:"#000000",zIndex:0}})]})}function U(){const t=e.useRef(null);return e.useEffect(()=>{const e=t.current;if(!e)return;const r=e.getContext("webgl")||e.getContext("experimental-webgl");if(!r)return;const s=e.parentElement,n=()=>{if(s){const t=s.getBoundingClientRect(),n=1.5*Math.max(t.width,t.height);e.width=n,e.height=n,r.viewport(0,0,e.width,e.height)}};n();const i=new ResizeObserver(n);s&&i.observe(s),window.addEventListener("resize",n);const o=(e,t)=>{const s=r.createShader(t);return s?(r.shaderSource(s,e),r.compileShader(s),r.getShaderParameter(s,r.COMPILE_STATUS)?s:(r.deleteShader(s),null)):null},a=o("\n      attribute vec2 a_position;\n      varying vec2 v_uv;\n      void main() {\n        gl_Position = vec4(a_position, 0.0, 1.0);\n        v_uv = a_position * 0.5 + 0.5;\n      }\n    ",r.VERTEX_SHADER),l=o("\n      precision mediump float;\n      uniform float u_time;\n      uniform vec2 u_resolution;\n      varying vec2 v_uv;\n      \n      void main() {\n        vec2 uv = v_uv;\n        vec2 center = vec2(0.5, 0.5);\n        float dist = distance(uv, center);\n        \n        // Create smooth radial gradient\n        float glow = 1.0 - smoothstep(0.3, 0.7, dist);\n        \n        // Add subtle pulse animation\n        float pulse = sin(u_time * 1.5) * 0.1 + 0.9;\n        glow *= pulse;\n        \n        // Sleek purple color - subtle and elegant\n        vec3 purple = vec3(0.65, 0.25, 0.85); // Vibrant purple\n        vec3 color = purple * glow * 0.6; // 60% opacity for subtlety\n        \n        // Fade out at edges\n        float edgeFade = 1.0 - smoothstep(0.6, 1.0, dist);\n        color *= edgeFade;\n        \n        gl_FragColor = vec4(color, glow * 0.4 * edgeFade); // 40% max alpha\n      }\n    ",r.FRAGMENT_SHADER);if(!a||!l)return;const c=r.createProgram();if(!c)return;if(r.attachShader(c,a),r.attachShader(c,l),r.linkProgram(c),!r.getProgramParameter(c,r.LINK_STATUS))return;r.useProgram(c);const h=r.getAttribLocation(c,"a_position"),u=r.getUniformLocation(c,"u_time"),d=r.getUniformLocation(c,"u_resolution"),p=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,p);const f=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);let m;r.bufferData(r.ARRAY_BUFFER,f,r.STATIC_DRAW),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);let g=Date.now();const v=()=>{const t=(Date.now()-g)/1e3;r.uniform1f(u,t),r.uniform2f(d,e.width,e.height),r.enableVertexAttribArray(h),r.bindBuffer(r.ARRAY_BUFFER,p),r.vertexAttribPointer(h,2,r.FLOAT,!1,0,0),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.drawArrays(r.TRIANGLES,0,6),m=requestAnimationFrame(v)};return v(),()=>{i.disconnect(),window.removeEventListener("resize",n),cancelAnimationFrame(m),c&&r.deleteProgram(c),a&&r.deleteShader(a),l&&r.deleteShader(l)}},[]),O.jsxs("div",{className:"absolute inset-0 pointer-events-none",style:{zIndex:0,borderRadius:"50%",overflow:"hidden"},children:[O.jsx("canvas",{ref:t,className:"w-full h-full",style:{display:"block",borderRadius:"50%"}}),O.jsx("div",{className:"absolute inset-0",style:{background:"radial-gradient(circle, rgba(168, 85, 247, 0.4) 0%, rgba(139, 92, 246, 0.2) 50%, transparent 80%)",borderRadius:"50%",animation:"pulse 3s ease-in-out infinite"}})]})}class D extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class B extends D{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class q extends D{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class M extends D{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var W,z;(z=W||(W={})).Any="any",z.ApNortheast1="ap-northeast-1",z.ApNortheast2="ap-northeast-2",z.ApSouth1="ap-south-1",z.ApSoutheast1="ap-southeast-1",z.ApSoutheast2="ap-southeast-2",z.CaCentral1="ca-central-1",z.EuCentral1="eu-central-1",z.EuWest1="eu-west-1",z.EuWest2="eu-west-2",z.EuWest3="eu-west-3",z.SaEast1="sa-east-1",z.UsEast1="us-east-1",z.UsWest1="us-west-1",z.UsWest2="us-west-2";var F=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};class H{constructor(e,{headers:t={},customFetch:r,region:s=W.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=(e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>N(async()=>{const{default:e}=await Promise.resolve().then(()=>ne);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)})(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return F(this,void 0,void 0,function*(){try{const{headers:s,method:n,body:i}=t;let o={},{region:a}=t;a||(a=this.region);const l=new URL(`${this.url}/${e}`);let c;a&&"any"!==a&&(o["x-region"]=a,l.searchParams.set("forceFunctionRegion",a)),i&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&("undefined"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",c=i):"string"==typeof i?(o["Content-Type"]="text/plain",c=i):"undefined"!=typeof FormData&&i instanceof FormData?c=i:(o["Content-Type"]="application/json",c=JSON.stringify(i)));const h=yield this.fetch(l.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),s),body:c}).catch(e=>{throw new B(e)}),u=h.headers.get("x-relay-error");if(u&&"true"===u)throw new q(h);if(!h.ok)throw new M(h);let d,p=(null!==(r=h.headers.get("Content-Type"))&&void 0!==r?r:"text/plain").split(";")[0].trim();return d="application/json"===p?yield h.json():"application/octet-stream"===p?yield h.blob():"text/event-stream"===p?h:"multipart/form-data"===p?yield h.formData():yield h.text(),{data:d,error:null,response:h}}catch(s){return{data:null,error:s,response:s instanceof M||s instanceof q?s.context:void 0}}})}}var V={},K={},J={},G={},Y={},X={},Q=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const Z=Q.fetch,ee=Q.fetch.bind(Q),te=Q.Headers,re=Q.Request,se=Q.Response,ne=Object.freeze(Object.defineProperty({__proto__:null,Headers:te,Request:re,Response:se,default:ee,fetch:Z},Symbol.toStringTag,{value:"Module"})),ie=r(ne);var oe={};Object.defineProperty(oe,"__esModule",{value:!0});let ae=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};oe.default=ae;var le=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(X,"__esModule",{value:!0});const ce=le(ie),he=le(oe);X.default=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(r=e.isMaybeSingle)&&void 0!==r&&r,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=ce.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let r=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,r,s,n;let i=null,o=null,a=null,l=e.status,c=e.statusText;if(e.ok){if("HEAD"!==this.method){const r=await e.text();""===r||(o="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?r:JSON.parse(r))}const n=null===(r=this.headers.get("Prefer"))||void 0===r?void 0:r.match(/count=(exact|planned|estimated)/),h=null===(s=e.headers.get("content-range"))||void 0===s?void 0:s.split("/");n&&h&&h.length>1&&(a=parseInt(h[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(o)&&(o.length>1?(i={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,a=null,l=406,c="Not Acceptable"):o=1===o.length?o[0]:null)}else{const t=await e.text();try{i=JSON.parse(t),Array.isArray(i)&&404===e.status&&(o=[],i=null,l=200,c="OK")}catch(h){404===e.status&&""===t?(l=204,c="No Content"):i={message:t}}if(i&&this.isMaybeSingle&&(null===(n=null==i?void 0:i.details)||void 0===n?void 0:n.includes("0 rows"))&&(i=null,l=200,c="OK"),i&&this.shouldThrowOnError)throw new he.default(i)}return{error:i,data:o,count:a,status:l,statusText:c}});return this.shouldThrowOnError||(r=r.catch(e=>{var t,r,s;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(r=null==e?void 0:e.stack)&&void 0!==r?r:""}`,hint:"",code:`${null!==(s=null==e?void 0:e.code)&&void 0!==s?s:""}`},data:null,count:null,status:0,statusText:""}})),r.then(e,t)}returns(){return this}overrideTypes(){return this}};var ue=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Y,"__esModule",{value:!0});const de=ue(X);let pe=class extends de.default{select(e){let t=!1;const r=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:n=s}={}){const i=n?`${n}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===r?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const n=void 0===s?"offset":`${s}.offset`,i=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:n=!1,format:i="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.get("Accept"))&&void 0!==o?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};Y.default=pe;var fe=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(G,"__esModule",{value:!0});const me=fe(Y);let ge=class extends me.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let n="";"plain"===s?n="pl":"phrase"===s?n="ph":"websearch"===s&&(n="w");const i=void 0===r?"":`(${r})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};G.default=ge;var ve=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(J,"__esModule",{value:!0});const be=ve(G);J.default=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let n=!1;const i=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e)).join("");return this.url.searchParams.set("select",i),r&&this.headers.append("Prefer",`count=${r}`),new be.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var s;if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new be.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:n=!0}={}){var i;if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),void 0!==t&&this.url.searchParams.set("on_conflict",t),s&&this.headers.append("Prefer",`count=${s}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new be.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}update(e,{count:t}={}){var r;return t&&this.headers.append("Prefer",`count=${t}`),new be.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}delete({count:e}={}){var t;return e&&this.headers.append("Prefer",`count=${e}`),new be.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}};var we=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(K,"__esModule",{value:!0});const ye=we(J),_e=we(G);K.default=class e{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new ye.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:n}={}){var i;let o;const a=new URL(`${this.url}/rpc/${e}`);let l;r||s?(o=r?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{a.searchParams.append(e,t)})):(o="POST",l=t);const c=new Headers(this.headers);return n&&c.set("Prefer",`count=${n}`),new _e.default({method:o,url:a,headers:c,schema:this.schemaName,body:l,fetch:null!==(i=this.fetch)&&void 0!==i?i:fetch})}};var xe=s&&s.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(V,"__esModule",{value:!0}),V.PostgrestError=V.PostgrestBuilder=V.PostgrestTransformBuilder=V.PostgrestFilterBuilder=V.PostgrestQueryBuilder=V.PostgrestClient=void 0;const ke=xe(K);V.PostgrestClient=ke.default;const Se=xe(J);V.PostgrestQueryBuilder=Se.default;const je=xe(G);V.PostgrestFilterBuilder=je.default;const Te=xe(Y);V.PostgrestTransformBuilder=Te.default;const Ee=xe(X);V.PostgrestBuilder=Ee.default;const Pe=xe(oe);V.PostgrestError=Pe.default;var Oe=V.default={PostgrestClient:ke.default,PostgrestQueryBuilder:Se.default,PostgrestFilterBuilder:je.default,PostgrestTransformBuilder:Te.default,PostgrestBuilder:Ee.default,PostgrestError:Pe.default};const{PostgrestClient:Ce,PostgrestQueryBuilder:Ae,PostgrestFilterBuilder:Ne,PostgrestTransformBuilder:Ie,PostgrestBuilder:Re,PostgrestError:$e}=Oe;class Le{static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){const e=process.versions;if(e&&e.node){const t=e.node,r=parseInt(t.replace(/^v/,"").split(".")[0]);return r>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${r} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${r} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const Ue=1e4;var De,Be,qe,Me,We,ze,Fe,He,Ve,Ke,Je;(Be=De||(De={}))[Be.connecting=0]="connecting",Be[Be.open=1]="open",Be[Be.closing=2]="closing",Be[Be.closed=3]="closed",(Me=qe||(qe={})).closed="closed",Me.errored="errored",Me.joined="joined",Me.joining="joining",Me.leaving="leaving",(ze=We||(We={})).close="phx_close",ze.error="phx_error",ze.join="phx_join",ze.reply="phx_reply",ze.leave="phx_leave",ze.access_token="access_token",(Fe||(Fe={})).websocket="websocket",(Ve=He||(He={})).Connecting="connecting",Ve.Open="open",Ve.Closing="closing",Ve.Closed="closed";class Ge{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),n=t.getUint8(2);let i=this.HEADER_LENGTH+2;const o=r.decode(e.slice(i,i+s));i+=s;const a=r.decode(e.slice(i,i+n));i+=n;return{ref:null,topic:o,event:a,payload:JSON.parse(r.decode(e.slice(i,e.byteLength)))}}}class Ye{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(Je=Ke||(Ke={})).abstime="abstime",Je.bool="bool",Je.date="date",Je.daterange="daterange",Je.float4="float4",Je.float8="float8",Je.int2="int2",Je.int4="int4",Je.int4range="int4range",Je.int8="int8",Je.int8range="int8range",Je.json="json",Je.jsonb="jsonb",Je.money="money",Je.numeric="numeric",Je.oid="oid",Je.reltime="reltime",Je.text="text",Je.time="time",Je.timestamp="timestamp",Je.timestamptz="timestamptz",Je.timetz="timetz",Je.tsrange="tsrange",Je.tstzrange="tstzrange";const Xe=(e,t,r={})=>{var s;const n=null!==(s=r.skipTypes)&&void 0!==s?s:[];return Object.keys(t).reduce((r,s)=>(r[s]=Qe(s,e,t,n),r),{})},Qe=(e,t,r,s)=>{const n=t.find(t=>t.name===e),i=null==n?void 0:n.type,o=r[e];return i&&!s.includes(i)?Ze(i,o):et(o)},Ze=(e,t)=>{if("_"===e.charAt(0)){const r=e.slice(1,e.length);return nt(t,r)}switch(e){case Ke.bool:return tt(t);case Ke.float4:case Ke.float8:case Ke.int2:case Ke.int4:case Ke.int8:case Ke.numeric:case Ke.oid:return rt(t);case Ke.json:case Ke.jsonb:return st(t);case Ke.timestamp:return it(t);case Ke.abstime:case Ke.date:case Ke.daterange:case Ke.int4range:case Ke.int8range:case Ke.money:case Ke.reltime:case Ke.text:case Ke.time:case Ke.timestamptz:case Ke.timetz:case Ke.tsrange:case Ke.tstzrange:default:return et(t)}},et=e=>e,tt=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},rt=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},st=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return e}return e},nt=(e,t)=>{if("string"!=typeof e)return e;const r=e.length-1,s=e[r];if("{"===e[0]&&"}"===s){let s;const i=e.slice(1,r);try{s=JSON.parse("["+i+"]")}catch(n){s=i?i.split(","):[]}return s.map(e=>Ze(t,e))}return e},it=e=>"string"==typeof e?e.replace(" ","T"):e,ot=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class at{constructor(e,t,r={},s=1e4){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t(null===(r=this.receivedResp)||void 0===r?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var lt,ct,ht,ut,dt,pt,ft,mt;(ct=lt||(lt={})).SYNC="sync",ct.JOIN="join",ct.LEAVE="leave";class gt{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.joinRef=this.channel._joinRef(),this.state=gt.syncState(this.state,e,t,r),this.pendingDiffs.forEach(e=>{this.state=gt.syncDiff(this.state,e,t,r)}),this.pendingDiffs=[],s()}),this.channel._on(r.diff,{},e=>{const{onJoin:t,onLeave:r,onSync:s}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=gt.syncDiff(this.state,e,t,r),s())}),this.onJoin((e,t,r)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:r})}),this.onLeave((e,t,r)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:r})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const n=this.cloneDeep(e),i=this.transformState(t),o={},a={};return this.map(n,(e,t)=>{i[e]||(a[e]=t)}),this.map(i,(e,t)=>{const r=n[e];if(r){const s=t.map(e=>e.presence_ref),n=r.map(e=>e.presence_ref),i=t.filter(e=>n.indexOf(e.presence_ref)<0),l=r.filter(e=>s.indexOf(e.presence_ref)<0);i.length>0&&(o[e]=i),l.length>0&&(a[e]=l)}else o[e]=t}),this.syncDiff(n,{joins:o,leaves:a},r,s)}static syncDiff(e,t,r,s){const{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(n,(t,s)=>{var n;const i=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(s),i.length>0){const r=e[t].map(e=>e.presence_ref),s=i.filter(e=>r.indexOf(e.presence_ref)<0);e[t].unshift(...s)}r(t,i,s)}),this.map(i,(t,r)=>{let n=e[t];if(!n)return;const i=r.map(e=>e.presence_ref);n=n.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=n,s(t,n,r),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return t[r]="metas"in s?s.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(ut=ht||(ht={})).ALL="*",ut.INSERT="INSERT",ut.UPDATE="UPDATE",ut.DELETE="DELETE",(pt=dt||(dt={})).BROADCAST="broadcast",pt.PRESENCE="presence",pt.POSTGRES_CHANGES="postgres_changes",pt.SYSTEM="system",(mt=ft||(ft={})).SUBSCRIBED="SUBSCRIBED",mt.TIMED_OUT="TIMED_OUT",mt.CLOSED="CLOSED",mt.CHANNEL_ERROR="CHANNEL_ERROR";class vt{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=qe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new at(this,We.join,this.params,this.timeout),this.rejoinTimer=new Ye(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=qe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=qe.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=qe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=qe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=qe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(We.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new gt(this),this.broadcastEndpointURL=ot(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s,n;if(this.socket.isConnected()||this.socket.connect(),this.state==qe.closed){const{config:{broadcast:i,presence:o,private:a}}=this.params,l=null!==(s=null===(r=this.bindings.postgres_changes)||void 0===r?void 0:r.map(e=>e.filter))&&void 0!==s?s:[],c=!!this.bindings[dt.PRESENCE]&&this.bindings[dt.PRESENCE].length>0||!0===(null===(n=this.params.config.presence)||void 0===n?void 0:n.enabled),h={},u={broadcast:i,presence:Object.assign(Object.assign({},o),{enabled:c}),postgres_changes:l,private:a};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(ft.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(ft.CLOSED)),this.updateJoinPayload(Object.assign({config:u},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var r;if(this.socket.setAuth(),void 0!==t){const s=this.bindings.postgres_changes,n=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,i=[];for(let r=0;r<n;r++){const n=s[r],{filter:{event:o,schema:a,table:l,filter:c}}=n,h=t&&t[r];if(!h||h.event!==o||h.schema!==a||h.table!==l||h.filter!==c)return this.unsubscribe(),this.state=qe.errored,void(null==e||e(ft.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},n),{id:h.id}))}return this.bindings.postgres_changes=i,void(e&&e(ft.SUBSCRIBED))}null==e||e(ft.SUBSCRIBED)}).receive("error",t=>{this.state=qe.errored,null==e||e(ft.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(ft.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===qe.joined&&e===dt.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,s;if(this._canPush()||"broadcast"!==e.type)return new Promise(r=>{var s,n,i;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(n=null===(s=this.params)||void 0===s?void 0:s.config)||void 0===n?void 0:n.broadcast)||void 0===i?void 0:i.ack)||r("ok"),o.receive("ok",()=>r("ok")),o.receive("error",()=>r("error")),o.receive("timeout",()=>r("timed out"))});{const{event:i,payload:o}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const e=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(r=t.timeout)&&void 0!==r?r:this.timeout);return await(null===(s=e.body)||void 0===s?void 0:s.cancel()),e.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=qe.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(We.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new at(this,We.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{null==r||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=qe.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const s=new AbortController,n=setTimeout(()=>s.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(n),i}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new at(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,n;const i=e.toLocaleLowerCase(),{close:o,error:a,leave:l,join:c}=We;if(r&&[o,a,l,c].indexOf(i)>=0&&r!==this._joinRef())return;let h=this._onMessage(i,t,r);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(s=this.bindings.postgres_changes)||void 0===s||s.filter(e=>{var t,r,s;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(s=null===(r=e.filter)||void 0===r?void 0:r.event)||void 0===s?void 0:s.toLocaleLowerCase())===i}).map(e=>e.callback(h,r)):null===(n=this.bindings[i])||void 0===n||n.filter(e=>{var r,s,n,o,a,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,o=null===(r=e.filter)||void 0===r?void 0:r.event;return i&&(null===(s=t.ids)||void 0===s?void 0:s.includes(i))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const r=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===r||r===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof h&&"ids"in h){const e=h.data,{schema:t,table:r,commit_timestamp:s,type:n,errors:i}=e,o={schema:t,table:r,commit_timestamp:s,eventType:n,new:{},old:{},errors:i};h=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(h,r)})}_isClosed(){return this.state===qe.closed}_isJoined(){return this.state===qe.joined}_isJoining(){return this.state===qe.joining}_isLeaving(){return this.state===qe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),n={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(n):this.bindings[s]=[n],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(e=>{var s;return!((null===(s=e.type)||void 0===s?void 0:s.toLocaleLowerCase())===r&&vt.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(We.close,{},e)}_onError(e){this._on(We.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=qe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=Xe(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=Xe(e.columns,e.old_record)),t}}const bt=()=>{},wt=25e3,yt=10,_t=100,xt=[1e3,2e3,5e3,1e4];class kt{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Ue,this.transport=null,this.heartbeatIntervalMs=wt,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=bt,this.ref=0,this.reconnectTimer=null,this.logger=bt,this.conn=null,this.sendBuffer=[],this.serializer=new Ge,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>N(async()=>{const{default:e}=await Promise.resolve().then(()=>ne);return{default:e}},void 0).then(({default:t})=>t(...e)).catch(e=>{throw new Error(`Failed to load @supabase/node-fetch: ${e.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...e)=>t(...e)},!(null===(r=null==t?void 0:t.params)||void 0===r?void 0:r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Fe.websocket}`,this.httpEndpoint=ot(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Le.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case De.connecting:return He.Connecting;case De.open:return He.Open;case De.closing:return He.Closing;default:return He.Closed}}isConnected(){return this.connectionState()===He.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(e=>e.topic===r);if(s)return s;{const r=new vt(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:r,payload:s,ref:n}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${r} (${n})`,s),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},_t)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(a){this.log("error","error in heartbeat callback",a)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:r,payload:s,ref:n}=e,i=n?`(${n})`:"",o=s.status||"";this.log("receive",`${o} ${t} ${r} ${i}`.trim(),s),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(r,s,n)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(We.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const r=e.match(/\?/)?"&":"?";return`${e}${r}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;t=e||(this.accessToken?await this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const r={access_token:t,version:"realtime-js/2.15.5"};t&&e.updateJoinPayload(r),e.joinedOnce&&e._isJoined()&&e._push(We.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Ye(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},yt)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,n,i,o,a,l,c;if(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(r=null==e?void 0:e.timeout)&&void 0!==r?r:Ue,this.heartbeatIntervalMs=null!==(s=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==s?s:wt,this.worker=null!==(n=null==e?void 0:e.worker)&&void 0!==n&&n,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,this.heartbeatCallback=null!==(o=null==e?void 0:e.heartbeatCallback)&&void 0!==o?o:bt,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(a=null==e?void 0:e.reconnectAfterMs)&&void 0!==a?a:e=>xt[e-1]||1e4,this.encode=null!==(l=null==e?void 0:e.encode)&&void 0!==l?l:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(c=null==e?void 0:e.decode)&&void 0!==c?c:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}class St extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function jt(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Tt extends St{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Et extends St{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Pt=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const Ot=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>N(async()=>{const{default:e}=await Promise.resolve().then(()=>ne);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Ct=e=>{if(Array.isArray(e))return e.map(e=>Ct(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,r])=>{const s=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[s]=Ct(r)}),t};var At=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const Nt=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),It=(e,t,r)=>At(void 0,void 0,void 0,function*(){const s=yield Pt(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield N(()=>Promise.resolve().then(()=>ne),void 0)).Response:Response});e instanceof s&&!(null==r?void 0:r.noResolveJson)?e.json().then(r=>{const s=e.status||500,n=(null==r?void 0:r.statusCode)||s+"";t(new Tt(Nt(r),s,n))}).catch(e=>{t(new Et(Nt(e),e))}):t(new Et(Nt(e),e))}),Rt=(e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&s?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(s)?(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),n.body=JSON.stringify(s)):n.body=s,(null==t?void 0:t.duplex)&&(n.duplex=t.duplex),Object.assign(Object.assign({},n),r)):n};function $t(e,t,r,s,n,i){return At(this,void 0,void 0,function*(){return new Promise((o,a)=>{e(r,Rt(t,s,n,i)).then(e=>{if(!e.ok)throw e;return(null==s?void 0:s.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(e=>It(e,a,s))})})}function Lt(e,t,r,s){return At(this,void 0,void 0,function*(){return $t(e,"GET",t,r,s)})}function Ut(e,t,r,s,n){return At(this,void 0,void 0,function*(){return $t(e,"POST",t,s,n,r)})}function Dt(e,t,r,s,n){return At(this,void 0,void 0,function*(){return $t(e,"PUT",t,s,n,r)})}function Bt(e,t,r,s,n){return At(this,void 0,void 0,function*(){return $t(e,"DELETE",t,s,n,r)})}var qt=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const Mt={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Wt={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class zt{constructor(e,t={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=Ot(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,s){return qt(this,void 0,void 0,function*(){try{let n;const i=Object.assign(Object.assign({},Wt),s);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const a=i.metadata;"undefined"!=typeof Blob&&r instanceof Blob?(n=new FormData,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a)),n.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(n=r,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a))):(n=r,o["cache-control"]=`max-age=${i.cacheControl}`,o["content-type"]=i.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==s?void 0:s.headers)&&(o=Object.assign(Object.assign({},o),s.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),h=yield("PUT"==e?Dt:Ut)(this.fetch,`${this.url}/object/${c}`,n,Object.assign({headers:o},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{}));return{data:{path:l,id:h.Id,fullPath:h.Key},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(jt(n))return{data:null,error:n};throw n}})}upload(e,t,r){return qt(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return qt(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),i=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${i}`);o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:Wt.upsert},s),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"undefined"!=typeof Blob&&r instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",r)):"undefined"!=typeof FormData&&r instanceof FormData?(e=r,e.append("cacheControl",t.cacheControl)):(e=r,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType);return{data:{path:n,fullPath:(yield Dt(this.fetch,o.toString(),e,{headers:i})).Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(jt(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return qt(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(s["x-upsert"]="true");const n=yield Ut(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),i=new URL(this.url+n.url),o=i.searchParams.get("token");if(!o)throw new St("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:o},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(jt(r))return{data:null,error:r};throw r}})}update(e,t,r){return qt(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return qt(this,void 0,void 0,function*(){try{return{data:yield Ut(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(jt(s))return{data:null,error:s};throw s}})}copy(e,t,r){return qt(this,void 0,void 0,function*(){try{return{data:{path:(yield Ut(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==r?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(jt(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return qt(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),n=yield Ut(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},(null==r?void 0:r.transform)?{transform:r.transform}:{}),{headers:this.headers});const i=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${i}`)},{data:n,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(jt(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return qt(this,void 0,void 0,function*(){try{const s=yield Ut(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==r?void 0:r.download)?`&download=${!0===r.download?"":r.download}`:"";return{data:s.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(jt(s))return{data:null,error:s};throw s}})}download(e,t){return qt(this,void 0,void 0,function*(){const r=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",s=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=s?`?${s}`:"";try{const t=this._getFinalPath(e),s=yield Lt(this.fetch,`${this.url}/${r}/${t}${n}`,{headers:this.headers,noResolveJson:!0});return{data:yield s.blob(),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(jt(i))return{data:null,error:i};throw i}})}info(e){return qt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield Lt(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Ct(e),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(jt(r))return{data:null,error:r};throw r}})}exists(e){return qt(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,r,s){return At(this,void 0,void 0,function*(){return $t(e,"HEAD",t,Object.assign(Object.assign({},r),{noResolveJson:!0}),s)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(jt(r)&&r instanceof Et){const e=r.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&s.push(n);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&s.push(o);let a=s.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${a}`)}}}remove(e){return qt(this,void 0,void 0,function*(){try{return{data:yield Bt(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(jt(t))return{data:null,error:t};throw t}})}list(e,t,r){return qt(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Mt),t),{prefix:e||""});return{data:yield Ut(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(jt(s))return{data:null,error:s};throw s}})}listV2(e,t){return qt(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Ut(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(jt(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ft={"X-Client-Info":"storage-js/2.12.1"};var Ht=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};class Vt{constructor(e,t={},r,s){this.shouldThrowOnError=!1;const n=new URL(e);if(null==s?void 0:s.useNewHostname){/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase."))}this.url=n.href,this.headers=Object.assign(Object.assign({},Ft),t),this.fetch=Ot(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Ht(this,void 0,void 0,function*(){try{return{data:yield Lt(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(jt(e))return{data:null,error:e};throw e}})}getBucket(e){return Ht(this,void 0,void 0,function*(){try{return{data:yield Lt(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(jt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Ht(this,void 0,void 0,function*(){try{return{data:yield Ut(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(jt(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return Ht(this,void 0,void 0,function*(){try{return{data:yield Dt(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(jt(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Ht(this,void 0,void 0,function*(){try{return{data:yield Ut(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(jt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Ht(this,void 0,void 0,function*(){try{return{data:yield Bt(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(jt(t))return{data:null,error:t};throw t}})}}class Kt extends Vt{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new zt(this.url,this.headers,e,this.fetch)}}let Jt="";Jt="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const Gt={headers:{"X-Client-Info":`supabase-js-${Jt}/2.57.4`}},Yt={schema:"public"},Xt={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Qt={};var Zt=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const er=(e,t,r)=>{const s=(e=>{let t;return t=e||("undefined"==typeof fetch?ee:fetch),(...e)=>t(...e)})(r),n="undefined"==typeof Headers?te:Headers;return(r,i)=>Zt(void 0,void 0,void 0,function*(){var o;const a=null!==(o=yield t())&&void 0!==o?o:e;let l=new n(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),s(r,Object.assign(Object.assign({},i),{headers:l}))})};var tr=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};const rr="2.71.1",sr=3e4,nr=9e4,ir={"X-Client-Info":`gotrue-js/${rr}`},or="X-Supabase-Api-Version",ar={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},lr=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class cr extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function hr(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class ur extends cr{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}class dr extends cr{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class pr extends cr{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class fr extends pr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class mr extends pr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class gr extends pr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class vr extends pr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class br extends pr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class wr extends pr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function yr(e){return hr(e)&&"AuthRetryableFetchError"===e.name}class _r extends pr{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class xr extends pr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const kr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Sr=" \t\n\r=".split(""),jr=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Sr.length;t+=1)e[Sr[t].charCodeAt(0)]=-2;for(let t=0;t<kr.length;t+=1)e[kr[t].charCodeAt(0)]=t;return e})();function Tr(e,t,r){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(kr[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;r(kr[e]),t.queuedBits-=6}}function Er(e,t,r){const s=jr[e];if(!(s>-1)){if(-2===s)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|s,t.queuedBits+=6;t.queuedBits>=8;)r(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Pr(e){const t=[],r=e=>{t.push(String.fromCodePoint(e))},s={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=e=>{!function(e,t,r){if(0===t.utf8seq){if(e<=127)return void r(e);for(let r=1;r<6;r+=1)if(!(e>>7-r&1)){t.utf8seq=r;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&r(t.codepoint)}}(e,s,r)};for(let o=0;o<e.length;o+=1)Er(e.charCodeAt(o),n,i);return t.join("")}function Or(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Cr(e){const t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};for(let n=0;n<e.length;n+=1)Er(e.charCodeAt(n),r,s);return new Uint8Array(t)}function Ar(e){const t=[];return function(e,t){for(let r=0;r<e.length;r+=1){let s=e.charCodeAt(r);if(s>55295&&s<=56319){const t=1024*(s-55296)&65535;s=65536+(e.charCodeAt(r+1)-56320&65535|t),r+=1}Or(s,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function Nr(e){const t=[],r={queue:0,queuedBits:0},s=e=>{t.push(e)};return e.forEach(e=>Tr(e,r,s)),Tr(null,r,s),t.join("")}const Ir=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Rr={tested:!1,writable:!1},$r=()=>{if(!Ir())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(Rr.tested)return Rr.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Rr.tested=!0,Rr.writable=!0}catch(t){Rr.tested=!0,Rr.writable=!1}return Rr.writable};const Lr=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>N(async()=>{const{default:e}=await Promise.resolve().then(()=>ne);return{default:e}},void 0).then(({default:t})=>t(...e)):fetch),(...e)=>t(...e)},Ur=async(e,t,r)=>{await e.setItem(t,JSON.stringify(r))},Dr=async(e,t)=>{const r=await e.getItem(t);if(!r)return null;try{return JSON.parse(r)}catch(s){return r}},Br=async(e,t)=>{await e.removeItem(t)};class qr{constructor(){this.promise=new qr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function Mr(e){const t=e.split(".");if(3!==t.length)throw new xr("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!lr.test(t[r]))throw new xr("JWT not in base64url format");return{header:JSON.parse(Pr(t[0])),payload:JSON.parse(Pr(t[1])),signature:Cr(t[2]),raw:{header:t[0],payload:t[1]}}}function Wr(e){return("0"+e.toString(16)).substr(-2)}async function zr(e){if(!("undefined"!=typeof crypto&&void 0!==crypto.subtle&&"undefined"!=typeof TextEncoder))return e;const t=await async function(e){const t=(new TextEncoder).encode(e),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(e=>String.fromCharCode(e)).join("")}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Fr(e,t,r=!1){const s=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let r="";for(let s=0;s<56;s++)r+=e.charAt(Math.floor(Math.random()*t));return r}return crypto.getRandomValues(e),Array.from(e,Wr).join("")}();let n=s;r&&(n+="/PASSWORD_RECOVERY"),await Ur(e,`${t}-code-verifier`,n);const i=await zr(s);return[i,s===i?"plain":"s256"]}qr.promiseConstructor=Promise;const Hr=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;const Vr=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Kr(e){if(!Vr.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Jr(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Gr(e){return JSON.parse(JSON.stringify(e))}const Yr=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Xr=[502,503,504];async function Qr(e){var t,r;if(!("object"==typeof(r=e)&&null!==r&&"status"in r&&"ok"in r&&"json"in r&&"function"==typeof r.json))throw new wr(Yr(e),0);if(Xr.includes(e.status))throw new wr(Yr(e),e.status);let s,n;try{s=await e.json()}catch(o){throw new dr(Yr(o),o)}const i=function(e){const t=e.headers.get(or);if(!t)return null;if(!t.match(Hr))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(o){return null}}(e);if(i&&i.getTime()>=ar.timestamp&&"object"==typeof s&&s&&"string"==typeof s.code?n=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(n=s.error_code),n){if("weak_password"===n)throw new _r(Yr(s),e.status,(null===(t=s.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===n)throw new fr}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new _r(Yr(s),e.status,s.weak_password.reasons);throw new ur(Yr(s),e.status||500,n)}async function Zr(e,t,r,s){var n;const i=Object.assign({},null==s?void 0:s.headers);i[or]||(i[or]=ar.name),(null==s?void 0:s.jwt)&&(i.Authorization=`Bearer ${s.jwt}`);const o=null!==(n=null==s?void 0:s.query)&&void 0!==n?n:{};(null==s?void 0:s.redirectTo)&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await async function(e,t,r,s,n,i){const o=((e,t,r,s)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(s),Object.assign(Object.assign({},n),r))})(t,s,n,i);let a;try{a=await e(r,Object.assign({},o))}catch(l){throw new wr(Yr(l),0)}a.ok||await Qr(a);if(null==s?void 0:s.noResolveJson)return a;try{return await a.json()}catch(l){await Qr(l)}}(e,t,r+a,{headers:i,noResolveJson:null==s?void 0:s.noResolveJson},{},null==s?void 0:s.body);return(null==s?void 0:s.xform)?null==s?void 0:s.xform(l):{data:Object.assign({},l),error:null}}function es(e){var t;let r=null;var s;(function(e){return e.access_token&&e.refresh_token&&e.expires_in})(e)&&(r=Object.assign({},e),e.expires_at||(r.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s)));return{data:{session:r,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function ts(e){const t=es(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function rs(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function ss(e){return{data:e,error:null}}function ns(e){const{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i}=e,o=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:r,hashed_token:s,redirect_to:n,verification_type:i},user:Object.assign({},o)},error:null}}function is(e){return e}const os=["global","local","others"];class as{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Lr(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=os[0]){if(os.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${os.join(", ")}`);try{return await Zr(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(hr(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await Zr(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:rs})}catch(r){if(hr(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=function(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=null==r?void 0:r.newEmail,delete s.newEmail),await Zr(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:ns,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(hr(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Zr(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:rs})}catch(t){if(hr(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,n,i,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=await Zr(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(r=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==r?r:"",per_page:null!==(n=null===(s=null==e?void 0:e.perPage)||void 0===s?void 0:s.toString())&&void 0!==n?n:""},xform:is});if(c.error)throw c.error;const h=await c.json(),u=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,d=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return d.length>0&&(d.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),r=JSON.parse(e.split(";")[1].split("=")[1]);l[`${r}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(l){if(hr(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){Kr(e);try{return await Zr(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:rs})}catch(t){if(hr(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Kr(e);try{return await Zr(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:rs})}catch(r){if(hr(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){Kr(e);try{return await Zr(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:rs})}catch(r){if(hr(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Kr(e.userId);try{const{data:t,error:r}=await Zr(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:r}}catch(t){if(hr(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Kr(e.userId),Kr(e.id);try{return{data:await Zr(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(hr(t))return{data:null,error:t};throw t}}}function ls(e={}){return{getItem:t=>e[t]||null,setItem:(t,r)=>{e[t]=r},removeItem:t=>{delete e[t]}}}const cs=!!(globalThis&&$r()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class hs extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class us extends hs{}async function ds(e,t,r){const s=new globalThis.AbortController;return t>0&&setTimeout(()=>{s.abort()},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async s=>{if(!s){if(0===t)throw new us(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(cs)try{await globalThis.navigator.locks.query()}catch(n){}return await r()}try{return await r()}finally{}}))}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const ps={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ir,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function fs(e,t,r){return await r()}const ms={};class gs{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=gs.nextInstanceID,gs.nextInstanceID+=1,this.instanceID>0&&Ir();const s=Object.assign(Object.assign({},ps),e);if(this.logDebugMessages=!!s.debug,"function"==typeof s.debug&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new as({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Lr(s.fetch),this.lock=s.lock||fs,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:Ir()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=ds:this.lock=fs,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:$r()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ls(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=ls(this.memoryStorage)),Ir()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){}null===(r=this.broadcastChannel)||void 0===r||r.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}get jwks(){var e,t;return null!==(t=null===(e=ms[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){ms[this.storageKey]=Object.assign(Object.assign({},ms[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=ms[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ms[this.storageKey]=Object.assign(Object.assign({},ms[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${rr}) ${(new Date).toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{const t=function(e){const t={},r=new URL(e);if(r.hash&&"#"===r.hash[0])try{new URLSearchParams(r.hash.substring(1)).forEach((e,r)=>{t[r]=e})}catch(s){}return r.searchParams.forEach((e,r)=>{t[r]=e}),t}(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),Ir()&&this.detectSessionInUrl&&"none"!==r){const{data:s,error:n}=await this._getSessionFromURL(t,r);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),function(e){return hr(e)&&"AuthImplicitGrantRedirectError"===e.name}(n)){const t=null===(e=n.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:n}}return await this._removeSession(),{error:n}}const{session:i,redirectType:o}=s;return this._debug("#_initialize()","detected session in URL",i,"redirect type",o),await this._saveSession(i),setTimeout(async()=>{"recovery"===o?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return hr(t)?{error:t}:{error:new dr("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const n=await Zr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(r=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==r?r:{},gotrue_meta_security:{captcha_token:null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken}},xform:es}),{data:i,error:o}=n;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(hr(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,r,s;try{let n;if("email"in e){const{email:r,password:s,options:i}=e;let o=null,a=null;"pkce"===this.flowType&&([o,a]=await Fr(this.storage,this.storageKey)),n=await Zr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:r,password:s,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},xform:es})}else{if(!("phone"in e))throw new gr("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:o}=e;n=await Zr(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(r=null==o?void 0:o.data)&&void 0!==r?r:{},channel:null!==(s=null==o?void 0:o.channel)&&void 0!==s?s:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:es})}}const{data:i,error:o}=n;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(hr(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:s,options:n}=e;t=await Zr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ts})}else{if(!("phone"in e))throw new gr("You must provide either an email or phone number and a password");{const{phone:r,password:s,options:n}=e;t=await Zr(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ts})}}const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:r&&r.session&&r.user?(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s}):{data:{user:null,session:null},error:new mr}}catch(t){if(hr(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,n;return await this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(s=e.options)||void 0===s?void 0:s.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if("solana"===t)return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,s,n,i,o,a,l,c,h,u,d;let p,f;if("message"in e)p=e.message,f=e.signature;else{const{chain:u,wallet:d,statement:m,options:g}=e;let v;if(Ir())if("object"==typeof d)v=d;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");v=e.solana}else{if("object"!=typeof d||!(null==g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=d}const b=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href);if("signIn"in v&&v.signIn){const e=await v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==g?void 0:g.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),m?{statement:m}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");p="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),f=t.signature}else{if(!("signMessage"in v&&"function"==typeof v.signMessage&&"publicKey"in v&&"object"==typeof v&&v.publicKey&&"toBase58"in v.publicKey&&"function"==typeof v.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${b.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...m?["",m,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${null!==(s=null===(r=null==g?void 0:g.signInWithSolana)||void 0===r?void 0:r.issuedAt)&&void 0!==s?s:(new Date).toISOString()}`,...(null===(n=null==g?void 0:g.signInWithSolana)||void 0===n?void 0:n.notBefore)?[`Not Before: ${g.signInWithSolana.notBefore}`]:[],...(null===(i=null==g?void 0:g.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${g.signInWithSolana.expirationTime}`]:[],...(null===(o=null==g?void 0:g.signInWithSolana)||void 0===o?void 0:o.chainId)?[`Chain ID: ${g.signInWithSolana.chainId}`]:[],...(null===(a=null==g?void 0:g.signInWithSolana)||void 0===a?void 0:a.nonce)?[`Nonce: ${g.signInWithSolana.nonce}`]:[],...(null===(l=null==g?void 0:g.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${g.signInWithSolana.requestId}`]:[],...(null===(h=null===(c=null==g?void 0:g.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===h?void 0:h.length)?["Resources",...g.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=await v.signMessage((new TextEncoder).encode(p),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");f=e}}try{const{data:t,error:r}=await Zr(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:Nr(f)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(d=e.options)||void 0===d?void 0:d.captchaToken}}:null),xform:es});if(r)throw r;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:r}):{data:{user:null,session:null},error:new mr}}catch(m){if(hr(m))return{data:{user:null,session:null},error:m};throw m}}async _exchangeCodeForSession(e){const t=await Dr(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(null!=t?t:"").split("/");try{const{data:t,error:n}=await Zr(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:es});if(await Br(this.storage,`${this.storageKey}-code-verifier`),n)throw n;return t&&t.session&&t.user?(t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=s?s:null}),error:n}):{data:{user:null,session:null,redirectType:null},error:new mr}}catch(n){if(hr(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:n,nonce:i}=e,o=await Zr(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:n,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:es}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new mr}}catch(t){if(hr(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,n,i;try{if("email"in e){const{email:s,options:n}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=await Fr(this.storage,this.storageKey));const{error:a}=await Zr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:s,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(r=null==n?void 0:n.shouldCreateUser)||void 0===r||r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:o},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:t,options:r}=e,{data:o,error:a}=await Zr(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(s=null==r?void 0:r.data)&&void 0!==s?s:{},create_user:null===(n=null==r?void 0:r.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==r?void 0:r.captchaToken},channel:null!==(i=null==r?void 0:r.channel)&&void 0!==i?i:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new gr("You must provide either an email or phone number.")}catch(o){if(hr(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,r;try{let s,n;"options"in e&&(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo,n=null===(r=e.options)||void 0===r?void 0:r.captchaToken);const{data:i,error:o}=await Zr(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:s,xform:es});if(o)throw o;if(!i)throw new Error("An error occurred on token verification.");const a=i.session,l=i.user;return(null==a?void 0:a.access_token)&&(await this._saveSession(a),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(s){if(hr(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let n=null,i=null;return"pkce"===this.flowType&&([n,i]=await Fr(this.storage,this.storageKey)),await Zr(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==r?r:void 0}),(null===(s=null==e?void 0:e.options)||void 0===s?void 0:s.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:i}),headers:this.headers,xform:ss})}catch(n){if(hr(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new fr;const{error:s}=await Zr(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(hr(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:n}=e,{error:i}=await Zr(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){const{phone:r,type:s,options:n}=e,{data:i,error:o}=await Zr(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new gr("You must provide either an email or phone number and a type")}catch(t){if(hr(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){await this.initializePromise;return await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),r=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await r}catch(e){}})()),r}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(t){}})()),await e;this.pendingInLock.length;){const e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=await Dr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=!!e.expires_at&&1e3*e.expires_at-Date.now()<nr;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const t=await Dr(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=Jr()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,r,s)=>(t||"user"!==r||(t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,r,s))})}return{data:{session:e},error:null}}const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;return await this._acquireLock(-1,async()=>await this._getUser())}async _getUser(e){try{return e?await Zr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:rs}):await this._useSession(async e=>{var t,r,s;const{data:n,error:i}=e;if(i)throw i;return(null===(t=n.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await Zr(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0,xform:rs}):{data:{user:null},error:new fr}})}catch(t){if(hr(t))return function(e){return hr(e)&&"AuthSessionMissingError"===e.name}(t)&&(await this._removeSession(),await Br(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:n}=r;if(n)throw n;if(!s.session)throw new fr;const i=s.session;let o=null,a=null;"pkce"===this.flowType&&null!=e.email&&([o,a]=await Fr(this.storage,this.storageKey));const{data:l,error:c}=await Zr(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:a}),jwt:i.access_token,xform:rs});if(c)throw c;return i.user=l.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(r){if(hr(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new fr;const t=Date.now()/1e3;let r=t,s=!0,n=null;const{payload:i}=Mr(e.access_token);if(i.exp&&(r=i.exp,s=r<=t),s){const{session:t,error:r}=await this._callRefreshToken(e.refresh_token);if(r)return{data:{user:null,session:null},error:r};if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:s,error:i}=await this._getUser(e.access_token);if(i)throw i;n={access_token:e.access_token,refresh_token:e.refresh_token,user:s.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(hr(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:s,error:n}=t;if(n)throw n;e=null!==(r=s.session)&&void 0!==r?r:void 0}if(!(null==e?void 0:e.refresh_token))throw new fr;const{session:s,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(hr(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Ir())throw new vr("No browser detected.");if(e.error||e.error_description||e.error_code)throw new vr(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new br("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new vr("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new br("No code detected.");const{data:t,error:r}=await this._exchangeCodeForSession(e.code);if(r)throw r;const s=new URL(window.location.href);return s.searchParams.delete("code"),window.history.replaceState(window.history.state,"",s.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:n,refresh_token:i,expires_in:o,expires_at:a,token_type:l}=e;if(!(n&&o&&i&&l))throw new vr("No session defined in URL");const c=Math.round(Date.now()/1e3),h=parseInt(o);let u=c+h;a&&(u=parseInt(a));const{data:d,error:p}=await this._getUser(n);if(p)throw p;const f={provider_token:r,provider_refresh_token:s,access_token:n,expires_in:h,expires_at:u,refresh_token:i,token_type:l,user:d.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:f,redirectType:e.type},error:null}}catch(r){if(hr(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Dr(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{error:n};const i=null===(r=s.session)||void 0===r?void 0:r.access_token;if(i){const{error:t}=await this.admin.signOut(i,e);if(t&&(!function(e){return hr(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(await this._removeSession(),await Br(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:s},error:n}=t;if(n)throw n;await(null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(n){await(null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;"pkce"===this.flowType&&([r,s]=await Fr(this.storage,this.storageKey,!0));try{return await Zr(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(hr(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(hr(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async t=>{var r,s,n,i,o;const{data:a,error:l}=t;if(l)throw l;const c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(r=e.options)||void 0===r?void 0:r.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return await Zr(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(o=null===(i=a.session)||void 0===i?void 0:i.access_token)&&void 0!==o?o:void 0})});if(s)throw s;return Ir()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==r?void 0:r.url),{data:{provider:e.provider,url:null==r?void 0:r.url},error:null}}catch(r){if(hr(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:i}=t;if(i)throw i;return await Zr(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(s=null===(r=n.session)||void 0===r?void 0:r.access_token)&&void 0!==s?s:void 0})})}catch(t){if(hr(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await(r=async r=>(r>0&&await async function(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}(200*Math.pow(2,r-1)),this._debug(t,"refreshing attempt",r),await Zr(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:es})),s=(e,t)=>{const r=200*Math.pow(2,e);return t&&yr(t)&&Date.now()+r-n<sr},new Promise((e,t)=>{(async()=>{for(let i=0;i<1/0;i++)try{const t=await r(i);if(!s(i,null,t))return void e(t)}catch(n){if(!s(i,n))return void t(n)}})()}))}catch(n){if(this._debug(t,"error",n),hr(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}var r,s}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),Ir()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await Dr(this.storage,this.storageKey);if(n&&this.userStorage){let t=await Dr(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:n.user},await Ur(this.userStorage,this.storageKey+"-user",t)),n.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:Jr()}else if(n&&!n.user&&!n.user){const e=await Dr(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(n.user=e.user,await Br(this.storage,this.storageKey+"-user"),await Ur(this.storage,this.storageKey,n)):n.user=Jr()}if(this._debug(r,"session from storage",n),!this._isValidSession(n))return this._debug(r,"session is not valid"),void(null!==n&&await this._removeSession());const i=1e3*(null!==(t=n.expires_at)&&void 0!==t?t:1/0)-Date.now()<nr;if(this._debug(r,`session has${i?"":" not"} expired with margin of 90000s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:e}=await this._callRefreshToken(n.refresh_token);e&&(yr(e)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else if(n.user&&!0===n.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=await this._getUser(n.access_token);!t&&(null==e?void 0:e.user)?(n.user=e.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(s){this._debug(r,"error getting user data, skipping SIGNED_IN notification",s)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){return void this._debug(r,"error",n)}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new fr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new qr;const{data:t,error:r}=await this._refreshAccessToken(e);if(r)throw r;if(!t.session)throw new fr;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const s={session:t.session,error:null};return this.refreshingDeferred.resolve(s),s}catch(n){if(this._debug(s,"error",n),hr(n)){const e={session:null,error:n};return yr(n)||await this._removeSession(),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(r=this.refreshingDeferred)||void 0===r||r.reject(n),n}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],n=Array.from(this.stateChangeEmitters.values()).map(async r=>{try{await r.callback(e,t)}catch(n){s.push(n)}});if(await Promise.all(n),s.length>0){for(let e=0;e<s.length;e+=1);throw s[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!r&&t.user&&await Ur(this.userStorage,this.storageKey+"-user",{user:t.user});const e=Object.assign({},t);delete e.user;const s=Gr(e);await Ur(this.storage,this.storageKey,s)}else{const e=Gr(t);await Ur(this.storage,this.storageKey,e)}}async _removeSession(){this._debug("#_removeSession()"),await Br(this.storage,this.storageKey),await Br(this.storage,this.storageKey+"-code-verifier"),await Br(this.storage,this.storageKey+"-user"),this.userStorage&&await Br(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ir()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),sr);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async e=>{const{data:{session:r}}=e;if(!r||!r.refresh_token||!r.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const s=Math.floor((1e3*r.expires_at-t)/sr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),s<=3&&await this._callRefreshToken(r.refresh_token)})}catch(e){}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(!(e.isAcquireTimeout||e instanceof hs))throw e;this._debug("auto refresh token tick lock not available")}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ir()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"===document.visibilityState?await this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if((null==r?void 0:r.redirectTo)&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),(null==r?void 0:r.scopes)&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),"pkce"===this.flowType){const[e,t]=await Fr(this.storage,this.storageKey),r=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});s.push(r.toString())}if(null==r?void 0:r.queryParams){const e=new URLSearchParams(r.queryParams);s.push(e.toString())}return(null==r?void 0:r.skipBrowserRedirect)&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await Zr(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(t){if(hr(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:n,error:i}=t;if(i)return{data:null,error:i};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:l}=await Zr(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(r=null==n?void 0:n.session)||void 0===r?void 0:r.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(s=null==a?void 0:a.totp)||void 0===s?void 0:s.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})})}catch(t){if(hr(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;if(n)return{data:null,error:n};const{data:i,error:o}=await Zr(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})})}catch(t){if(hr(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:n}=t;return n?{data:null,error:n}:await Zr(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(r=null==s?void 0:s.session)||void 0===r?void 0:r.access_token})})}catch(t){if(hr(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(null==e?void 0:e.factors)||[],s=r.filter(e=>"totp"===e.factor_type&&"verified"===e.status),n=r.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:r,totp:s,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:n}=e;if(n)return{data:null,error:n};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Mr(s.access_token);let o=null;i.aal&&(o=i.aal);let a=o;(null!==(r=null===(t=s.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==r?r:[]).length>0&&(a="aal2");return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:i.amr||[]},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(t=>t.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(t=>t.kid===e),r&&this.jwks_cached_at+6e5>s)return r;const{data:n,error:i}=await Zr(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return n.keys&&0!==n.keys.length?(this.jwks=n,this.jwks_cached_at=s,r=n.keys.find(t=>t.kid===e),r||null):null}async getClaims(e,t={}){try{let r=e;if(!r){const{data:e,error:t}=await this.getSession();if(t||!e.session)return{data:null,error:t};r=e.session.access_token}const{header:s,payload:n,signature:i,raw:{header:o,payload:a}}=Mr(r);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(n.exp);const l=s.alg&&!s.alg.startsWith("HS")&&s.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?await this.fetchJwk(s.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=await this.getUser(r);if(e)throw e;return{data:{claims:n,header:s,signature:i},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(s.alg),h=await crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!(await crypto.subtle.verify(c,h,i,Ar(`${o}.${a}`))))throw new xr("Invalid JWT signature");return{data:{claims:n,header:s,signature:i},error:null}}catch(r){if(hr(r))return{data:null,error:r};throw r}}}gs.nextInstanceID=0;const vs=gs;class bs extends vs{constructor(e){super(e)}}var ws=function(e,t,r,s){return new(r||(r=Promise))(function(n,i){function o(e){try{l(s.next(e))}catch(t){i(t)}}function a(e){try{l(s.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((s=s.apply(e,t||[])).next())})};class ys{constructor(e,t,r){var s,n,i;this.supabaseUrl=e,this.supabaseKey=t;const o=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((r=t).endsWith("/")?r:r+"/")}catch(s){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var r}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const a=`sb-${o.hostname.split(".")[0]}-auth-token`,l=function(e,t){var r,s;const{db:n,auth:i,realtime:o,global:a}=e,{db:l,auth:c,realtime:h,global:u}=t,d={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},h),o),storage:{},global:Object.assign(Object.assign(Object.assign({},u),a),{headers:Object.assign(Object.assign({},null!==(r=null==u?void 0:u.headers)&&void 0!==r?r:{}),null!==(s=null==a?void 0:a.headers)&&void 0!==s?s:{})}),accessToken:()=>tr(this,void 0,void 0,function*(){return""})};return e.accessToken?d.accessToken=e.accessToken:delete d.accessToken,d}(null!=r?r:{},{db:Yt,realtime:Qt,auth:Object.assign(Object.assign({},Xt),{storageKey:a}),global:Gt});this.storageKey=null!==(s=l.auth.storageKey)&&void 0!==s?s:"",this.headers=null!==(n=l.global.headers)&&void 0!==n?n:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(i=l.auth)&&void 0!==i?i:{},this.headers,l.global.fetch),this.fetch=er(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.rest=new Ce(new URL("rest/v1",o).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new Kt(this.storageUrl.href,this.headers,this.fetch,null==r?void 0:r.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new H(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ws(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return null!==(t=null===(e=r.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:n,storageKey:i,flowType:o,lock:a,debug:l},c,h){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new bs({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),c),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:n,flowType:o,lock:a,debug:l,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new kt(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,r){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===r?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=r}}!function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const e=process.version;if(null==e)return!1;const t=e.match(/^v(\d+)\./);!!t&&parseInt(t[1],10)}();const _s=new ys("https://ciawsbarwhhebghhyjub.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNpYXdzYmFyd2hoZWJnaGh5anViIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE5NTI1MTYsImV4cCI6MjA3NzUyODUxNn0.XQIlffM2nzb_qQpe9BD7P55NccPEHr9XwOE4od6U3B8",{auth:{persistSession:!0}});const xs=e=>new Promise((t,r)=>{const s=new FileReader;s.onload=()=>t(s.result),s.onerror=r,s.readAsDataURL(e)}),ks=async(e,t,r=!1)=>{var s,n,i,o,a,l,c;if(r)return await xs(e);try{const{data:{session:r},error:h}=await _s.auth.getSession(),u=e.name.split(".").pop()||"jpg",d=`${t}/${Date.now()}-${Math.random().toString(36).slice(2)}.${u}`,{data:p,error:f}=await _s.storage.listBuckets();if(f)throw new Error(`Storage access error: ${f.message}`);if(!(null==p?void 0:p.find(e=>"media"===e.name)))throw new Error('Storage bucket "media" does not exist. Please create it in Supabase Storage settings.');let m=null,g=null;const{data:v,error:b}=await _s.storage.from("media").upload(d,e,{upsert:!0,cacheControl:"3600",contentType:e.type||"image/jpeg"});if(g=v,m=b,b&&((null==(s=b.message)?void 0:s.includes("RLS"))||(null==(n=b.message)?void 0:n.includes("row-level security")))){const{data:t,error:r}=await _s.storage.from("media").upload(d,e,{cacheControl:"3600",contentType:e.type||"image/jpeg"});r||(g=t,m=null)}if(m){if((null==(i=m.message)?void 0:i.includes("new row violates row-level security"))||(null==(o=m.message)?void 0:o.includes("RLS"))){const e=new Error("Permission denied: Storage bucket RLS policy is blocking uploads.\n\nPlease check:\n1. Go to Supabase Dashboard  Storage  media bucket  Policies\n2. Create a policy with INSERT operation\n3. Policy definition: (bucket_id = 'media'::text)\n4. Or use: true (for public uploads)\n\nWould you like to use base64 storage as a fallback?");throw e.suggestFallback=!0,e}if(null==(a=m.message)?void 0:a.includes("Bucket not found"))throw new Error('Storage bucket "media" not found. Please create it in Supabase Storage settings.');if((null==(l=m.message)?void 0:l.includes("JWT"))||(null==(c=m.message)?void 0:c.includes("Invalid API key"))||401===m.statusCode)throw new Error("Authentication required: Please log out and log back in to refresh your session.");if(403===m.statusCode){const e=new Error("Access forbidden: Check your storage bucket policies. The bucket may require authentication or have restricted policies.");throw e.suggestFallback=!0,e}throw new Error(`Upload failed: ${m.message||"Unknown error"} (Code: ${m.statusCode||"N/A"})`)}if(!g)throw new Error("Upload failed: No data returned from storage");const{data:w}=_s.storage.from("media").getPublicUrl(g.path);if(!(null==w?void 0:w.publicUrl))throw new Error("Failed to get public URL for uploaded file");return w.publicUrl}catch(h){try{return await xs(e)}catch(u){throw new Error(`Upload failed: ${h.message}. Base64 fallback also failed: ${u}`)}}},Ss=()=>{const[t,r]=e.useState({from_name:"",from_email:"",message_type:"general",subject:"",message:"",is_anonymous:!1}),[s,n]=e.useState(!1),[u,d]=e.useState(!1),p=[{value:"prayer_request",label:"Prayer Request",icon:a,color:"pink"},{value:"testimony",label:"Testimony",icon:l,color:"green"},{value:"song_request",label:"Song Request",icon:c,color:"purple"},{value:"booking_inquiry",label:"Booking Inquiry",icon:h,color:"blue"},{value:"general",label:"General Message",icon:l,color:"gray"}];return u?O.jsx("div",{className:"max-w-2xl mx-auto p-4 md:p-6 text-center",children:O.jsxs("div",{className:"bg-purple-500/20 border border-purple-500/30 rounded-xl md:rounded-2xl p-6 md:p-8 backdrop-blur-xl",children:[O.jsx(i,{size:48,className:"mx-auto mb-3 md:mb-4 text-purple-400 md:w-16 md:h-16"}),O.jsx("h2",{className:"text-xl md:text-2xl font-bold text-white mb-2",children:"Message Sent!"}),O.jsx("p",{className:"text-sm md:text-base text-purple-200",children:"Thank you for reaching out. We'll get back to you soon!"})]})}):O.jsx("div",{className:"max-w-2xl mx-auto p-3 md:p-6",children:O.jsxs("div",{className:"bg-black/80 backdrop-blur-xl rounded-xl md:rounded-2xl shadow-xl p-4 md:p-6 border border-purple-500/30",children:[O.jsxs("div",{className:"text-center mb-6 md:mb-8",children:[O.jsx("h2",{className:"text-xl md:text-2xl lg:text-3xl font-black bg-gradient-to-r from-purple-400 to-purple-600 bg-clip-text text-transparent mb-2",children:"Send a Message"}),O.jsx("p",{className:"text-xs md:text-sm text-purple-200",children:"Share your prayer request, testimony, or get in touch with Esther Reign"})]}),O.jsxs("form",{onSubmit:async e=>{e.preventDefault(),n(!0);try{const{error:e}=await _s.from("fan_messages").insert([{...t,status:"unread",is_prayed_for:!1,is_featured:!1}]);if(e)throw e;d(!0),r({from_name:"",from_email:"",message_type:"general",subject:"",message:"",is_anonymous:!1}),setTimeout(()=>d(!1),5e3)}catch(s){alert("Failed to send message. Please try again.")}n(!1)},className:"space-y-4 md:space-y-5",children:[O.jsxs("div",{children:[O.jsx("label",{className:"block text-xs md:text-sm font-semibold text-purple-200 mb-2 md:mb-3",children:"What would you like to share? *"}),O.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 md:gap-3",children:p.map(e=>{const s=e.icon;return O.jsxs("button",{type:"button",onClick:()=>r({...t,message_type:e.value}),className:"p-2.5 md:p-3 rounded-lg md:rounded-xl border transition-all "+(t.message_type===e.value?"border-purple-500 bg-purple-500/20":"border-purple-500/20 hover:border-purple-500/40 bg-purple-500/5"),children:[O.jsx(s,{size:18,className:"mx-auto mb-1 md:mb-1.5 md:w-5 md:h-5 "+(t.message_type===e.value?"text-purple-300":"text-purple-400")}),O.jsx("p",{className:"text-[10px] md:text-xs font-medium "+(t.message_type===e.value?"text-white":"text-purple-200"),children:e.label})]},e.value)})})]}),O.jsxs("div",{children:[O.jsxs("label",{className:"block text-xs md:text-sm font-semibold text-purple-200 mb-1.5 md:mb-2",children:["Your Name ",!t.is_anonymous&&"*"]}),O.jsx("input",{type:"text",value:t.from_name,onChange:e=>r({...t,from_name:e.target.value}),disabled:t.is_anonymous,required:!t.is_anonymous,className:"w-full px-3 py-2 md:px-4 md:py-2.5 text-sm md:text-base bg-purple-500/10 text-white border border-purple-500/30 rounded-lg md:rounded-xl focus:border-purple-500 focus:outline-none transition-colors disabled:bg-gray-100 disabled:text-gray-500",placeholder:"Enter your name"}),O.jsxs("label",{className:"flex items-center gap-1.5 md:gap-2 mt-1.5 md:mt-2",children:[O.jsx("input",{type:"checkbox",checked:t.is_anonymous,onChange:e=>r({...t,is_anonymous:e.target.checked,from_name:e.target.checked?"Anonymous":""}),className:"rounded",style:{width:"18px",height:"18px",minWidth:"18px",minHeight:"18px",maxWidth:"18px",maxHeight:"18px",flexShrink:0,cursor:"pointer"}}),O.jsx("span",{className:"text-xs md:text-sm text-purple-200",children:"Send anonymously"})]})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-xs md:text-sm font-semibold text-purple-200 mb-1.5 md:mb-2",children:"Email (optional)"}),O.jsx("input",{type:"email",value:t.from_email,onChange:e=>r({...t,from_email:e.target.value}),className:"w-full px-3 py-2 md:px-4 md:py-2.5 text-sm md:text-base bg-purple-500/10 text-white border border-purple-500/30 rounded-lg md:rounded-xl focus:border-purple-500 focus:outline-none transition-colors",placeholder:"your@email.com"}),O.jsx("p",{className:"text-[10px] md:text-xs text-purple-300 mt-1",children:"We'll only use this to respond to you"})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-xs md:text-sm font-semibold text-purple-200 mb-1.5 md:mb-2",children:"Subject (optional)"}),O.jsx("input",{type:"text",value:t.subject,onChange:e=>r({...t,subject:e.target.value}),className:"w-full px-3 py-2 md:px-4 md:py-2.5 text-sm md:text-base bg-purple-500/10 text-white border border-purple-500/30 rounded-lg md:rounded-xl focus:border-purple-500 focus:outline-none transition-colors",placeholder:"Brief subject line"})]}),O.jsxs("div",{children:[O.jsx("label",{className:"block text-xs md:text-sm font-semibold text-purple-200 mb-1.5 md:mb-2",children:"Your Message *"}),O.jsx("textarea",{value:t.message,onChange:e=>r({...t,message:e.target.value}),required:!0,rows:5,className:"w-full px-3 py-2 md:px-4 md:py-2.5 text-sm md:text-base bg-purple-500/10 text-white border border-purple-500/30 rounded-lg md:rounded-xl focus:border-purple-500 focus:outline-none transition-colors resize-none",placeholder:"Share your message, prayer request, testimony, or inquiry..."})]}),O.jsxs("button",{type:"submit",disabled:s||!t.message.trim(),className:"w-full flex items-center justify-center gap-2 px-5 py-3 md:px-6 md:py-3.5 text-sm md:text-base bg-gradient-to-r from-purple-600 to-purple-700 text-white rounded-lg md:rounded-xl font-semibold hover:from-purple-700 hover:to-purple-800 transition-all disabled:opacity-50 disabled:cursor-not-allowed shadow-lg hover:shadow-xl hover:shadow-purple-500/50",children:[O.jsx(o,{size:16,className:"md:w-5 md:h-5"}),s?"Sending...":"Send Message"]})]})]})})},js=e.lazy(()=>N(()=>import("./AdminPanel-y7PPT_A6.js"),__vite__mapDeps([0,1,2]))),Ts=()=>{var t,r,s,n,i,o,a,l,c,h,w,y;const[_,x]=e.useState(!1),[k,S]=e.useState("home"),[j,T]=e.useState(!1),[E,P]=e.useState(!1),[C,A]=e.useState([]),[D,B]=e.useState(null),[q,M]=e.useState(null),[W,z]=e.useState(0),[F,H]=e.useState(0);e.useEffect(()=>{V();(async()=>{try{const{subscribeToVideos:t,subscribeToSettings:r,trackVisit:s}=await N(async()=>{const{subscribeToVideos:e,subscribeToSettings:t,trackVisit:r}=await Promise.resolve().then(()=>Bs);return{subscribeToVideos:e,subscribeToSettings:t,trackVisit:r}},void 0);try{await s()}catch(e){}const n=t(e=>{A(e.filter(e=>"completed"===e.status))}),i=r(e=>{e&&B(e)}),o=setTimeout(()=>{C.length>0||null!==D||V()},2e3);return()=>{clearTimeout(o),n(),i()}}catch(e){setTimeout(()=>{V()},3e3)}})();const e=()=>{V()};return window.addEventListener("online",e),()=>{window.removeEventListener("online",e)}},[]);const V=async(e=0)=>{try{const{getCompletedVideos:t,getSettings:r}=await N(async()=>{const{getCompletedVideos:e,getSettings:t}=await Promise.resolve().then(()=>Bs);return{getCompletedVideos:e,getSettings:t}},void 0),s=await Promise.allSettled([t(),r()]);"fulfilled"===s[0].status&&s[0].value?A(s[0].value):"rejected"===s[0].status&&e<1&&setTimeout(()=>V(e+1),2e3),"fulfilled"===s[1].status&&s[1].value?B(s[1].value):"rejected"===s[1].status&&e<1&&setTimeout(()=>V(e+1),2e3)}catch(t){if(e<2){const t=Math.min(2e3*Math.pow(2,e),1e4);setTimeout(()=>V(e+1),t)}}},K=e=>{e&&(e.preventDefault(),e.stopPropagation());const t=Date.now();if(t-F>1e3)return z(1),void H(t);const r=W+1;z(r),H(t),r>=3&&(z(0),H(0),P(!0),window.location.hash="#admin",setTimeout(()=>{"#admin"!==window.location.hash&&(window.location.hash="#admin"),P(!0)},100))},J=e=>{if(!e)return"";if(e.includes("cloudinary.com"))return e.includes("/upload/")?e.replace("/upload/","/upload/so_0,w_640,h_360,c_fill,f_jpg/"):e.includes("/video/")?e.replace("/video/","/image/").replace(/\.(mp4|mov|avi|webm|mkv)$/i,".jpg"):e.replace("/upload/","/upload/so_0,f_jpg/");let t="";const r=e.match(/[?&]v=([^&]+)/);r&&(t=r[1]);const s=e.match(/youtu\.be\/([^?]+)/);s&&(t=s[1]);const n=e.match(/embed\/([^?]+)/);return n&&(t=n[1]),t?`https://img.youtube.com/vi/${t}/maxresdefault.jpg`:""};e.useEffect(()=>{const e=()=>{const e=["home","about","videos","contact"].find(e=>{const t=document.getElementById(e);if(t){const e=t.getBoundingClientRect();return e.top<=100&&e.bottom>=100}return!1});e&&S(e)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]);const G=e=>{const t=document.getElementById(e);t&&t.scrollIntoView({behavior:"smooth"}),x(!1)};return e.useEffect(()=>{"#admin"===window.location.hash&&P(!0)},[]),E?O.jsx(e.Suspense,{fallback:O.jsx($,{}),children:O.jsx(js,{onClose:()=>{P(!1),window.location.hash="",V()}})}):j?O.jsx($,{}):O.jsxs("div",{className:"bg-black text-white min-h-screen relative",style:{overflowX:"hidden",maxWidth:"100vw"},children:[O.jsx(L,{}),O.jsxs("nav",{className:"fixed top-0 w-full backdrop-blur-xl bg-black/90 border-b border-purple-500/30 z-40",style:{maxWidth:"100vw",overflowX:"hidden"},children:[O.jsx("div",{className:"container mx-auto px-4 md:px-6 lg:px-12",style:{maxWidth:"100%",overflowX:"hidden"},children:O.jsxs("div",{className:"flex justify-between items-center h-16 md:h-20",style:{maxWidth:"100%"},children:[O.jsxs("div",{className:"flex items-center gap-2 md:gap-4 flex-shrink-0 cursor-pointer touch-manipulation",onClick:K,onTouchStart:e=>{K(e)},title:"Triple tap for admin access",style:{minHeight:"44px",minWidth:"44px",touchAction:"manipulation"},children:[O.jsx("img",{src:"https://res.cloudinary.com/dtynqpjye/image/upload/v1761948158/ESTHER-REIGN-LOGO.-Photoroom_nj506d.png",alt:"Esther Reign Logo",className:"h-12 md:h-16 lg:h-20 w-auto",loading:"eager"}),O.jsx("span",{className:"text-[10px] sm:text-xs md:text-base lg:text-lg font-bold text-purple-300 whitespace-nowrap",children:"@officialEstherReign"})]}),O.jsx("div",{className:"hidden md:flex items-center space-x-6 lg:space-x-8",children:[{id:"home",label:"Home"},{id:"about",label:"About"},{id:"videos",label:"Videos"},{id:"contact",label:"Contact"}].map(e=>O.jsxs("button",{onClick:()=>G(e.id),className:"text-sm font-medium transition-all relative group "+(k===e.id?"text-purple-300":"text-gray-300 hover:text-white"),children:[e.label,O.jsx("span",{className:"absolute -bottom-1 left-0 h-0.5 bg-gradient-to-r from-purple-500 to-purple-600 transition-all "+(k===e.id?"w-full":"w-0 group-hover:w-full")})]},e.id))}),O.jsx("button",{className:"md:hidden text-white touch-manipulation",onClick:()=>x(!_),style:{minWidth:"44px",minHeight:"44px",padding:"0.5rem"},children:_?O.jsx(u,{size:24}):O.jsx(d,{size:24})})]})}),_&&O.jsx("div",{className:"md:hidden backdrop-blur-xl bg-black/95 border-t border-purple-500/30",style:{maxWidth:"100vw",overflowX:"hidden"},children:O.jsx("nav",{className:"container mx-auto px-6 py-6 space-y-4",style:{maxWidth:"100%"},children:[{id:"home",label:"Home"},{id:"about",label:"About"},{id:"videos",label:"Videos"},{id:"contact",label:"Contact"}].map(e=>O.jsx("button",{onClick:()=>{G(e.id),x(!1)},className:"block w-full text-left py-3 text-gray-300 hover:text-purple-300 transition-colors touch-manipulation",style:{minHeight:"44px"},children:e.label},e.id))})})]}),O.jsx("section",{id:"home",className:"min-h-screen flex items-center relative pt-16 md:pt-20 bg-black",style:{overflow:"visible",maxWidth:"100vw",backgroundColor:"#000000",zIndex:10,position:"relative"},children:O.jsx("div",{className:"container mx-auto px-4 md:px-6 lg:px-12 relative z-10",style:{maxWidth:"100%"},children:O.jsxs("div",{className:"grid lg:grid-cols-2 gap-6 md:gap-12 items-center",style:{maxWidth:"100%"},children:[O.jsxs("div",{className:"relative max-w-[320px] sm:max-w-md md:max-w-lg lg:max-w-4xl xl:max-w-5xl mx-auto lg:order-2 hero-image-container",style:{overflow:"visible",width:"100%",zIndex:20,position:"relative",backgroundColor:"transparent"},children:[O.jsx(U,{}),O.jsx("div",{className:"relative shadow-2xl rounded-full lg:rounded-3xl aspect-square lg:aspect-auto hero-image-frame",style:{padding:"0",overflow:"visible",zIndex:1,position:"relative",border:"none"},children:O.jsx("div",{className:"w-full h-full rounded-full lg:rounded-3xl overflow-hidden",children:O.jsx("img",{src:(null==D?void 0:D.hero_image)||"/Estherreign.jpg",alt:"Esther Reign",className:"w-full h-full object-cover hero-image",style:{display:"block"},loading:"eager"})})})]}),O.jsxs("div",{className:"space-y-4 md:space-y-6 text-center lg:text-left lg:order-1",children:[O.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 md:px-4 md:py-2 bg-purple-500/20 rounded-full mx-auto lg:mx-0 border border-purple-500/30",children:[O.jsx(p,{size:14,className:"text-purple-300 animate-pulse"}),O.jsx("span",{className:"text-xs md:text-sm text-purple-200 font-medium",children:"Gospel Singer & Worship Leader"})]}),O.jsxs("h1",{className:"text-5xl sm:text-6xl md:text-6xl lg:text-7xl xl:text-8xl font-black leading-tight hero-name",children:[O.jsx("span",{className:"text-white",children:"Esther"}),O.jsx("br",{}),O.jsx("span",{className:"bg-gradient-to-r from-purple-400 to-purple-600 bg-clip-text text-transparent",children:"Reign"})]}),O.jsx("p",{className:"text-sm md:text-base lg:text-lg xl:text-xl text-gray-200 leading-relaxed max-w-xl mx-auto lg:mx-0",children:(null==D?void 0:D.hero_description)||"Lifting voices in worship through powerful gospel music. Experience the presence of God through every note."}),O.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 md:gap-4 justify-center lg:justify-start",children:[O.jsxs("button",{onClick:()=>G("videos"),className:"group bg-gradient-to-r from-purple-600 to-purple-700 px-6 py-3 md:px-8 md:py-4 rounded-full font-semibold flex items-center justify-center gap-2 text-white hover:shadow-lg hover:shadow-purple-500/50 transition-all text-sm md:text-base",children:["Watch Videos",O.jsx(f,{size:18,className:"group-hover:translate-x-1 transition-transform"})]}),O.jsx("button",{onClick:()=>G("contact"),className:"px-6 py-3 md:px-8 md:py-4 rounded-full font-semibold border-2 border-purple-500/30 text-purple-300 hover:border-purple-500/50 hover:bg-purple-500/10 transition-all text-sm md:text-base",children:"Get In Touch"})]}),O.jsxs("div",{className:"flex gap-3 md:gap-4 pt-4 md:pt-6 pb-6 md:pb-8 lg:pb-0 justify-center lg:justify-start",children:[O.jsx("a",{href:(null==(t=null==D?void 0:D.social_links)?void 0:t.instagram)||"https://instagram.com/estherreign",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 md:w-12 md:h-12 bg-purple-500/20 border border-purple-500/30 hover:border-purple-500/50 hover:bg-purple-500/30 rounded-full flex items-center justify-center text-purple-300 transition-all",children:O.jsx(m,{size:18,className:"md:w-5 md:h-5"})}),O.jsx("a",{href:(null==(r=null==D?void 0:D.social_links)?void 0:r.youtube)||"https://youtube.com/@estherreign",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 md:w-12 md:h-12 bg-purple-500/20 border border-purple-500/30 hover:border-purple-500/50 hover:bg-purple-500/30 rounded-full flex items-center justify-center text-purple-300 transition-all",children:O.jsx(g,{size:18,className:"md:w-5 md:h-5"})}),O.jsx("a",{href:(null==(s=null==D?void 0:D.social_links)?void 0:s.tiktok)||"https://tiktok.com/@estherreign",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 md:w-12 md:h-12 bg-purple-500/20 border border-purple-500/30 hover:border-purple-500/50 hover:bg-purple-500/30 rounded-full flex items-center justify-center text-purple-300 transition-all",children:O.jsx(R,{size:18,className:"md:w-5 md:h-5"})}),O.jsx("a",{href:(null==(n=null==D?void 0:D.social_links)?void 0:n.facebook)||"https://facebook.com/estherreign",target:"_blank",rel:"noopener noreferrer",className:"w-10 h-10 md:w-12 md:h-12 bg-purple-500/20 border border-purple-500/30 hover:border-purple-500/50 hover:bg-purple-500/30 rounded-full flex items-center justify-center text-purple-300 transition-all",children:O.jsx(I,{size:18,className:"md:w-5 md:h-5"})})]})]})]})})}),O.jsx("section",{id:"about",className:"py-16 md:py-24 lg:py-32 relative overflow-hidden bg-black",style:{maxWidth:"100vw",overflowX:"hidden"},children:O.jsx("div",{className:"container mx-auto px-4 md:px-6 lg:px-12 relative z-10",style:{maxWidth:"100%"},children:O.jsxs("div",{className:"max-w-6xl mx-auto",children:[O.jsx("div",{className:"text-center mb-12 md:mb-20",children:O.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-black mb-6",children:O.jsx("span",{className:"bg-gradient-to-r from-white to-purple-400 bg-clip-text text-transparent",children:"About Me"})})}),O.jsxs("div",{className:"grid lg:grid-cols-2 gap-8 md:gap-12 lg:gap-16 items-center",children:[O.jsxs("div",{className:"relative",children:[O.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-500/30 to-purple-600/30 rounded-3xl blur-2xl opacity-30"}),O.jsx("div",{className:"relative border-4 border-white/20 shadow-2xl rounded-3xl overflow-hidden",children:O.jsx("img",{src:(null==D?void 0:D.about_image)||"/IMG-20250915-WA0023.jpg",alt:"About Esther",className:"w-full h-auto",loading:"lazy"})})]}),O.jsx("div",{className:"space-y-4 md:space-y-6",children:((null==D?void 0:D.about_text)||"I am an emerging gospel artist with a deep passion for worship and praise. Through powerful cover songs, I aim to create an atmosphere where people can encounter God's presence.\n\nEvery song I sing is a testimony of God's faithfulness and love. My mission is to use my voice as an instrument of worship, touching hearts and transforming lives through gospel music.\n\nJoin me on this journey as I share my gift with the world, one song at a time, bringing glory to God through music.").split("\n\n").map((e,t)=>O.jsx("p",{className:"text-base md:text-lg text-gray-200 leading-relaxed",children:e},t))})]})]})})}),O.jsx("section",{id:"videos",className:"py-16 md:py-24 lg:py-32 relative overflow-hidden bg-black",style:{maxWidth:"100vw",overflowX:"hidden"},children:O.jsxs("div",{className:"container mx-auto px-4 md:px-6 lg:px-12 relative z-10",style:{maxWidth:"100%"},children:[O.jsxs("div",{className:"text-center mb-12 md:mb-20",children:[O.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-500/20 border border-purple-500/30 rounded-full mb-6",children:[O.jsx(v,{size:16,className:"text-purple-300 animate-pulse"}),O.jsx("span",{className:"text-sm text-purple-200 font-medium",children:"Watch"})]}),O.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-black mb-4 md:mb-6",children:O.jsx("span",{className:"bg-gradient-to-r from-white to-purple-400 bg-clip-text text-transparent",children:"Videos"})}),O.jsx("p",{className:"text-gray-200 max-w-2xl mx-auto text-base md:text-lg px-4",children:"Experience powerful gospel worship that will uplift your spirit"})]}),0===C.length?O.jsxs("div",{className:"text-center py-20",children:[O.jsx("div",{className:"w-24 h-24 bg-purple-500/20 rounded-full flex items-center justify-center mx-auto mb-6",children:O.jsx(v,{size:48,className:"text-purple-300"})}),O.jsx("p",{className:"text-gray-300 text-xl",children:"New videos coming soon..."})]}):O.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 lg:gap-8 max-w-7xl mx-auto",children:C.map((e,t)=>O.jsxs("div",{className:"group relative overflow-hidden rounded-2xl bg-purple-500/10 backdrop-blur-xl border border-purple-500/20 hover:border-purple-500/40 transition-all",children:[O.jsxs("div",{className:"aspect-video bg-gradient-to-br from-purple-900/50 to-purple-800/50 flex items-center justify-center relative overflow-hidden cursor-pointer",onClick:()=>M(e),onMouseEnter:t=>{const r=t.currentTarget.querySelector("video");r&&e.video_link&&!e.video_link.includes("youtube.com")&&!e.video_link.includes("youtu.be")&&(r.currentTime=0,r.play().catch(()=>{}))},onMouseLeave:e=>{const t=e.currentTarget.querySelector("video");t&&(t.pause(),t.currentTime=0)},children:[O.jsx("img",{src:e.thumbnail_url||J(e.video_link||""),alt:e.title,className:"absolute inset-0 w-full h-full object-cover",loading:"lazy",onError:t=>{t.target.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="640" height="360"%3E%3Crect fill="%23374151" width="640" height="360"/%3E%3Ctext fill="%239CA3AF" font-family="Arial" font-size="24" x="50%25" y="50%25" text-anchor="middle" dominant-baseline="middle"%3E'+encodeURIComponent(e.title)+"%3C/text%3E%3C/svg%3E"}}),e.video_link&&!e.video_link.includes("youtube.com")&&!e.video_link.includes("youtu.be")&&O.jsx("video",{src:e.video_link,className:"absolute inset-0 w-full h-full object-cover opacity-0 group-hover:opacity-100 transition-opacity duration-500 pointer-events-none z-20",muted:!0,loop:!0,playsInline:!0,preload:"metadata"}),O.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent flex items-center justify-center transition-all duration-300 group-hover:bg-black/30",children:O.jsx("button",{onClick:t=>{t.stopPropagation(),M(e)},className:"w-20 h-20 bg-purple-600/80 hover:bg-purple-600 rounded-full flex items-center justify-center transform transition-all shadow-lg group-hover:scale-125",children:O.jsx(v,{size:32,className:"text-white ml-1",fill:"currentColor"})})})]}),O.jsxs("div",{className:"p-6 bg-purple-500/5",children:[O.jsx("h3",{className:"text-lg font-bold mb-2 line-clamp-2 text-white",children:e.title}),e.template_type&&O.jsx("p",{className:"text-sm text-purple-300",children:e.template_type})]})]},e.id))})]})}),O.jsx("section",{id:"contact",className:"py-16 md:py-24 lg:py-32 relative overflow-hidden bg-black",style:{maxWidth:"100vw",overflowX:"hidden"},children:O.jsx("div",{className:"container mx-auto px-4 md:px-6 lg:px-12 relative z-10",style:{maxWidth:"100%"},children:O.jsxs("div",{className:"max-w-4xl mx-auto",children:[O.jsxs("div",{className:"text-center mb-12 md:mb-20",children:[O.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 bg-purple-500/20 border border-purple-500/30 rounded-full mb-6",children:[O.jsx(b,{size:16,className:"text-purple-300 animate-pulse"}),O.jsx("span",{className:"text-sm text-purple-200 font-medium",children:"Contact"})]}),O.jsx("h2",{className:"text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-black mb-4 md:mb-6",children:O.jsx("span",{className:"bg-gradient-to-r from-white to-purple-400 bg-clip-text text-transparent",children:"Let's Connect"})}),O.jsx("p",{className:"text-gray-200 max-w-2xl mx-auto text-base md:text-lg px-4",children:"For bookings, collaborations, or inquiries"})]}),O.jsx("div",{className:"mb-12 md:mb-16",children:O.jsx(Ss,{})}),O.jsxs("div",{className:"flex justify-center gap-6",children:[O.jsx("a",{href:(null==(i=null==D?void 0:D.social_links)?void 0:i.instagram)||"https://instagram.com/estherreign",target:"_blank",rel:"noopener noreferrer",className:"w-14 h-14 bg-purple-500/20 border border-purple-500/30 hover:border-purple-500/50 hover:bg-purple-500/30 rounded-full flex items-center justify-center text-purple-300 transition-all",children:O.jsx(m,{size:24})}),O.jsx("a",{href:(null==(o=null==D?void 0:D.social_links)?void 0:o.youtube)||"https://youtube.com/@estherreign",target:"_blank",rel:"noopener noreferrer",className:"w-14 h-14 bg-purple-500/20 border border-purple-500/30 hover:border-purple-500/50 hover:bg-purple-500/30 rounded-full flex items-center justify-center text-purple-300 transition-all",children:O.jsx(g,{size:24})}),O.jsx("a",{href:(null==(a=null==D?void 0:D.social_links)?void 0:a.tiktok)||"https://tiktok.com/@estherreign",target:"_blank",rel:"noopener noreferrer",className:"w-14 h-14 bg-purple-500/20 border border-purple-500/30 hover:border-purple-500/50 hover:bg-purple-500/30 rounded-full flex items-center justify-center text-purple-300 transition-all",children:O.jsx(R,{size:24})}),O.jsx("a",{href:(null==(l=null==D?void 0:D.social_links)?void 0:l.facebook)||"https://facebook.com/estherreign",target:"_blank",rel:"noopener noreferrer",className:"w-14 h-14 bg-purple-500/20 border border-purple-500/30 hover:border-purple-500/50 hover:bg-purple-500/30 rounded-full flex items-center justify-center text-purple-300 transition-all",children:O.jsx(I,{size:24})})]})]})})}),O.jsx("footer",{className:"py-8 border-t border-purple-500/30 bg-black/80",style:{maxWidth:"100vw",overflowX:"hidden"},children:O.jsx("div",{className:"container mx-auto px-6 lg:px-12",style:{maxWidth:"100%"},children:O.jsx("div",{className:"text-center",children:O.jsx("p",{className:"text-gray-300 text-sm font-medium",children:" 2025 Esther Reign. All rights reserved."})})})}),q&&O.jsxs("div",{className:"fixed inset-0 bg-black/95 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:[O.jsx("button",{onClick:()=>M(null),className:"absolute top-6 right-6 w-12 h-12 bg-purple-500/20 hover:bg-purple-500/30 rounded-full flex items-center justify-center transition-colors z-10",children:O.jsx(u,{size:24,className:"text-white"})}),O.jsxs("div",{className:"w-full max-w-5xl",children:[O.jsxs("div",{className:"mb-4",children:[O.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-white mb-2",children:q.title}),q.template_type&&O.jsx("p",{className:"text-purple-300 text-sm",children:q.template_type})]}),O.jsx("div",{className:"relative aspect-video bg-black rounded-xl overflow-hidden shadow-2xl",children:(null==(c=q.video_link)?void 0:c.includes("youtube.com"))||(null==(h=q.video_link)?void 0:h.includes("youtu.be"))?O.jsx("iframe",{src:`https://www.youtube.com/embed/${(null==(w=q.video_link.match(/[?&]v=([^&]+)/))?void 0:w[1])||(null==(y=q.video_link.match(/youtu\.be\/([^?]+)/))?void 0:y[1])}`,className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:q.title}):O.jsx("video",{src:q.video_link,controls:!0,autoPlay:!0,className:"w-full h-full",controlsList:"nodownload",children:"Your browser does not support the video tag."})}),O.jsx("div",{className:"mt-4 flex justify-center gap-4",children:O.jsxs("a",{href:q.video_link,target:"_blank",rel:"noopener noreferrer",className:"bg-gradient-to-r from-purple-600 to-purple-700 px-6 py-3 rounded-full text-white font-medium flex items-center gap-2 hover:shadow-lg hover:shadow-purple-500/50 transition-all",children:["Open in New Tab",O.jsx(f,{size:18})]})})]})]})]})};async function Es(){if(!("serviceWorker"in navigator))return null;try{const e=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return setInterval(()=>{e.update()},36e5),e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&function(){var e,t;const r=document.createElement("div");r.id="pwa-update-banner",r.innerHTML='\n    <div style="\n      position: fixed;\n      bottom: 20px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: linear-gradient(135deg, #d4af37 0%, #fbbf24 100%);\n      color: white;\n      padding: 16px 24px;\n      border-radius: 12px;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n      z-index: 10000;\n      display: flex;\n      align-items: center;\n      gap: 16px;\n      max-width: 90%;\n      animation: slideUp 0.3s ease-out;\n    ">\n      <span style="flex: 1; font-size: 14px; font-weight: 500;">\n         New version available!\n      </span>\n      <button id="pwa-update-btn" style="\n        background: white;\n        color: #0a0a0a;\n        border: none;\n        padding: 8px 16px;\n        border-radius: 6px;\n        font-weight: 600;\n        cursor: pointer;\n        font-size: 14px;\n      ">\n        Update Now\n      </button>\n      <button id="pwa-dismiss-btn" style="\n        background: transparent;\n        color: white;\n        border: 1px solid rgba(255,255,255,0.3);\n        padding: 8px 16px;\n        border-radius: 6px;\n        font-weight: 600;\n        cursor: pointer;\n        font-size: 14px;\n      ">\n        Later\n      </button>\n    </div>\n    <style>\n      @keyframes slideUp {\n        from {\n          transform: translateX(-50%) translateY(100px);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(-50%) translateY(0);\n          opacity: 1;\n        }\n      }\n    </style>\n  ',document.body.appendChild(r),null==(e=document.getElementById("pwa-update-btn"))||e.addEventListener("click",()=>{navigator.serviceWorker.controller&&(navigator.serviceWorker.controller.postMessage({type:"SKIP_WAITING"}),window.location.reload())}),null==(t=document.getElementById("pwa-dismiss-btn"))||t.addEventListener("click",()=>{r.remove()})}()})}),e}catch(e){return null}}const Ps=e.createContext(void 0),Os=({children:t})=>{const[r,s]=e.useState(()=>localStorage.getItem("theme")||"gaming");e.useEffect(()=>{localStorage.setItem("theme",r),document.documentElement.classList.remove("light","dark","gaming"),document.documentElement.classList.add(r)},[r]);return O.jsx(Ps.Provider,{value:{theme:r,toggleTheme:()=>{s(e=>"light"===e?"dark":"dark"===e?"gaming":"light")},setTheme:s},children:t})},Cs=()=>{const t=e.useContext(Ps);if(!t)throw new Error("useTheme must be used within ThemeProvider");return t},As=async()=>{try{const{data:e,error:t}=await _s.from("videos").select("*").order("order_index",{ascending:!0});if(t)throw t;return e||[]}catch(e){return[]}},Ns=async e=>{try{const t={id:`video_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,...e,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()},{data:r,error:s}=await _s.from("videos").insert([t]).select().single();if(s)throw s;return r}catch(t){return null}},Is=async(e,t)=>{try{const{error:r}=await _s.from("videos").update({...t,updated_at:(new Date).toISOString()}).eq("id",e);if(r)throw r;return!0}catch(r){return!1}},Rs=async e=>{try{const{error:t}=await _s.from("videos").delete().eq("id",e);if(t)throw t;return!0}catch(t){return!1}},$s=async e=>{try{const t=e.map((e,t)=>({id:e.id,order_index:t,updated_at:(new Date).toISOString()})),{error:r}=await _s.from("videos").upsert(t);if(r)throw r;return!0}catch(t){return!1}},Ls=async()=>{try{const{data:e,error:t}=await _s.from("site_settings").select("*").eq("id","main").single();if(t)throw t;return e}catch(e){return null}},Us=async(e,t)=>{try{const{error:r}=await _s.from("users").update({avatar_url:t}).eq("email",e);return!r}catch(r){return!1}},Ds=async e=>{try{const{data:t,error:r}=await _s.from("users").select("avatar_url").eq("email",e).maybeSingle();return r?null:(null==t?void 0:t.avatar_url)||null}catch(t){return null}},Bs=Object.freeze(Object.defineProperty({__proto__:null,addVideo:Ns,deleteVideo:Rs,getCompletedVideos:async()=>{try{const{data:e,error:t}=await _s.from("videos").select("*").eq("status","completed").order("order_index",{ascending:!0});if(t)throw t;return e||[]}catch(e){return[]}},getProfilePicture:Ds,getSettings:Ls,getVideos:As,reorderVideos:$s,saveProfilePicture:Us,subscribeToSettings:e=>{const t=_s.channel("settings_changes").on("postgres_changes",{event:"*",schema:"public",table:"site_settings"},async()=>{const t=await Ls();e(t)}).subscribe();return()=>{_s.removeChannel(t)}},subscribeToVideos:e=>{const t=_s.channel("videos_changes").on("postgres_changes",{event:"*",schema:"public",table:"videos"},async()=>{const t=await As();e(t)}).subscribe();return()=>{_s.removeChannel(t)}},trackVisit:async()=>{try{const e=await Ls(),t=(null==e?void 0:e.total_visits)||0;await _s.from("site_settings").update({total_visits:t+1,updated_at:(new Date).toISOString()}).eq("id","main")}catch(e){}},updateSettings:async e=>{try{const{error:t}=await _s.from("site_settings").update({...e,updated_at:(new Date).toISOString()}).eq("id","main");if(t)throw t;return!0}catch(t){return!1}},updateVideo:Is},Symbol.toStringTag,{value:"Module"})),qs=e.createContext(void 0),Ms=({children:t})=>{const[r,s]=e.useState(null);e.useEffect(()=>{(async()=>{var e;const t=localStorage.getItem("admin_profile_picture");t&&s(t);try{const t=localStorage.getItem("admin_session");if(t){const r=null==(e=JSON.parse(t).user)?void 0:e.email;if(r){const e=await Ds(r);e&&(s(e),localStorage.setItem("admin_profile_picture",e))}}}catch(r){}})()},[]),e.useEffect(()=>{const e=e=>{"admin_profile_picture"===e.key&&s(e.newValue)};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[]),e.useEffect(()=>{const e=e=>{s(e.detail)};return window.addEventListener("profilePictureUpdated",e),()=>window.removeEventListener("profilePictureUpdated",e)},[]);const n=async e=>{var t;s(e),e?localStorage.setItem("admin_profile_picture",e):localStorage.removeItem("admin_profile_picture");try{const r=localStorage.getItem("admin_session");if(r){const s=null==(t=JSON.parse(r).user)?void 0:t.email;s&&e&&Us(s,e).then(e=>{})}}catch(r){}window.dispatchEvent(new CustomEvent("profilePictureUpdated",{detail:e}))};return O.jsx(qs.Provider,{value:{profilePicture:r,setProfilePicture:n,updateProfilePicture:e=>{n(e)}},children:t})},Ws=()=>{const t=e.useContext(qs);if(void 0===t)throw new Error("useProfilePicture must be used within a ProfilePictureProvider");return t};(async function(){await Es(),window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone})().then(()=>{}).catch(e=>{}),P(document.getElementById("root")).render(O.jsx(e.StrictMode,{children:O.jsx(Os,{children:O.jsx(Ms,{children:O.jsx(Ts,{})})})}));export{L as P,N as _,Ns as a,Is as b,ks as c,Rs as d,Cs as e,Ls as f,As as g,Bs as h,O as j,$s as r,_s as s,Ws as u};
